var utils = require("@zoho/lyte-cli-utils");
var fileManipulation = utils.fileManipulation;

var lyteReleases = JSON.parse(fileManipulation.readSync('releases.json','utf-8'))
var releaseNotes = getReleaseNotes();
var output = "# Lyte - Changelog details\n\n"


lyteReleases.versions.forEach(function(version){
    output += "#  v"+version+"\n";
    lyteReleases.moduleOrder.forEach(function(module) {
        var notes,
        noteArray;
        if(notes = releaseNotes[module][version]) {
            lyteReleases.order.forEach(function(type) {
                if((noteArray = notes[type]) && noteArray.length) {
                    noteArray.forEach(function(note) {  
                        output += "    ["+type.toUpperCase()+"]    "+note+"\n";
                    })
                }
            });
        }
    });
    output += "#  v"+version+"\n";
    output += "    [INITIAL]  Initial Release";
});

fileManipulation.writeSync("CHANGELOG.md",output);

function getReleaseNotes() {
    var paths = {
        "lyte" : 'release-notes.json', 
        "component" : './bower_components/lyte-component/tests/release-notes.json', 
        "data" : './bower_components/lyte-data/test/release-notes.json', 
        "router" : './bower_components/lyte-router/test/release-notes.json'
    },
    notes = {};
    for(var key in paths) {
        notes[key] = JSON.parse(fileManipulation.readSync(paths[key],'utf-8'));
    }
    return notes;
}