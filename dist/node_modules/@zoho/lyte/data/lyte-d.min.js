function ReplaceWith(e){var r=this.parentNode,t=arguments.length,o=+(r&&"object"==typeof e);if(r){for(;t-- >o;)r&&"object"!=typeof arguments[t]&&(arguments[t]=document.createTextNode(arguments[t])),r||!arguments[t].parentNode?r.insertBefore(this.previousSibling,arguments[t]):arguments[t].parentNode.removeChild(arguments[t]);o&&r.replaceChild(this,e)}}[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("after")||Object.defineProperty(e,"after",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),r=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;r.appendChild(t?e:document.createTextNode(String(e)))}),this.parentNode.insertBefore(r,this.nextSibling)}})}),Element.prototype.replaceWith||(Element.prototype.replaceWith=ReplaceWith),CharacterData.prototype.replaceWith||(CharacterData.prototype.replaceWith=ReplaceWith),DocumentType.prototype.replaceWith||(DocumentType.prototype.replaceWith=ReplaceWith),String.prototype.startsWith||(String.prototype.startsWith=function(e,r){return r=r||0,this.indexOf(e,r)===r}),String.prototype.endsWith||(String.prototype.endsWith=function(e,r){return(void 0===r||r>this.length)&&(r=this.length),this.substring(r-e.length,r)===e}),window.Lyte={version:"3.4.1",$:{consoleTime:[]},registeredMixins:{},registeredServices:{},requiredServices:{},toBeInjectedServices:{},_registeredComponents:{},_keywords:{component:["init","didConnect","didDestroy","constructor","onError","actions","methods","data"],adapter:["namespace","actionNamespace","host","withCredentials","buildURL","methodForRequest","headersForRequest","reloadRecord","reloadRecord","reloadAll","processRequest","parseResponse","parseRequest","super"],serializer:["normalize","normalizeResponse","serialize","serializeKey","deserializeKey","extractMeta","payloadKey","serializeRecord","normalizeRecord","super"],route:["getDependencies","getResources","beforeModel","model","afterModel","redirect","renderTemplate","afterRender","beforeExit","didDestroy","queryParams","title","routeName","component","parent","currentModel","forceFetch","setTitle","setQueryParams","getQueryParams","setDynamicParam","getDynamicParam","removeFromCache","refresh","transitionTo","replaceWith","actions"],is:function(e,r){var t=["component","adapter","serializer","route"];r&&(t=[r]);for(var o=t.length,a=0;a<o;a++){var i=this[t[a]];if(i)if(-1!=i.indexOf(e))return!0}return!1}},Mixin:{},Service:{},debug:!1,performance:!1,toBeRegistered:[],browser:{},registeredCustomComponent:{},Globals:{}},function(){var e=Lyte.$.userAgent=window.userAgent=navigator.userAgent;if(e.match(/rv:11\.0/) && navigator.userAgent.match(/Trident/)&&(Lyte.browser.ie=!0,window.action=function(){}),e.match("Edge")){var r=createElement("div");r.innerHTML="<template><div>c</div></template>",r.querySelector("template").childNodes.length?Lyte.browser.ie=!0:Lyte.browser.edge=!0,r.remove()}Object.defineProperty(Lyte,"__gl",{value:{}}),Lyte.Globals.set=function(e,r){Lyte.Component.set(Lyte.__gl,e,r)},Lyte.Globals.get=function(e){return Lyte.Component._get(Lyte.__gl,e)},Lyte.$.assetsDiv=document.createElement("div"),Lyte.$.assetsDiv.setAttribute("id","lyteAssetsDiv"),Lyte.assetsDivContainer=document.head,Lyte.domContentLoaded=function(e){"complete"===document.readyState||"interactive"===document.readyState?e():window.addEventListener("DOMContentLoaded",function(){e()})},Lyte.createApplication=function(e,r){r.init&&r.init.apply(Lyte)},Lyte.registerErrorCodes=function(e){Object.assign(Lyte.errorCodes,e)},Lyte.establishObserverBindings=function(e,r,t,o){var a=this,i=o&&r?o._fldGrps.JsonPathWatch:a.constructor._deepWatchProperties;r&&(a=r);for(var s=0;s<e.length;s++){for(var n=e[s].properties,d={},l=!1,c={},p=0;p<n.length;p++){var y,f=!1;if("string"==typeof n[p]){if(-1!=n[p].search(/^\$\./g)){var v,u=n[p].match(/[^\$.][^\.]*/g)[0];-1!=u.search(/\[[0-9*]\]/g)&&(u=u.split(/\[[0-9*]\]/g)[0]),void 0==i[u]&&(i[u]=[]),void 0==c[u]&&(c[u]=[]);var h="^\\$\\."+u+"\\.?";h=new RegExp(h),v=n[p].replace(h,"$."),i[u].includes(v)||i[u].push(v),c[u].includes(v)||c[u].push(v),u+=".*",d.hasOwnProperty(u)?l=!0:(y=Lyte.getProperty.call(this,u,r,t),d[u]=!0,l=!1)}else if(-1!==n[p].indexOf(".[]"))f=!0,y=Lyte.getProperty.call(this,n[p].substring(0,n[p].indexOf(".[]")),r,t);else{if(-1!==n[p].indexOf(".*")){var m=n[p].split(".")[0];if(!!!(!r&&this.component.__data[m]&&this.component.__data[m].watch||r&&o&&o.fieldList&&o.fieldList[m]&&o.fieldList[m].watch))continue}y=Lyte.getProperty.call(this,n[p],r,t)}l||(y._observers||Object.defineProperty(y,"_observers",{value:new Set,enumerable:!1,writable:!0,configurable:!0}),y._observers.add({callee:a,observer:e[s],isArrayObserver:f}))}else Lyte.warn("ERR27",JSON.stringify(n[p]),e[s].fnName,this.tagName)}e[s].Jpath=c,d={}}},Lyte.getProperty=function(e,r,t){let o=e.match(/([^[\].]+|\[\])/g),a=this;r?(a=t,t[o[0]]||(t[o[0]]={}),a=t[o[0]]):(a._properties[o[0]]||(a._properties[o[0]]={}),a=a._properties[o[0]]),Object.defineProperty(a,"_path",{enumerable:!1,value:o[0]});for(let e=1;e<o.length;e++)(o[e].startsWith("'")||o[e].startsWith('"'))&&(o[e]=o[e].substring(1,o[e].length-1)),a[o[e]]||(a[o[e]]={},Object.defineProperty(a[o[e]],"_path",{enumerable:!1,value:a._path+"."+o[e]})),a=a[o[e]];return a},Lyte.getErrorMessage=function(e){var r=Array.from(arguments).slice(1);return Lyte.errorCodes[e]?Lyte.errorCodes[e].replace(/{(\d+)}/g,function(e,t){return r[t]}):e},Lyte.error=function(){var e=arguments[0],r=e.stack;e=r?e:Error(Lyte.getErrorMessage.apply(Lyte,arguments)),Lyte.onerror&&Lyte.onerror.call(this,e,arguments[1]),Lyte.triggerEvent("error",e,arguments[1]);var t=e.stack&&-1==e.stack.indexOf(e.message);r&&!t&&(e=JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))),arguments[1]?console.error(e.stack?t?e:e.stack:e.message,arguments[1]):console.error(e.stack?t?e:e.stack:e.message)},Lyte.warn=function(){var e=arguments[0];e=e.stack?JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e))):Error(Lyte.getErrorMessage.apply(Lyte,arguments)),console.warn(e.stack?-1!=e.stack.indexOf(e.message)?e.stack.replace("Error: ",""):e:e.message)};var t={},o=Function.prototype;function a(e){return e.match(/\.[a-zA-Z]+(?=\?|$)/)}function a(e){return e.match(/\.[a-zA-Z]+(?=\?|$)/)}o.on||(o.on=function(){return Lyte.warn("'.on()' method with the argument '"+arguments[0]+"' cannot be executed outside component scope."),{type:"callBack",value:"observer"===this.type?this.value:this,properties:arguments,observes:"observer"===this.type?this:void 0}}),o.observes||(o.observes=function(){return Lyte.warn("'.observes()' method with the arguments '"+arguments[0]+"' cannot be executed outside component scope."),{type:"observer",value:this,properties:arguments,on:Lyte._onObj,lyteOn:Lyte._onObj}}),o.computed||(o.computed=function(){return Lyte.warn("'.computed()' method with the arguments '"+arguments[0]+"' cannot be executed outside component scope."),{type:"computed",value:this,properties:arguments}}),Lyte._onObj=function(){return{type:"callBack",value:"observer"===this.type?this.value:this,properties:arguments,observes:"observer"===this.type?this:void 0}},Lyte._observesObj=function(){return{type:"observer",value:this,properties:arguments,on:Lyte._onObj,lyteOn:Lyte._onObj}},Lyte._computedObj=function(){return{type:"computed",value:this,properties:arguments}},Lyte._preRegister=function(){Lyte._actualFnProtoOn=Function.prototype.on,Lyte._actualFnProtoObserves=Function.prototype.observes,Lyte._actualFnProtoComputed=Function.prototype.computed;let e=Function.prototype;e.on=e.lyteOn=Lyte._onObj,e.observes=e.lyteObserves=Lyte._observesObj,e.computed=e.lyteComputed=Lyte._computedObj},Lyte._postRegister=function(){let e=Function.prototype;e.on=Lyte._actualFnProtoOn,e.observes=Lyte._actualFnProtoObserves,e.computed=Lyte._actualFnProtoComputed},Object.defineProperty(Lyte.Mixin,"register",{get:function(){return Lyte._preRegister(),Lyte.registerMixinWrapper}}),Lyte.registerMixinWrapper=function(){try{Lyte.registerMixin.apply(Lyte,arguments),Lyte._postRegister()}catch(e){Lyte._postRegister()}},Lyte.registerMixin=function(e,r){var o;if(Lyte.registeredMixins[e]=r,o=t[e])for(var a in o)Lyte.$.requiredMixins[a](r,o[a],a)},Lyte.Mixin.get=function(e){return Lyte.registeredMixins[e]},Lyte.Service.register=function(e,r){if(Lyte.registeredServices.hasOwnProperty(e))Lyte.warn("Service -"+e+" is already registered");else{if(!Lyte._keywords.is(e)){var t=r;Lyte.registeredServices[e]=t;var o=Lyte.requiredServices[e];return o&&o.size&&o.forEach(function(o){var a=t;o.isGlobal&&(a=Lyte.__gS[o.key]=Lyte.__gS[o.key]||new r(o.data)),o.cB(a,o.key,o.name,e)}),t}Lyte.warn("Service name-"+e+" should not be a keyword used in Lyte")}},Lyte.Service.getInjected=function(e){if(Lyte.__gS.hasOwnProperty(e))return Lyte.__gS[e]},Lyte.$.requiredServices=function(e,r,t,o,a,i,s){var n=Lyte.requiredServices[r],d=n||(Lyte.requiredServices[r]=new Map),l=Lyte.$.genMapId(d);return d.set(l,{key:e,cB:t,type:o,name:a,serviceName:r,isGlobal:i,data:s}),r+"-"+l},Lyte.$.lazyRegisterService=function(e,r){var t=r.scope,o=r.name,a=t[r.type][o];a&&(a[r.key]=e)},Lyte.$.injectServices={},Object.defineProperty(Lyte,"__gS",{value:{}}),Lyte.injectServices=function(e){var r={};Array.isArray(e)||(e=[e]),e.forEach(function(e){if(e&&"object"==typeof e){var t=e.as,o=e.service,a=e.data;Lyte._keywords.is(t)?Lyte.warn("Service cannot be used in any keywords of Lyte."):Lyte.toBeInjectedServices.hasOwnProperty(t)?Lyte.warn("A service has already been injected in the key named, ",t):(Lyte.toBeInjectedServices[t]=o,r[t]={service:o,data:a},Lyte.registeredServices[o]&&(Lyte.__gS[t]=new Lyte.registeredServices[o](a)))}else"string"==typeof e?Lyte.toBeInjectedServices.hasOwnProperty(e)?Lyte.warn("A service has already been injected in the key named, ",e):(Lyte.toBeInjectedServices[e]=e,r[e]={service:e},Lyte.registeredServices[e]&&(Lyte.__gS[e]=new Lyte.registeredServices[e])):Lyte.warn("Invalid data passed to injectServices",e)});var t=Lyte.$.injectServices;for(var o in t)for(var a in r)t[o](a,r[a].service,o,Lyte.__gS[a],void 0,r[a].data)},Lyte.$.genMapId=function(e){for(var r=Math.floor(1e10*Math.random()+1);e.get(r);)r=Math.floor(1e10*Math.random()+1);return r.toString()},Lyte.$.toRemoveFromRequiredServices=function(e){var r=e.split("-"),t=r[r.length-1],o=t.length,a=e.substr(0,e.length-(o+1)),i=Lyte.requiredServices[a];i&&i.delete(t)},Lyte.toBeUsedServices=function(e){var r={},t=e.services;return t&&t.forEach(function(t){if("string"==typeof t)r[t]=t;else if(t&&"object"==typeof t){var o=t.as,a=t.service;Lyte._keywords.is(o,e.type)?Lyte.warn("Service cannot be used in any keywords of Lyte."):r[o]=a}}),r},Lyte.extendService=function(e){var r,t=Lyte.toBeUsedServices(e);for(var o in t)if(r=t[o],e.isGlobal&&Lyte.__gS.hasOwnProperty(o)||!e.isGlobal&&Lyte.registeredServices.hasOwnProperty(r)){var a=e.ins;e.isGlobal?Lyte.__gS[o]:new Lyte.registeredServices[r];Array.isArray(a)||(a=[e.ins]),a.forEach(function(t){t[o]=e.isGlobal?Lyte.__gS[o]:new Lyte.registeredServices[r]})}else Lyte.$.requiredServices(o,r,e.callback,e.type,e.name,e.isGlobal,e.data)},Lyte.$.requiredMixins=function(e,r,o){var a=t[e]?t[e]:t[e]={};a[o]?a[o].push(r):a[o]=[r]},Lyte.Mixin.exists=function(e){return!!Lyte.registeredMixins[e]},Lyte.log=function(e,r,t){Lyte.debug&&(t?console.log("%c"+e,"color:"+t):console.log(e))},Lyte.time=function(e){var r;Lyte.performance&&(-1!=(r=Lyte.$.consoleTime.indexOf(e))?(Lyte.$.consoleTime.splice(r,1),console.timeEnd(e)):(Lyte.$.consoleTime.push(e),console.time(e)))},Lyte.isRecord=function(e){return!!(e&&e.$&&e.$.hasOwnProperty("isModified"))},Lyte.isComponent=function(e){return!!(e&&e.$node&&e.__data)},Lyte.$.reqFiles={},Lyte.injectResources=function(e,r,t,o){var i=[],s=[];return r=r||function(){},t=t||function(){},new Promise(function(d,l){!function e(t,o){if(t){Array.isArray(t)||(t=[t]),t.length||o();var i=-t.length;t.forEach(function(t){"string"==typeof t?function(e,t,o){Lyte.$.reqFiles[e]?Lyte.$.reqFiles[e].push(o):(Lyte.$.reqFiles[e]=[o],t&&"error"!=t.event.type?(-1!=Lyte.removeFromCache.arr.indexOf(e)&&Lyte.removeFromCache.arr.splice(Lyte.removeFromCache.arr.indexOf(e),1),n.call(t.tag,e,t.event,!0),o()):function(e,t){var o,i=r.internal||{},s=a(e);if(i.file=e,null==s)return void Lyte.error("Type of file is not specified in injectResources.");(o=document.createElement("link")).setAttribute("href",e),i.tag=o,".css"==s?o.setAttribute("as","style"):o.setAttribute("as","script");o.setAttribute("rel","preload"),o.onerror=o.onload=function(e){t.call(this,e),this.onerror=this.onload=void 0},Lyte.triggerEvent("onBeforeInject",i),Lyte.$.assetsDiv.appendChild(o)}(e,function(t){Lyte.injectResources.respObj[e]=this,Lyte.$.reqFiles[e].forEach(function(e){e()}),n.call(this,e,t),r.call(this,t)}))}(t,Lyte.injectResources.availableTags[t],function(){s()}):Array.isArray(t)?new Promise(function(r){e(t,r)}).then(function(){s()}):(i--,new Promise(function(r){e(t.parent,r)}).then(function(){s()}),new Promise(function(r){e(t.child,r)}).then(function(){s()}))})}else o();function s(){0==++i&&o()}function n(e,r,t){delete Lyte.$.reqFiles[e],t||(Lyte.injectResources.availableTags[e]&&(Lyte.injectResources.availableTags[e].tag.remove(),delete Lyte.injectResources.respObj[e]),Lyte.injectResources.availableTags[e]={tag:this,event:r,type:r.type})}}(e,function(){o&&o.defer?(o.defer({injectJS:n,files:e,errorFiles:s}),d()):n(e,function(){t(i,s),s.length?l(i,s):d(i,s)})}.bind(this))});function n(e,r,t){if(t=t||[],e){Array.isArray(e)||(e=[e]),e.length||r(i,s);var o=-e.length;e.forEach(function(e){if("string"==typeof e){var r=a(e);!r||".js"!=r&&".css"!=r||-1!=t.indexOf(e)?d():(t.push(e),function(e,r){var t=Lyte.injectResources.respObj[e];if(Lyte.injectResources.availableTags[e]&&"preload"!=Lyte.injectResources.availableTags[e].tag.getAttribute("rel")){var o=Lyte.injectResources.availableTags[e];"error"==o.type?s.push(o.event):i.push(o.event),r()}else{var n,d=a(e);".js"==d?((n=document.createElement("script")).setAttribute("type","text/javascript"),n.setAttribute("src",e)):".css"==d&&((n=document.createElement("link")).setAttribute("type","text/css"),n.setAttribute("rel","stylesheet"),n.setAttribute("href",e)),t.getAttributeNames().forEach(function(e){-1==["href","as","rel"].indexOf(e)&&n.setAttribute(e,t.getAttribute(e))}),delete Lyte.injectResources.respObj[e],n.onerror=n.onload=function(t){"error"==t.type?s.push(t):i.push(t),Lyte.injectResources.availableTags[e].tag.remove(),Lyte.injectResources.availableTags[e]={tag:n,event:t,type:"error"==t.type?"error":"load"},r(),n.onerror=n.onload=void 0},Lyte.$.assetsDiv.appendChild(n)}}(e,function(){d()}))}else Array.isArray(e)?n(e,function(){d()}):(o--,n(e.parent,function(){n(e.child,function(){d()}),d()}))})}else r(i,s);function d(){0==++o&&r(i,s)}}},Lyte.injectResources.availableTags=[],Lyte.injectResources.respObj=[],Lyte.$.replaceOldInjectResource=function(){Lyte.injectResources=function(e,r,t){var o=[],i=[];return r=r||function(){},t=t||function(){},new Promise(function(t){!function e(t,s){if(t){Array.isArray(t)||(t=[t]),t.length||s();var n=-t.length;t.forEach(function(t){"string"==typeof t?function(e,t,s){Lyte.$.reqFiles[e]?Lyte.$.reqFiles[e].push(s):(Lyte.$.reqFiles[e]=[s],t&&"error"!=t.event.type?(-1!=Lyte.removeFromCache.arr.indexOf(e)&&Lyte.removeFromCache.arr.splice(Lyte.removeFromCache.arr.indexOf(e),1),l.call(t.tag,t.event,!0),s()):function(e,t){var s=a(e);if(tag=document.createElement({".js":"script",".css":"link"}[s]),!s)return void Lyte.error("Type of file is not specified in injectResources.");".css"==s?(tag.setAttribute("href",e),tag.setAttribute("type","text/css"),tag.setAttribute("rel","stylesheet")):tag.setAttribute("src",e);tag.onerror=tag.onload=function(e){"error"==e.type?i.push(e):o.push(e),t&&t.call(this,e)};var n=r.internal||{};n.file=e,n.tag=tag,Lyte.triggerEvent("onBeforeInject",n),Lyte.$.assetsDiv.appendChild(tag)}(e,function(t){Lyte.$.reqFiles[e].forEach(function(e){e()}),l.call(this,t),r.call(this,t)}))}(t,Lyte.injectResources.availableTags[t],function(){d()}):Array.isArray(t)?new Promise(function(r){e(t,r)}).then(function(){d()}):new Promise(function(r){e(t.parent,r)}).then(function(){new Promise(function(r){e(t.child,r)}).then(function(){d()})})})}else s();function d(){0==++n&&s()}function l(e,r){var t=this.getAttribute("src")||this.getAttribute("href");delete Lyte.$.reqFiles[t],r||(Lyte.injectResources.availableTags[t]&&Lyte.injectResources.availableTags[t].tag.remove(),this.onerror=this.onload=void 0,Lyte.injectResources.availableTags[t]={tag:this,event:{type:e.type}})}}(e,t)}).then(function(){t(o,i)})},Lyte.injectResources.availableTags=[],Lyte.injectResources.respObj=[]},Lyte.removeFromCache=function(e){Lyte.removeFromCache.assign(e),Lyte.removeFromCache.arr.length&&(Lyte.removeFromCache.arr.forEach(function(e){Lyte.injectResources.availableTags[e]&&(Lyte.injectResources.availableTags[e].tag.remove(),delete Lyte.injectResources.availableTags[e],delete Lyte.injectResources.respObj[e])}),Lyte.removeFromCache.arr=[])},Lyte.removeFromCache.arr=[],Lyte.removeFromCache.assign=function(e){e="*"==e?Object.keys(Lyte.injectResources.availableTags):Array.isArray(e)?e:[e],Lyte.removeFromCache.arr=Lyte.removeFromCache.arr.concat(e)},Lyte.$.prefetchSupport=!1;try{if(!Lyte.browser.ie){var i=document.createElement("link");Lyte.$.prefetchSupport=i.relList.supports("prefetch")&&i.relList.supports("preload")}}catch(e){}function s(){Lyte.assetsDivContainer.appendChild(Lyte.$.assetsDiv)}Lyte.$.prefetchSupport||(console.log("Prefetch is not supported. Falling back to old implementation"),Lyte.$.replaceOldInjectResource()),Lyte.checkProperty=function(e,r,t,o,a,i,s,n,d){switch(e){case"type":if(Lyte.Transform.hasOwnProperty(o)&&void 0!==r&&null!==r){var l=Lyte.Transform[o],c=!0;if(Array.isArray(r)){if("array"!=Lyte.Transform[o].extends)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o};l.hasOwnProperty("items")&&(c=Lyte.checkProperty("items",r,t,l.items))}else if("object"==typeof r&&"object"==Lyte.Transform[o].extends&&l.hasOwnProperty("properties"))c=Lyte.checkProperty("properties",r,t,l.properties);else if(Lyte.Transform[o].extends!=typeof r)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o};if(!0!==c)return c}else if(void 0!==r&&null!==r)if(Array.isArray(r)){if("array"!=o)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o}}else if(o!=typeof r)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o};break;case"mandatory":let a=o;if("object"==typeof o&&d&&1==o.skipValidationOnInit&&(a=!1),a&&(void 0==r||null==r||""===r))return{code:"ERR02",message:Lyte.errorCodes.ERR02};break;case"maximum":if("number"==typeof r&&r>o)return{code:"ERR04",message:Lyte.errorCodes.ERR04,expected:o};break;case"minimum":if("number"==typeof r&&r<o)return{code:"ERR05",message:Lyte.errorCodes.ERR05,expected:o};break;case"maxLength":case"maxItems":if(r&&r.length>o)return{code:"ERR06",message:Lyte.errorCodes.ERR06,expected:o};break;case"minLength":case"minItems":if(r&&r.length<o)return{code:"ERR07",message:Lyte.errorCodes.ERR07,expected:o};break;case"pattern":if("string"==typeof r&&!new RegExp(o).test(r))return{code:"ERR08",message:Lyte.errorCodes.ERR08,expected:o};break;case"uniqueItems":if(Array.isArray(r)&&o)for(var p=[],y=0;y<r.length;y++){var f=r[y];if(-1!=p.indexOf(f))return{code:"ERR09",message:Lyte.errorCodes.ERR09};p.push(f)}break;case"constant":if(Array.isArray(r)){if(!(m=r.length==o.length&&r.every(function(e,r){return e===o[r]})))return{code:"ERR10",message:Lyte.errorCodes.ERR10,expected:o}}else if("object"==typeof r){if(!(m=store.adapter.$.compareObjects(r,o)))return{code:"ERR10",message:Lyte.errorCodes.ERR10,expected:o}}else if(r&&r!=o)return{code:"ERR10",message:Lyte.errorCodes.ERR10,expected:o};break;case"items":if(Array.isArray(r))for(y=0;y<r.length;y++){o.any&&Array.isArray(o)||(o=[o]);for(var v=o.length,u=(c=!0,0);u<v;u++){l=o[u];for(var e in l){if(!0!==(m=Lyte.checkProperty(e,r[y],y,l[e],l))){!0===c&&(m.path=m.path?y+"."+m.path:m.path,c=m);break}}}if(!0!==c)return c}break;case"properties":if("object"==typeof r&&!Array.isArray(r))for(var t in r)if(o.hasOwnProperty(t)){var h=o[t];h.any&&Array.isArray(h)||(h=[h]);for(v=h.length,c=!0,y=0;y<v;y++){l=h[y];for(var e in l){if(1!=(m=Lyte.checkProperty(e,r[t],t,l[e],l))){!0===c&&(m.path=m.path?t+"."+m.path:t.toString(),c=m);break}}}if(!0!==c)return c}break;case"validation":var m;if(1!=(m=Lyte.customValidator[o].apply(i,[t,r,n])))return m;break;case"instanceof":if(!("object"!=typeof r||Array.isArray(r)||r instanceof o))return{code:"ERR30",message:Lyte.errorCodes.ERR30,property:t,instanceof:o}}return!0},Lyte.checkNestedProp=function(e,r,t,o,a,i,s,n,d){var l;if(Lyte.Transform[t.type]&&((t=Lyte.Transform[t.type]).type=t.extends),0!=r.length){if("array"==t.type)t.items&&!isNaN(r[0])&&"object"==typeof t.items&&(r=r.slice(1),Lyte.checkNestedProp(e,r,t.items,o,a,i,s,n,d));else if("object"==t.type&&t.properties&&t.properties.hasOwnProperty(r[0])){var c=r[0];r=r.slice(1),Lyte.checkNestedProp(e,r,t.properties[c],o,a,i,s,n,d)}}else if(t&&(t.properties||t.items)&&!n.hasOwnProperty("warn")){var p={__data:{}};t.properties?p.__data[i]=t.properties[i]:t.items&&o.index?p.__data[o.index]=t:p.__data[i]=t.items;var y=Lyte.validate(a,i,s,p),f=o.attr?o.attr:o.key,v=o.path.split("."),u=void 0==o.index&&i?o.path+(""!=o.path?".":"")+i:void 0!=o.index?o.path+(""!=o.path?".":"")+o.index:o.path;if(y&&"object"==(void 0===y?"undefined":typeof y)&&y.code){y.value=s,y.path=""!=o.path?o.path:i,o.isRec&&d&&void 0==o.key&&""!=o.path&&(f=o.path.split(".")[0],v.shift(),v=1==v.length&&v[0]==i?[]:v),o.Error&&o.Error[f]?o.Error[f].code&&o.Error[f].nested?o.Error[f].nested:o.Error[f].nested={}:o.Error[f]={nested:{}},o.Error[f].code="ERR34",o.Error[f].message=Lyte.errorCodes.ERR34,l=o.Error[f].nested,o._cmpErr[f]||(o._cmpErr[f]={}),o._cmpErr[f].code="ERR34",o._cmpErr[f].message=Lyte.errorCodes.ERR34;var h=o._cmpErr[f].path?o._cmpErr[f].path:[];""!=o.path&&v.forEach(function(e){l=l&&!l[e]?l[e]={}:l[e]}),void 0!=o.index?l[o.index]=y:l[i]=y,h.includes(u)||h.push(u),o._cmpErr[f].path=h}else{o.isRec&&d&&void 0==o.key&&(f=o.path.split(".")[0],v.shift(),v=1==v.length&&v[0]==i?[i]:v),l=o.Error[f]&&o.Error[f].nested?o.Error[f].nested:void 0;var m=o._cmpErr[f]||void 0;if(m&&m.path&&m.path.includes(u)){var $=m.path.indexOf(u);m.path.splice($,1)}if(l){o.index;var g=!0;u.split(".").forEach(function(e){l[e]&&l[e].code?(delete l[e],g=!(!l||0!=Object.keys(l).length)):l=l[e]}),1==g&&o.Error[f]&&o._cmpErr[f]&&(delete o.Error[f],delete o._cmpErr[f])}}(n.value&&n.value.hasOwnProperty("code")&&y.code||!n.value)&&(n.value=y)}o.index&&delete o.index},Lyte.types=["string","object","number","boolean","array"],Lyte.attr=function(e,r){var t={};if(t.type=e,void 0==r&&(r={}),-1==this.types.indexOf(e)&&!Lyte.Transform.hasOwnProperty(e))throw new Error("Not a valid field type - "+e);return Object.assign(t,r),t},Lyte.defineRelation=function(e,r,t){var o={type:"relation",relType:r,relatedTo:e};return t&&(o.opts=t),o},Lyte.belongsTo=function(e,r){return this.defineRelation(e,"belongsTo",r)},Lyte.hasMany=function(e,r){return this.defineRelation(e,"hasMany",r)},Lyte.Transform={},Lyte.customValidator={},Lyte.registerDataType=function(e,r){this.Transform.hasOwnProperty(e)?Lyte.warn("Custom Field Type - "+e+" -  already exists."):void 0!=r.extends&&-1!=Lyte.types.indexOf(r.extends)?this.Transform[e]=r:Lyte.error("Not a valid field type - "+r.extends)},Lyte.registerValidator=function(e,r){this.customValidator.hasOwnProperty(e)?Lyte.warn("Custom Validator with name - "+e+" - already exists"):this.customValidator[e]=r},Lyte.patterns={email:/^([A-Za-z0-9._%\-'+/]+@[A-Za-z0-9.-]+\.[a-zA-Z]{2,22})$/,url:/(^(ht|f)tp(s?):\/\/[0-9a-zA-Z][-.\w]*(:[0-9])*(\/?)([a-zA-Z0-9\-.?,:'/\\+=&amp;%$#_[\]@!()*;~]*)?$)/,ampm:/^(AM|PM|am|pm)$/,hour:/^(0?[0-9]|1[0-9]|2[0-4])$/,minute:/^(0?[0-9]|[1-5][0-9]|60)$/,boolean:/^(true|false|TRUE|FALSE)$/,alphaNumeric:/([a-zA-Z0-9])+/,alphabetsOnly:/([a-zA-Z])+/,numeric:/([0-9])+/,phoneNo:/^[0-9a-zA-Z+.()\-;\s]+$/},Lyte.validate=function(e,r,t,o,a){var i=o.__data[r],s=!1,n=i?i.type:void 0,d=i;if(d){d.any&&Array.isArray(d)||(d=[d]);for(var l=d.length,c=!0,p=0;p<l;p++){var y=d[p];for(var f in y)!0!==(s=Lyte.checkProperty(f,t,r,y[f],y,e,n,void 0,a))&&!0===c&&(c=s)}if(!0!==c)return c}return!1},Lyte.registerPattern=function(e,r){this.patterns[e]=r},Lyte.errorCodes={ERR01:"Primary key cannot be modified",ERR02:"Mandatory field cannot be empty",ERR03:"Type of value does not match the specified data type",ERR04:"Value is greater than the maximum value allowed",ERR05:"Value is less than the minimum value allowed",ERR06:"Length of string/array is greater than the maximum limit allowed",ERR07:"Length of string/array is less than the minimum limit allowed",ERR08:"String does not match the specified pattern",ERR09:"Values in array are not unique",ERR10:"Value is not equal to the specified constant",ERR11:"Model of related field is not defined",ERR12:"Model of backward relation is not defined",ERR13:"Record not found",ERR14:"Model does not match the related field model",ERR15:"Error in creating a record as a relation",ERR16:"Record with primary key already exists",ERR17:"Value cannot be changed because record has been deleted",ERR18:"Action not defined",ERR19:"Model not defined",ERR20:"Key not specified",ERR21:"'belongsTo' relationship expects a single object/id",ERR22:"Type not specified for polymorphic relation",ERR23:"Primary Key value not present",ERR24:"Error while relating record",ERR25:"Backward relation not present",ERR26:"Primary key value cannot be undefined or null",ERR27:"Observer can observe only string data type value, '{0}' value cannot be observed in the function named '{1}' in the component '{2}'",ERR28:"Unloaded record cannot be saved",ERR29:"Property not defined in the object",ERR30:"Error in variables declaration for Query",ERR31:"Query not registered for the Model",ERR32:"Property not defined in the object",ERR33:"Property's value is not an instanceof the mentioned class",ERR34:"Type definition for nested properties / items does not match with the value",ERR35:"A datatype mismatch has occurred for custom DataType '{0}'"},Lyte.registeredGlobalEvents=Lyte.__lyteRegisteredEvents={},Lyte.triggerEvent=function(){var e=Array.prototype.slice.call(arguments,1),r=arguments[0],t=!1,o=this.__lyteRegisteredEvents[r];if(o)for(var a=0;a<o.listeners.length;a++){var i=o.listeners[a];if(i)if(!1===i.apply(this,e)){t=!0;break}}else o=this.__lyteRegisteredEvents[r]={listeners:[]};var s=new CustomEvent(r,{detail:e});t||document.dispatchEvent(s)},Lyte.addEventListener=function(e,r){if("function"==typeof r){var t=this.__lyteRegisteredEvents[e];return t||(t=this.__lyteRegisteredEvents[e]={listeners:[]}),e+"-"+(t.listeners.push(r)-1)}Lyte.error("Second parameter to Lyte.Component.addGlobalEventListener() must be a function")},Lyte.removeEventListener=function(e){let r;if(e&&-1!=(r=e.lastIndexOf("-"))){var t=e.substring(0,r),o=e.substring(r+1),a=this.__lyteRegisteredEvents[t];a&&a.listeners[o]?a.listeners[o]=null:Lyte.error("No such listener registered")}else Lyte.error("listener unique id not specified / invalid")},Lyte.extendEventListeners=function(e){e&&"object"==typeof e&&!e.hasOwnProperty("__lyteRegisteredEvents")&&Object.defineProperties(e,{__lyteRegisteredEvents:{value:{}},addEventListener:{value:Lyte.addEventListener},removeEventListener:{value:Lyte.removeEventListener},triggerEvent:{value:Lyte.triggerEvent}})},Lyte.deepCopyObject=function(e){for(var r,t,o,a,i,s,n=[{source:e,target:Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e))}],d=[e],l=n[0].target,c=[l];r=n.shift();){for(t=Object.keys(r.source),o=0;o<t.length;o++)(a=Object.getOwnPropertyDescriptor(r.source,t[o]))&&(a.value&&"object"==typeof a.value?(i=a.value,a.value=Array.isArray(i)?[]:i instanceof Set?new Set:Object.create(Object.getPrototypeOf(i)),-1==(s=d.indexOf(i))?(d.push(i),c.push(a.value),Object.defineProperty(r.target,t[o],a),n.push({source:i,target:a.value})):(a.value=c[s],Object.defineProperty(r.target,t[o],a))):Object.defineProperty(r.target,t[o],a));Lyte.isRecord(r.source)&&(Object.defineProperty(r.target,"$",{value:{}}),r.target.$.isNew=r.source.$.isNew,r.target.$.isModified=r.source.$.isModified,r.target.$.isDeleted=r.source.$.isDeleted,r.target.$.pK=r.source.$.pK,r.target.$._attributes=r.source.$._attributes,r.target.$.isCloned=!0,r.target.$.model={_name:r.source.$.model._name},r.source.$.hasOwnProperty("deepNest")&&(r.target.$.deepNest=r.source.$.deepNest),r.source.$.hasOwnProperty("partialType")&&(r.target.$.partialType=r.source.$.partialType)),Array.isArray(r.source)&&r.source.partial&&Object.defineProperty(r.target,"partial",{value:r.source.partial})}return l},Lyte.nestScpId=1,Lyte.nestScp={},Lyte.__nestRef__={},Lyte.__nestScp__=new Map,Lyte.establishObjectBinding=function(e,r,t,o,a,i){var s,n,d,l=e.__component__&&e.__component__.component.__data?e.__component__.component.__data[r]:void 0;if(t){if(e&&!e.$&&e._scp)Array.from(e._scp.keys()).forEach(function(e){var r=Lyte.nestScp[e];s=store.modelFor(r.model)});else s=e.$.model;var c=!1;if(n=s&&s.fieldList&&s.fieldList.hasOwnProperty(r)?s.fieldList[r]:{}){var p=Lyte.Transform[n.type];p&&(p.hasOwnProperty("properties")||p.hasOwnProperty("items"))&&(c=!0)}if(!(n&&"relation"!==n.type&&n.watch||c)){if(e._scp)Array.from(e._scp.keys()).forEach(function(t){var o=e._scp.get(t).paths,a=Lyte.nestScp[t]||void 0;for(var s in i=a&&a.watch?a.watch:i,o){var n=s?s.split("."):[];n.push(r),Lyte.bindObj(e,r,t,n,new Map,void 0,l,i,!0)}});return}l=n}o&&e._scp&&e._scp.size&&Array.from(e._scp.keys()).forEach(function(t){var o=e._scp.get(t).paths,a=Lyte.nestScp[t]||void 0;for(var s in i=a&&a.watch?a.watch:i,o){var n=s?s.split("."):[];n.push(r),Lyte.bindObj(e,r,t,n,new Map,void 0,l,i,!0)}});var y=!1;if(l&&Lyte.Transform[l.type]){var f=Lyte.Transform[l.type];(f.hasOwnProperty("properties")||f.hasOwnProperty("items"))&&(l=Lyte.Transform[l.type],y=!0)}if((!t||n.watch||n.properties||n.items||i||y)&&e[r]){var v;e&&e.__component__?(e.__component__.__scpObj||Object.defineProperty(e.__component__,"__scpObj",{value:{}}),e.__component__,v=e.__component__.__scpObj):Lyte.isRecord(e)&&(e.$.__scpObj||Object.defineProperty(e.$,"__scpObj",{value:{}}),e,v=e.$.__scpObj);var u=v;if(v){var h=!1,m=!1;if(t)if(e[r]&&!Lyte.__nestScp__.has(e[r]))d={model:s._name,attr:r,pK:e.$.pK,Error:{}},h=!0;else{var $=Lyte.__nestScp__.get(e[r]),g=Lyte.__nestRef__[$]=Lyte.__nestRef__[$]||new Map,b=Lyte.$.genMapId(g);g.set(b,!0),Lyte.setRecBindMap(Lyte.nestScp[$],{model:s._name,attr:r,pK:e.$.pK,Error:{}}),u[r]=$+"_"+b}else if(e[r]&&!Lyte.__nestScp__.has(e[r])){var _=[];(R={}).key=r,R.dtype=e.__component__.component.__data[r],R._cmpErr=e.errors,R.Error={},_.push(R),d={data:e[r],PropsInfo:_},R.dtype.watch&&(d.watch=!0),m=!0}else{$=Lyte.__nestScp__.get(e[r]);var L=Lyte.nestScp[$];if(L){var R,O=L.PropsInfo;(R={}).key=r,R.Error={},R._cmpErr=e.errors,R.dtype=e.__component__.component.__data[r],R.dtype.watch&&(L.watch=!0),O.push(R)}g=Lyte.__nestRef__[$]=Lyte.__nestRef__[$]||new Map,b=Lyte.$.genMapId(g);g.set(b,!0),u[r]=$+"_"+b}if(d){var k=Lyte.nestScpId++;g=Lyte.__nestRef__[k]=Lyte.__nestRef__[k]||new Map,b=Lyte.$.genMapId(g);g.set(b,!0),Lyte.__nestScp__.set(e[r],k),h&&(Lyte.nestScp[k]={},Lyte.setRecBindMap(Lyte.nestScp[k],d),Lyte.nestScp[k].Error=d.Error),m&&(Lyte.nestScp[k]=d),Lyte.nestScp[k]._data=e[r],u[r]=u[r]||k+"_"+b;Lyte.bindObj(e,r,k,[],new Map,void 0,l,i)}}}},Lyte.removeNestScp2Bind=function(e,r){if((e=e.model).has(r.model)){var t=e.get(r.model);if(t.has(r.pK)){var o=t.get(r.pK);o.has(r.attr)&&o.delete(r.attr),o.size||t.delete(r.pK)}t.size||e.delete(r.model)}},Lyte.setRecBindMap=function(e,r){var t=e.model=e.model||new Map,o=r.model,a=r.pK,i=r.attr;o&&!t.has(o)&&t.set(o,new Map),t=t.get(o),a&&!t.has(a)&&t.set(a,new Map),t=t.get(a),i&&!t.has(i)&&t.set(i,!0)},Lyte.bindObj=function(e,r,t,o,a,i,s,n,d){a=a||new Map;var l=void 0!=r?e[r]:e,c=!1;if(d||o.length||Lyte.__nestScp__.get(e)!==t||delete Lyte.nestScp[t].cyclic,o.length>1&&l&&Lyte.nestScp[t]&&Lyte.nestScp[t].hasOwnProperty("data")&&Lyte.nestScp[t].data===l){if(a.get(l))c=!0;else try{JSON.stringify(l)}catch(e){c=!0}Lyte.checkAndAddBind(l,t,o,c)&&Lyte.estObjScp(l,t,o,c)}else{var p,y;if(s&&(s.hasOwnProperty("items")||s.hasOwnProperty("properties")?(p=s.items||s.properties,y=!0):void 0==n&&1==s.watch&&(n=s.watch)),p=n?void 0:p,Array.isArray(l)){if(a.get(l)?c=!0:(a.set(l,!0),l.forEach(function(e,r){o.push(r),(n||s&&s.hasOwnProperty("items")&&"object"==typeof s.items)&&Lyte.bindObj(l,r,t,o,a,void 0,p,n),o.pop()})),Lyte.checkAndAddBind(l,t,o,c))Array.isArray(n)&&(f=Lyte.checkEstablishingSCP(l,o,n)),(f||"boolean"==typeof n&&n||y)&&Lyte.estObjScp(l,t,o,c)}else if(l&&"object"==typeof l){var f;c=!1;if(a.get(l))c=!0;else for(var v in a.set(l,!0),l)o.push(v),(n||p&&p.hasOwnProperty(v))&&Lyte.bindObj(l,v,t,o,a,void 0,p?p[v]:void 0,n),o.pop();if(Lyte.checkAndAddBind(l,t,o,c))Array.isArray(n)&&(f=Lyte.checkEstablishingSCP(l,o,n)),(f||"boolean"==typeof n&&n||y)&&Lyte.estObjScp(l,t,o,c)}}},Lyte.checkAndAddBind=function(e,r,t,o){if(!e._scp||!e._scp.size)return!0;if(e._scp.size&&(e._scp.has(r)&&e._scp.get(r).paths.hasOwnProperty(t.join("."))))return o&&(Lyte.nestScp[r].cyclic=!0),!1;return!0},Lyte.estObjScp=function(e,r,t,o){e._scp||Object.defineProperty(e,"_scp",{value:new Map,enumerable:!1,configurable:!0});var a=e._scp;a.has(r)||a.set(r,{});var i=a.get(r);t=t?t.join("."):t;(i.paths=i.paths||{})[t]=!0;var s=Lyte.nestScp[r];s.cyclic||1!=o||(s.cyclic=!0)},Lyte.cmpObjs=function(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var t in e){if(!r.hasOwnProperty(t))return!1;if(0==Lyte.cmpData(e[t],r[t]))return!1}return!0},Lyte.cmpData=function(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;if(e===r)return!0;for(var t=e.length,o=0;o<t;o++)if(0==Lyte.cmpData(e[o],r[o]))return!1}else{if(e&&r&&"object"==typeof e&&"object"==typeof r)return e===r||Lyte.cmpObjs(e,r);if(e!==r)return!1}return!0},Lyte.nestScpRmPath=function(e,r){if(e&&e.paths)for(var t in e=e.paths)t.startsWith(r+".")&&delete e[t]},Lyte.nestScpRemove=function(e,r,t){var o=e._scp;if(o&&o.size){if(t){Lyte.nestScpRmPath(o.get(r),t);var a=o.get(r),i=a?a.paths:void 0;i&&!Object.keys(i).length&&o.delete(r)}else o.delete(r);o.size||delete e._scp}},Lyte.rmNestScp=function(e,r,t,o,a){if(Array.isArray(e))t.get(e)||(t.set(e,!0),e.forEach(function(e,o){Lyte.rmNestScp(e,r,t,void 0,a)})),Lyte.nestScpRemove(e,r,a);else if(e&&"object"==typeof e){if(!t.get(e))for(var i in t.set(e,!0),e)Lyte.rmNestScp(e[i],r,t,void 0,a);Lyte.nestScpRemove(e,r,a)}},Lyte.removeNestScp=function(e,r,t,o,a,i,s,n){i=i||new Map,r=Number.parseInt(r);var d=Lyte.nestScp[r],l=Lyte.__nestRef__[r];n&&d.model&&Lyte.removeNestScp2Bind(d,n),a?(l&&l.has(t)&&l.delete(t),(!l||l&&!l.size)&&(delete Lyte.__nestRef__[r],Lyte.__nestScp__.has(e)&&Lyte.__nestScp__.delete(e),Lyte.rmNestScp(e,r,i,!0,o),s||delete Lyte.nestScp[r])):Lyte.rmNestScp(e,r,i,!0,o)},Lyte.resolvePromises=function(e){if("string"==typeof e||e instanceof Promise)return e;if(Array.isArray(e))return function(e){var r=[],t=!1;if(e.every(function(e,r){return!(e instanceof Promise||e&&!Array.isArray(e)&&"object"==typeof e&&"function"==typeof e.then)||(t=!0,!1)}),!t)return Promise.resolve(e);return new Promise(function(t,o){Promise.all(e).then(function(o){e.forEach(function(e,t){r[t]=o[t]}),t(r)},function(e){o(e),Lyte.error("Error on resolve promises",e)})})}(e);if("object"==typeof e)return function(e){var r=[],t=[],o=Object.keys(e);if(o.forEach(function(o){var a=e[o];(a instanceof Promise||a&&!Array.isArray(a)&&"object"==typeof a&&"function"==typeof a.then)&&(r.push(o),t.push(a))}),t.length){var a={},i=new Promise(function(i,s){Promise.all(t).then(function(t){o.forEach(function(o){-1!=r.indexOf(o)?a[o]=t[r.indexOf(o)]:a[o]=e[o]}),i(a)},function(e){s(e),Lyte.error("Error on resolve promises",e)})});return i}return Promise.resolve(e)}(e)},"complete"===document.readyState||"interactive"===document.readyState?s():document.addEventListener("DOMContentLoaded",function(e){s()},!0);var n=XMLHttpRequest.prototype.send;function d(e,r,t,o){var a=Lyte.__nodeXHRMap=Lyte.__nodeXHRMap||new Map,i=a.get(r);i||a.set(r,new Map),i=a.get(r);var s=r.lyteState=r.lyteState||[],n=o||t;-1==s.indexOf(n)&&s.push(n),r.setAttribute("lyte-state","");var d=i.get(e);if(d||(i.set(e,[]),d=i.get(e)),o)return d.push({state:o}),{target:r,event:e};d.push({isXHR:!0,xhr:t});var c=function(o){4==t.readyState&&(l(t,e,r),t.removeEventListener("readystatechange",c))};t.addEventListener("readystatechange",c)}function l(e,r,t){var o=Lyte.__nodeXHRMap,a=o.get(t);if(a){var i=a.get(r);if(i&&i){var s=i,n=-1;if(s.every(function(r,t){return!(r&&r.isXHR&&r.xhr==e||"string"==typeof e&&r.state==e)||(n=t,!1)}),-1!=n){s.splice(n,1);var d=t.lyteState.indexOf(e);if(t.lyteState.splice(d,1),!s.length){a.delete(r);var l=t&&Array.isArray(t.lyteState)?t.lyteState.indexOf(e):-1;-1!=l&&t.lyteState.splice(l,1),t&&t.lyteState&&0==t.lyteState.length&&(t.lyteState=null,t.removeAttribute("lyte-state"))}a.size||o.delete(t)}}}}XMLHttpRequest.prototype.send=function(){var e,r=window.event,t=r?r.target:void 0;if(Lyte.getConfig("stateHandling"))if(r)e=r.type,/^(click|dblclick)$/.test(e)&&t&&t.getAttribute&&"false"!=t.getAttribute("lyte-state-handling")&&d(e,t,this);else{var o=Lyte&&Lyte.Router?Lyte.Router.getRouteInstance():void 0;if(o){var a=o.transition?o.transition.ev:void 0;if(a&&a.target&&a.target.getAttribute&&"false"!=a.target.getAttribute("lyte-state-handling"))(Lyte.__transXHRMap=Lyte.__transXHRMap||new Map).set(o.transition,{currentAction:a,XHR:this}),d(a.type,a.target,this)}}n.apply(this,arguments)},Lyte.addEventListener("transitionStart",function(e){var r=e.nextTrans;r&&e.prevTrans&&(window.event&&/^(click|dblclick)$/.test(window.event.type)?(r.ev=window.event,e.prevTrans.ev&&delete e.prevTrans.ev):409!=e.prevTrans.state&&308!=e.prevTrans.state||!e.prevTrans.ev||(r.ev=e.prevTrans.ev,delete e.prevTrans.ev))}),Lyte.addEventListener("afterRouteTransition",function(e){if(e&&e.trans){var r=Lyte.__transXHRMap,t=!1;if(409==e.trans.state||308==e.trans.state){var o=window.event,a=e.trans.ev;if(!o||o&&a&&o!=a&&o.target==a.target&&o.type==a.type?e.trans.nested=!0:t=!0,r){var i=r.get(e.trans);i&&(l(i.XHR,i.currentAction.type,i.currentAction.target),r.delete(e.trans))}}else 200==e.trans.state&&(r&&r.delete(e.trans),t=!0);t&&e.trans.ev&&delete e.trans.ev}}),Lyte.addEventListener("beforeRouteTransition",function(e){e&&e.prevTrans&&e.prevTrans.nested&&(e.trans.ev=e.prevTrans.ev,delete e.prevTrans.ev,e.trans.fromPrevTrans=!0)}),Lyte.setState=function(e){e||console.error("Please provide a state name");var r=window.event;if(/^(click|dblclick)$/.test(r.type)){var t=r.target;if(1==Lyte.getConfig("stateHandling")&&t&&t.getAttribute&&"false"!=t.getAttribute("lyte-state-handling"))if(!t.getAttribute("lyte-state")){var o=Lyte.__stateMap=Lyte.__stateMap||new Map;if(o.get(e))console.error("There is already a open state by the name",e);else{var a=d(r.type,t,void 0,e);o.set(e,a)}}}},Lyte.removeState=function(e){e||console.error("Please provide a state name");var r=Lyte.__stateMap;if(r){var t=r.get(e);t&&(r.delete(e),l(e,t.event,t.target))}},Lyte.setConfig=function(e,r){(Lyte.__config=Lyte.__config||{})[e]=r},Lyte.getConfig=function(e){var r=Lyte.__config;if(r)return r[e]},Lyte.establishWatchScope=function(e,r){var t;for(var o in e){var a=o,i=e[o];if(this.component&&this.component.__data&&this.component.__data[a]){t=this.getData(a),i=!!this.component.__data[a].watch||i,"object"==typeof t&&Lyte.establishObjectBinding(this.component.data,o,!1,void 0,void 0,i);var s=this.component.__data;Lyte.nestScp[Lyte.__nestScp__.get(t)]&&(s[o].watch=i)}else if(r){var n=r.fieldList;n[o]&&void 0==n[o].watch&&(n[o].watch=i,r._fldGrps.watch[o]=n[o])}}},Lyte.checkEstablishingSCP=function(e,r,t){if(Array.isArray(t)){var o;if(o=r.join("."),Lyte.checkWatchPath(o,t,!0)&&"object"!=typeof e)return!0;for(var a=Object.keys(e),i=0;i<a.length;i++){var s=a[i],n=""==o?s:o+"."+s;if(Lyte.checkWatchPath(n,t,!0))return!0}}},Lyte.checkWatchPath=function(e,r,t){if("boolean"==typeof r&&!0===r)return!0;if(Array.isArray(r))for(var o=0;o<r.length;o++){var a=r[o],i=-1!=(a=(a=(a=a.replace(/ /g,"")).replace(/\$\.\./g,"..")).replace(/\$\./g,"")).search(/\.\./g)||-1!=a.search(/\[|\\]|\{|\}/g)||a.includes("*");if(e==a)return!0;if(i){if(t&&-1!=a.search(/\.\./)&&"..*"==(a=a.replace(/\.\.\S+/g,"..*")))return!0;if(a=(a=(a=0==(a=0==a.search(/\[/)?a.replace("[",""):a).search(/\.\.\[/)?a.replace("..[",".."):a).replace(/\.*\[/g,".")).replace(/\]/g,""),Lyte.checkWeirdPath(a,e))return!0}}},Lyte.checkWeirdPath=function(e,r){if(r==e)return!0;if(e.includes("..")||e.includes("*")){var t=e;t=(t=(t=(t=(t=t.replace(/\*/g,"$$")).replace(/\.\./g,"::")).replace(/\./g,"\\.")).replace(/\:\:/g,"\\.?.*\\.?")).replace(/\$/g,".*");var o=e.split("."),a=o.length;return""==o[a-2]&&"*"!=o[a-1]&&(t+="$"),!!new RegExp(t).test(r)}}}(),Lyte.registerErrorCodes({LD01:"Primary key value might be missing in the response data that is received, {0}",LD02:"{0} - {1} is not registered",LD03:"Cannot set the error {0} for {1}",LD04:"No such record to merge, {0}",LD05:"Model( {0} ) of related property - {1} not found in model - {2}",LD06:"Backward relation not present in model( {0} ), for the property {1} of model( {2} )",LD07:"{0} type not handled in handleArrayOperations",LD08:"{0} {1} will be deprecated from next version {2}",LD09:"deserializeKey cannot be processed for payload with more than two keys. Please use payloadKey callback instead or try modifying the same in normalizeResponse callback",LD10:"Response data not in a format lyte data store expects",LD11:"Deprecation Warning! findRecord response payload will not accept an array. It will be deprecated from the next version",LD12:"Response ( {0} ) is not in a format, lyte data store expects",LD13:"Response processing failed in {0} for model-{1} {2}, since invalid data is received in {1}(modelName) key of the data",LD14:"Cannot register {0} - {1}, as it already exists.",LD15:"Primary key value might be missing in the response data that is received, {0}",LD16:"Record merge failed for the record in model - {0} with primaryKey value - {1}, since either the persisted(saved) primary key value for a newly created record is not received from server or not in the proper structure to merge",LD17:"Record with the primary key value already exists",LD18:"No { 0 } present",LD19:"Deprecation Warning! findAll will not accept response payload values other than an array or any empty value. Current implementation which allows this will be deprecated from the next version",LD20:"Record cannot be saved as a state, when it is not either a new or a modified record or in a error state.",LD21:"No such state ( {0} ) saved for the record.",LD22:"For create / createRecord, response with a primary key value should be received",LD23:"PrimaryKey field {1} in {0} cannot have default value",LD24:"Response couldn't be parsed, {0}",LD25:"Cannot create record for the data - {0}",LD26:"Only one baseKey is allowed for a model",LD27:"Record merge failed, since the data passed is invalid - {0}",LD28:"Record merge failed for the model - {0}, since a valid primary key value is not found in the data to be merged - {1}",LD29:"Unloaded record-{0} of the model-{1} is being saved",LD30:"Variable value in query is mandatory for {0}",LD31:"Datatype defined for {0} is mismatch with the value's datatype",LD32:"Query '{0}' was not registered for the model '{1}"});var $Record=function(){Object.assign(this,{inIDB:!1,isPersisted:!0,isUnloaded:!1,isModified:!1,isNew:!1,isDeleted:!1,isError:!1,events:[],validatedOnCreate:!0,error:{}})},Record=function(e,r,t,o){var a=store.modelFor(e),i=t?t.delayPersistence:store.$.getFromCB("adapter",e,"delayPersistence");Object.assign(this,r),Object.defineProperties(this,{$:{writable:!0,value:new $Record}});var s=store.$.getpKVal(this,a);o&&Object.defineProperties(this.$,{isCloned:{value:!0,writable:!1},donor:{value:store.peekRecord(e,s)}}),Object.defineProperties(this.$,{pK:{value:s,writable:!0},model:{value:a},_attributes:{value:{},writable:!0},_relationships:{value:{},writable:!0},isDirty:{value:function(){var e,r=this.record;return!!r.$.isModified||!!(e=store.$.isDirty(r,this.model.relations)).length&&e}},undoStack:{value:store.$.genUnRedoStack(),writable:!0},redoStack:{value:store.$.genUnRedoStack(),writable:!0},delayPersistence:{value:i}}),this.$.record=this;var n=store.$.saveParent;n&&this!==n&&store.$.defProp(this.$,"parent",n);var d=a._fldGrps.default,l=a._fldGrps.watch,c=a._fldGrps.hasMany,p=a._fldGrps.nested_prop;for(var y in d){var f=d[y],v=r[y];void 0!==v&&""!==v||(this[y]=store.$.getDefaultVal(this,f.default))}for(var u in l)Lyte.establishObjectBinding(this,u,!0,void 0,void 0,!0);for(var h in p)Lyte.establishObjectBinding(this,h,!0,void 0,void 0,h&&h.watch?h.watch:void 0);for(var m in c){var $=c[m];if(this.hasOwnProperty(m))this[m]=Array.isArray(this[m])?Array.from(this[m]):this[m];else if(store.modelFor($.relatedTo)&&!o){store.$.getFromCB("serializer",$.relatedTo,"initHasManyRelation")&&(this[m]=[])}}var g=a._properties;Object.keys(g).length&&(this._bindings||store.$.defProp(this,"_bindings",new Set,!1,!0),this._bindings.add(g),store.$.establishObserverBindings(this,g))};Object.defineProperties($Record.prototype,{get:{value:function(e){return Lyte.Component&&Lyte.Component._get?Lyte.Component._get(this.record,e):this.record[e]}},set:{value:function(e,r,t){return this.isDeleted?store.$.setRecErr(this,this.model._pK,"ERR17"):store.$.setData(this,e,r,t),this.record}},getDirtyAttributes:{value:function(){var e=[],r=this._attributes;if(Object.keys(r).length)for(var t in r)e.push(t);return e}},rollBackAttributes:{value:function(e,r){Array.isArray(e)||(e=[e]);for(var t=this.record,o=[],a=this.model,i=this._attributes,s=0;s<e.length;s++){var n=e[s];if(i.hasOwnProperty(n)){var d=a.fieldList[n],l=i[n];if("relation"==d.type)store.$.rllBckRecArr(l,t,a,d),(t.$.dN&&t.$.dN.hasOwnProperty(n)?t.$.dN[n]:new Map).forEach(function(e,r){store.$.deleteDeepNest(t,n,r)});else store.$.cmpSet(t,n,l,void 0,!0);o.push(n),delete i[n]}store.$.clrRecErr(this,n)}if(Object.keys(this._attributes).length||(this.hasOwnProperty("dN")&&(!this.dN||Object.keys(this.dN).length)||t.$.isNew||store.$.removeParentNesting(t,"modified"),store.$.cmpSet(this,"isModified",!1),store.$.changePersist(t,!0),this.isNew||store.$.deleteFromArray(a.dirty,this.get(a._pK))),o.length>0){var c=[t,o];this.emit("change",c),a.emit("change",c),this.undoStack=store.$.genUnRedoStack(),this.redoStack=store.$.genUnRedoStack()}}},rollBack:{value:function(e,r){var t=this.model,o=(t._pK,new Map);r=!1!==r&&(t._fldGrps.inherit&&Object.keys(t._fldGrps.inherit).length),e?(this.rollBackState(e,r),store.$.removeOnSave(this.model._name,this.record.$.pK)):(r&&store.$.rBinherit(this,o,""),store.$.rollBackRecord(this))}},deleteRecord:{value:function(e){var r=this.model,t=this.record;e=void 0!==e?e:t.$.delayPersistence?t.$.delayPersistence.delete:void 0;store.$.removeFromStore(r,t.$.pK,void 0,void 0,e)}},destroyRecord:{value:function(e,r,t,o){return this.deleteRecord(t),this.save(e,r,"destroyRecord",void 0,o)}},addEventListener:{value:function(e,r){return store.$.eventListeners.add(this,e,r)}},removeEventListener:{value:function(e){store.$.eventListeners.remove(this,e)}},emit:{value:function(e,r){store.$.eventListeners.emit(this,e,r)}},triggerAction:{value:function(e,r,t,o,a){var i=this.model,s=i.actions;return(s?s[e]:void 0)?store.adapter.$.handleAction(e,i,this.record,r,t,o,a):Promise.reject({code:"ERR18",message:Lyte.errorCodes.ERR18,data:e})}},save:{value:function(e,r,t,o,a){var i=this;if(this.isCloned){if(this.isUnloaded)return Promise.resolve();i=store.$.savingDonorRecord(this)}var s,n=i.model,d=i.record,l=i.isDirty(),c=t&&t.validateOnSave,p=t&&t.skipValidation,y=n.fieldList;if(!0!==i.isUnloaded)if(i.isDeleted){if(!i.isNew)return store.adapter.$.del(n._name,d,!0,o,e,r,a)}else{if(i.isNew){var f=i;return p||d.$.validatedOnCreate&&!c||(s=store.$.validateRecord(i.record,y)),!p&&(0==s||f&&f.error&&Object.keys(f.error).length>0)?Promise.reject(f.error):store.adapter.$.create(n._name,d,!0,e,r,a)}if(i.isModified||l&&l.length){if(!p&&t&&c&&(s=store.$.validateRecord(i.record,y)),!p&&(0==s||d&&d.$&&d.$.isError))return Promise.reject(d.$.error);var v=store.$.updateJSON(i.record,n,l);return store.adapter.$.put(n._name,v,d,!0,e,r,a)}}else if(Lyte.warn("LD29","object"==typeof d.$.pK?JSON.stringify(d.$.pK):d.$.pK,n._name),store.$.getFromCB("adapter",n._name,"rejectUnloadRecordSave"))return Promise.reject({code:"ERR28",message:Lyte.errorCodes.ERR28,data:d});return Promise.resolve()}},getInitialValues:{value:function(e){var r=!1;e?(Array.isArray(e)||(e=[e]),r=!0):e=this.getDirtyAttributes();for(var t={},o=this.record,a=this._attributes,i=0;i<e.length;i++)if(void 0!=o[e]&&o[e[i]].add){t[e[i]]=o[e[i]].slice(0);for(var s=a[e[i]],n=o[e[i]].model._pK,d=s.length-1;d>=0;d--)if("added"==s[d]._type)for(var l=0;l<s[d].records.length;l++){var c=store.$.getIndex(t[e[i]],n,s[d].records[l].$.pK);-1!=c&&t[e[i]].splice(c,1)}else if("removed"==s[d]._type)for(l=s[d].records.length-1;l>=0;l--)t[e[i]].splice(s[d]._indices[l],0,s[d].records[l]);else"changed"==s[d]._type&&(t[e[i]]=Array.isArray(s[d].records)?Array.from(s[d].records):s[d].records)}else t[e[i]]=a[e[i]];return r?t[e[0]]:t}},toJSON:{value:function(e,r){var t=!0;return r=!!r,"object"==typeof e&&0==e.inherit&&(t=e.inherit),Object.assign({},store.$.toJSON(this.model._name,this.record,e||!0,void 0,void 0,t,r))}},undo:{value:function(e,r){var t=this.undoStack._order_.length;for(r=r||(t?t-1:t);t-- >r;)store.$.unredoOp(1,this,e)}},getCurrentState:{value:function(){return this.undoStack._order_.length}},redo:{value:function(e){store.$.unredoOp(2,this,e)}},validate:{value:function(e){var r={},t=this.model.fieldList;Array.isArray(e)&&e.forEach(function(e,o){t[e]&&(r[e]=t[e])}),0==Object.keys(r).length&&(r=t);var o=this.record;store.$.validateRecord(o,r)}},saveState:{value:function(e){if(this.isNew||this.isModified){for(var r,t=this._savedState=this._savedState||{},o=e;!o;)r=Math.floor(1e5*Math.random()+1),o=t.hasOwnProperty(r)?o:r;var a=this.toJSON("state");store.$.defProp(a,"$",{},!1,!0),this.model._arrPk.forEach(function(e){delete a[e]});var i=this.undoStack,s=this.redoStack,n=this._attributes;if(i&&Object.keys(i).length){var d=i._order_;i=a.$.undoStack=store.$.deepCopyStack(i),store.$.defProp(i,"_order_",Lyte.deepCopyObject(d),!1,!0)}if(s&&Object.keys(s).length){d=s._order_;s=a.$.redoStack=store.$.deepCopyStack(s),store.$.defProp(s,"_order_",Lyte.deepCopyObject(d),!1,!0)}return n&&Object.keys(n).length&&(a.$._attributes=store.$.deepCopyAttrs(this.model,n)),this._savedState[o]=a,o}Lyte.warn("LD20")}},clearState:{value:function(e){e?delete this._savedState[e]:this._savedState={}}},rollBackState:{value:function(e,r){var t=this._savedState,o=t?t[e]:void 0;o?(this.dN&&(this.dN={}),store.$.setData(this,o,void 0,void 0,{},!0,r),store.$.updateDn(this.record),this.undoStack=o.$.undoStack||store.$.genUnRedoStack(),this.redoStack=o.$.redoStack||store.$.genUnRedoStack(),this._attributes=o.$._attributes||{},store.$.checkAttrs(this.record),delete this._savedState[e]):Lyte.warn("LD21",e)}},hasSavedState:{value:function(e){return!(!this._savedState||!this._savedState.hasOwnProperty(e))}},persist:{value:function(e){var r,t,o=this.model._name,a=this.record,i={obj:new Map};if(this.isNew)r="create",store.$.toJSON(o,a,void 0,r,i);else if(t=this.isDirty()){var s=store.$.updateJSON(a,this.model,t);store.$.toJSON(o,s,void 0,void 0,i)}var n=i.obj.get(this.pK);store.adapter.$.mergeResponse(a,this.model,void 0,this.pK,n,!0),store.adapter.$.updateIDB(o,r||(a.$.isDeleted?"deleteRecord":a.$.isModified||t?"updateRecord":void 0),a)}},clone:{value:function(){var e=this.record,r=this.record.$.toJSON({type:"isClone"});return store.$.insertIntoStore(e.$.model._name,r,void 0,void 0,void 0,void 0,void 0,{type:"isClone"})}}});var Model=function(e,r){Object.assign(this,{_name:e,fieldList:{id:{type:"string",primaryKey:!0,defined:!1}},relations:{},_properties:{},_fldGrps:{default:{},hasMany:{},watch:{},inherit:{},nested_prop:{},inverse:{},JsonPathWatch:{}},data:[],dirty:[],_deleted:new Map,events:{}}),store.$.defProp(this.data,"_recMap",new Map);var t=[];for(var o in r)store.$.registerField(this,o,r[o],t);this._pK||(this._pK="id"),this.isComp=!1;var a=this._pK.split(",");a.length>1&&(this.isComp=!0),this._arrPk=a,"undefined"!=typeof Lyte&&(Lyte.establishObserverBindings(t,!0,this._properties,this),Lyte.establishWatchScope(this._fldGrps.JsonPathWatch,this)),store.$.defArrUtls(this.data),store.$.defUtls(this.data,this),store.$.defProp(this,"extends",store.$.extendModel)};Model.prototype.addEventListener=function(e,r){return store.$.eventListeners.add(this,e,r)},Model.prototype.removeEventListener=function(e){store.$.eventListeners.remove(this,e)},Model.prototype.emit=function(e,r){store.$.eventListeners.emit(this,e,r)},Model.prototype.on=function(e,r){return this.addEventListener(e,r)},Model.prototype.setGql=function(e,r,t){store.$.setQuery(this,r,e,t)};var store={model:{},$:{idbOpen:!0,request:{},toRelate:{},idbQueue:[],idbQ:{},idbQ2:{},nestScp:{},nestScpId:1,getAdapter:function(e){if("application"==e.name)return store.adapter[e.name];if(e.model||e.name){var r=e.model||store.model[e.name];if(r&&r.extend&&!store.adapter.hasOwnProperty(r._name))return store.adapter[r.extend];var t=r?r._name:e.name;return store.adapter[t]}},registerModel:function(e,r,t){if(store.model.hasOwnProperty(e))return Lyte.warn("LD14","Model",e),Lyte._postRegister(),{error:Lyte.getErrorMessage("LD14","Model",e),extends:function(){}};try{var o,a,i,s;if(t&&"object"==typeof t&&(o=t.extends||void 0,a=t.actions||void 0,i=t.idb||void 0,s=t.gql||void 0),o){var n=Object.assign({},store.model[o].fieldList);for(var d in n)"relation"==n[d].type&&delete n[d];r=Object.assign(r,n)}var l=store.model[e]=new Model(e,r);o&&store.$.extendModel(o,l),a&&(l.actions=a),i&&(l.idb=i),s&&(l.gql=s),Lyte._postRegister()}catch(e){Lyte._postRegister()}return l},changePersist:function(e,r){if(!e.$.isUnloaded||e.$.isPeristed!==r)switch(r){case!0:e.$.isNew||e.$.isModified||e.$.isDeleted||store.$.cmpSet(e.$,"isPersisted",!0);break;case!1:(e.$.isNew||e.$.isModified||e.$.isDeleted||e.$.dN&&Object.keys(e.$.dN)&&Object.keys(e.$.dN).length)&&store.$.cmpSet(e.$,"isPersisted",!1)}},getFromCB:function(e,r,t){var o,a=store[e];/^(adapter|serializer)$/.test(e)&&store.model.hasOwnProperty(r)&&store.model[r].extend&&(o=store.model[r].extend);for(var i=a&&a.hasOwnProperty(r)?a[r]:o&&a.hasOwnProperty(o)?a[o]:void 0,s=i?i[t]:void 0;void 0===s;)if(i&&i.$super)s=(i=i.$super)?i[t]:void 0;else{if(i||(i=a.application),!i||!i.hasOwnProperty(t)){if("adapter"==e){switch(t){case"host":s=window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.host;break;case"namespace":s="";break;case"actionNamespace":s="action";break;case"batchNamespace":s="batch";break;default:s=void 0}break}break}if(s=i[t],!i&&!s)break}return s},newCB:function(e,r,t,o,a){for(var i in r.__extendedBy=[],o)r[i]=o[i];store.$.extendOptions(a,e,t,r,store),store.$.lazyExtend(e,r,t),store.$.defProp(r,"is",e),store.$.defProp(r,"__name",t)},extendOptions:function(e,r,t,o,a){e&&e.mixins&&e.mixins.length&&e.mixins.forEach(function(e){if(Lyte.Mixin.exists(e)){var i=Lyte.registeredMixins[e];for(var s in i)o[s]=i[s]}else Lyte.$.requiredMixins(e,{name:t,scope:a},r)});var i=e?e.services:[];if(store.$.extendService(i,r,t,o,a),Lyte.toBeInjectedServices){var s=Lyte.toBeInjectedServices,n=[];for(var d in s)n.push({as:d,service:s[d]});store.$.extendService(n,r,t,o,a,!0)}},extendService:function(e,r,t,o,a,i,s){Lyte.extendService({services:e,type:r,name:t,ins:o,isGlobal:i,data:s,callback:function(e,t,o){Lyte.$.lazyRegisterService(i?e:new e,{scope:a,type:r,name:o,key:t})}})},lazyExtend:function(e,r,t){var o=store[e];if(o.__toAddSuper&&o.__toAddSuper.hasOwnProperty(t)){for(var a=o.__toAddSuper[t],i=0;i<a.length;i++){var s,n=o[a[i]];if(n&&n.is==e)n.$super=r,r.__extendedBy.push(a[i]),"application"!=t&&(o.__toAddSuper.application&&(s=o.__toAddSuper.application.indexOf(n.__name))>-1&&o.__toAddSuper.application.splice(s,1),o.application&&(s=o.application.__extendedBy.indexOf(n.__name))>-1&&o.application.__extendedBy.splice(s,1))}delete o.__toAddSuper[t]}},cbDef:function(e,r){Object.defineProperties(e.prototype,{super:{value:function(){return store.$.super.call(this,arguments)}},extends:{value:function(e){store.$.extendCallback.call(this,store,r,e)}}})},changeRelPkMaps:function(e,r,t,o,a){var i=e.$.model,s=i.relations;for(var n in s)for(var d=s[n],l=d.length,c=0;c<l;c++){var p=d[c],y=p.relKey,f=p.relType;if(e.hasOwnProperty(y)){var v,u=e[y],h=store.model[p.relatedTo];if(h&&(v=store.$.getBackwardRel(i,p,h))&&"hasMany"==v.relType)if(w=v.opts&&v.opts.sort&&v.opts.sort.sortFn&&v.opts.sort.observes,"belongsTo"==f&&Lyte.isRecord(u))switch(o){case"sort":case"srtObsChk":if(u&&Array.isArray(u[v.relKey]))if("sort"==o)w&&-1!=v.opts.sort.observes.indexOf(a)&&store.$.handleArrOp(u[v.relKey],"sort");else if(a!==v.relKey)return!0;break;default:u[v.relKey]&&u[v.relKey]._recMap&&u[v.relKey]._recMap.delete(r)&&u[v.relKey]._recMap.set(t,e)}else if("hasMany"==f&&Array.isArray(u))for(var m=u.length,$=0;$<m;$++){var g=u[$];switch(o){case"sort":case"srtObsChk":if(g&&Array.isArray(g[v.relKey]))if("sort"==o)w&&-1!=v.opts.sort.observes.indexOf(a)&&store.$.handleArrOp(g[v.relKey],"sort");else if(a!==v.relKey)return!0;break;default:Lyte.isRecord(g)&&g[v.relKey]&&g[v.relKey]._recMap&&g[v.relKey]._recMap.delete(r)&&g[v.relKey]._recMap.set(t,e)}}}}var b=e.$._relationships;for(var _ in b){var L=b[_],R=store.modelFor(_);for(var y in L)for(var O=L[y],k=R.fieldList[y],w=k.opts&&k.opts.sort&&k.opts.sort.sortFn&&k.opts.sort.observes,A=O.length,P=0;P<A;P++){var j=(g=O[P])[y];if(Array.isArray(j))switch(o){case"sort":case"srtObsChk":if(Array.isArray(j))if("sort"==o)w&&-1!=k.opts.sort.observes.indexOf(a)&&store.$.handleArrOp(j,"sort");else if(a!==k.relKey)return!0;break;default:j._recMap&&j._recMap.delete(r)&&j._recMap.set(t,e)}}}},updateNestScp:function(e,r){if(Lyte.isRecord(e)){var t=e.$.__scpObj||{};for(var o in t){if(i=(i=t[o]).split("_")[0],Lyte.nestScp&&Lyte.nestScp.hasOwnProperty(i)&&Lyte.nestScp[i].model){var a=Lyte.nestScp[i].model.get(e.$.model._name);if(a.has(r)){var i=a.get(r);a.delete(r),a.set(e.$.pK,i)}}}}},getDefaultVal:function(e,r){return"function"!=typeof r?r:r.call(e)},deepValueChange:function(e,r,t,o){var a={emit:!1,attr:[],oldRec:{}};store.$.estAttrs(e,r,t,a,o),store.$.checkAttrs(e),store.$.changeCallbck(e,a)},updateDn:function(e){var r=e.$.model.relations;for(var t in r){r[t].forEach(function(r){var t=r.opts,o=r.relKey,a=r.relType;if(t&&t.deepNest&&e.hasOwnProperty(o)){var i=e[o];"belongsTo"==a&&(i.$.isModified||i.$.dN&&Object.keys(i.$.dN).length)?store.$.setDeepNest(e,o,i.$.pK,"updated"):"hasMany"==a&&Array.isArray(i)&&i.forEach(function(r){(r.$.isModified||r.$.dN&&Object.keys(r.$.dN).length)&&store.$.setDeepNest(e,o,r.$.pK,"updated")})}})}},genUnRedoStack:function(){var e={};return store.$.defProp(e,"_order_",[],!1),e},deepCopyStack:function(e){if(e&&"object"==typeof e)for(var r in e=Object.assign({},e))if(Array.isArray(e[r])){var t=e[r]=Array.from(e[r]);t.forEach(function(e,r){t[r]=Object.assign(e)})}return e},deepCopyAttrs:function(e,r){var t=e.fieldList;r=Object.assign({},r);for(var o in r){var a=r[o];t[o]&&"relation"==t[o].type&&Array.isArray(a)&&(a=r[o]=Array.from(a)).forEach(function(e,r){a[r]=Object.assign({},e),e.hasOwnProperty("records")&&e.records&&(e.records=Array.from(e.records)),e.hasOwnProperty("_indices")&&e._indices&&(e._indices=Array.from(e._indices))})}return r},addTo_Del:function(e,r,t){var o={index:t,data:r};(e._deleted=e._deleted||new Map).set(r.$.pK,o)},scExtd:function(e,r,t,o){var a="adapter"==e?store.adapter:store.serializer;if(r)return a.hasOwnProperty(r)?(Lyte.warn("LD14",e,r),{error:Lyte.getErrorMessage("LD14",e,r),extends:function(){}}):(a[r]="adapter"==e?new Adapter(t,o,r):new Serializer(t,o,r),a.application&&"application"!=r&&(a[r].$super=a.application,a.application.__extendedBy.push(r)),a.application||"application"==r||(a.__toAddSuper=a.__toAddSuper||{},a.__toAddSuper.hasOwnProperty("application")||(a.__toAddSuper.application=[]),a.__toAddSuper.application.push(r)),a[r])},initCB:function(e,r,t,o){var a=store.$.cbScp(r,t,e),i=o.args,s={};if(a)return s.data=store.$.cB(a,i),s},cB:function(e,r){return e.func.apply(e.scope,r.concat(e.name))},cbScp:function(e,r,t){var o,a=store[t],i=a.application;/^(adapter|serializer)$/.test(t)&&store.model.hasOwnProperty(e)&&store.model[e].extend&&(o=store.model[e].extend);for(var s=a&&a.hasOwnProperty(e)?a[e]:o&&a.hasOwnProperty(o)?a[o]:void 0;;){if(s&&s[r]&&"function"==typeof s[r])return{scope:s,func:s[r],name:r};if(!s||!s.$super)return i&&i[r]&&"function"==typeof i[r]?{scope:i,func:i[r],name:r}:void 0;s=s.$super}},comparePk:function(e,r){var t=e.$.pK,o=typeof t;if("string"==o||"number"==o)return t===r;if("object"==typeof t){var a=Object.keys(t).length,i=0;for(var s in t)t[s]===r[s]&&i++;return a===i}},getpKVal:function(e,r){var t=(r=r||e.$.model)._arrPk;if(1==t.length)return e[t[0]];var o={};return t.forEach(function(r){o[r]=e[r]}),o},unredoOp:function(e,r,t){var o,a;1==e?(o=r.undoStack,a=r.redoStack):(o=r.redoStack,a=r.undoStack);var i=[],s={};if(t?(i=Array.isArray(t)?t:[t]).forEach(function(e){if(o[e].length)for(var r=o._order_.length-1;r>=0;r--){var t=o._order_[r],a=t.indexOf(e);if(a>-1){t.splice(a,1),t.length||o._order_.splice(r,1);break}}}):i=o._order_&&o._order_.length?o._order_.pop():i,i.length){for(var n=0;n<i.length;n++){var d,l=i[n];"update"==(d=o[l].pop())._type?d.hasOwnProperty("val")?store.$.setData(r,l,d.val,void 0,s):d.hasOwnProperty("records")&&store.$.setData(r,l,d.records,void 0,s):1==e&&"propAdd"==d._type?"undefined"!=typeof Lyte?(s[l]={_type:"propDelete",val:r.record[l]},d.hasOwnProperty("val")&&store.$.setData(r,l,d.val,void 0,{}),Lyte.objectUtils?Lyte.objectUtils(r.record,"delete",l):delete r.record[l]):delete r.record[l]:2==e&&"propDelete"==d._type?(s[l]={_type:"propAdd"},store.$.setData(r,l,d.val,void 0,s)):"added"==d._type?r.record.$.get(l).remove(d.records,void 0,s):"removed"==d._type&&(store.$.rllBckRecArr([d],r.record,r.model,r.model.fieldList[l]),d._type="added",s[l]=d)}var c=Object.keys(s);for(n=0;n<c.length;n++){a[l=c[n]]=a[l]||[],a[l].push(s[l])}c.length&&a._order_.push(c)}},unregisterModel:function(e,r){var t=store.modelFor(e);if(t){t.data.length&&store.unloadAll(e,void 0,r);var o=t.extendedBy;if(o&&Object.keys(o).length)for(var a in o)store.unregisterModel(a,r);var i=t.extend;if(i)delete store.modelFor(i).extendedBy[e];delete store.model[e]}else Lyte.warn("LD02","Model ",e)},getDsrzEmpData:function(e,r){if(e.hasOwnProperty("deserializeEmptyData"))return e.deserializeEmptyData;var t=store.$.getFromCB("serializer",r,"deserializeEmptyData");return void 0!==t&&t},updateFieldValidation:function(e,r,t,o){var a=e.data,i=e.fieldList;a.forEach(function(a){var s=i[r];if(t){var n=store.$.getDsrzEmpData(s,e._name),d=!n&&a[r];a.hasOwnProperty(r)&&(d||n)&&Lyte.Transform.hasOwnProperty(s.type)&&Lyte.Transform[s.type].hasOwnProperty("deserialize")&&(a[r]=Lyte.Transform[s.type].deserialize(a[r],r,e._name,store.$.getpKVal(a,e)))}if(!o){var l=!!(a.$.error&&a.$.error.hasOwnProperty(r)&&a.$.error[r].hasOwnProperty("value")),c=l?a.$.error[r].value:void 0;store.$.clrRecErr(a.$,r),l?store.$.validateField(a,r,s,void 0,{old:!0,value:c}):store.$.validateField(a,r,s,void 0)}l&&a.$.error&&0===Object.keys(a.$.error)&&a.$.set(r,c)})},validateRelatedRecord:function(e,r,t){var o=store.model[t.relatedTo].fieldList;if(t&&t.opts&&e&&e.hasOwnProperty(r)&&t.opts&&"record"==t.opts.serialize){if("belongsTo"==t.relType&&Lyte.isRecord(e[r]))return this.validateRecord(e[r],o);if("hasMany"==t.relType&&Array.isArray(e[r])){var a=!0,i=this;return e[r].forEach(function(e,r){Lyte.isRecord(e)&&!1===i.validateRecord(e,o)&&(a=!1)}),a}}},validateRecord:function(e,r){var t,o=!0;for(var a in r)t=this.validateField(e,a,r[a],void 0),!0===o&&!1===t&&(o=!1);return!(!1===o||!0===e.$.isError&&e.$.error&&Object.keys(e.$.error).length)},validateField:function(e,r,t,o,a){var i,s=a&&a.old?a.value:e[r],n=e.$;if("relation"==t.type){if(!1===this.validateRelatedRecord(e,r,t))return!1,!1}else if(t.mandatory&&!e.$.error.hasOwnProperty(r)&&(void 0===s||""===s||Array.isArray(s)&&0===s.length))store.$.setRecErr(n,r,{code:"ERR02",message:Lyte.errorCodes.ERR02,value:s});else if(i=!0,a||e.hasOwnProperty(r)&&!e.$.error.hasOwnProperty(r)){var d=t;d.any&&Array.isArray(d)||(d=[d]);for(var l=d.length,c=!0,p=0;p<l;p++){var y=d[p];for(var f in y){var v=Lyte.checkProperty(f,s,r,y[f],y,e,void 0,Lyte.isRecord(e)?e.$.model._name:void 0);if(!0!==v){!0===c&&("object"==typeof v&&(v.value=s),c=v);break}}}!0!==c&&(store.$.setRecErr(n,r,c),i=!1),a&&i&&store.$.cmpSet(e,r,s,void 0,!0),i&&store.$.clrRecErr(n,r)}},partialData:function(e,r,t,o,a,i){var s=e[r];if(!s||!Array.isArray(s))return!0;s.partial||store.$.defPar(s);var n=s.partial=s.partial||new Map;n.get(t)||n.set(t,{});var d=!1;switch(n.get(t).type){case"added":"removed"==o&&(n.delete(t),d=!0);break;case"removed":if("added"==o){if(e[r]._recMap)var l=e[r]._recMap.get(t);if(!l||Lyte.isRecord(l)&&!l.$.isDirty())n.delete(t),d=!0;else n.get(t).type="modified"}break;case"modified":case"updated":if("added"==o)break;default:if(i)n.delete(t),d=!0;else{var c={type:o};a&&(c.polymorphicType=a),n.set(t,c)}}return d&&!n.size?(n.size||store.$.deleteDeepNest(e,r,t),!0):void 0},removeParentNesting:function(e,r,t){var o=e.$.model,a=e.$.pK,i=o.relations;for(var s in i){i[s].forEach(function(i){var s,n,d,l,c=store.model[i.relatedTo];c&&((s=store.$.getBackwardRel(o,i,c))&&s.opts&&(n=s.opts.deepNest,d=s.opts.hasOwnProperty("serialize"),l=i.relKey&&i!=s?e[i.relKey]:store.$.getRelatedRecord(e,i.relatedTo,i.dummy?i.dummy:i.relKey)),d&&!t&&(l&&!Array.isArray(l)&&(l=[l]),Array.isArray(l)&&l.forEach(function(e){if(s.relKey)if("belongsTo"==s.relType&&e&&e.$)e.$.partial&&e.$.partial[s.relKey]&&e.$.partial[s.relKey].has(a)&&(e.$.partial[s.relKey].delete(a),e.$.partial[s.relKey].size||delete e.$.partial[s.relKey]),n&&store.$.deleteDeepNest(e,s.relKey,a);else if("hasMany"==s.relType){var t=e[s.relKey];if(Array.isArray(t)){if(t.partial&&t.partial.has(a)){var o=t.partial.get(a).type;"modified"==r?/^(modified|updated)$/.test(o)&&t.partial.delete(a):t.partial.delete(a)}n&&store.$.deleteDeepNest(e,s.relKey,a)}}})))})}},deleteDeepNest:function(e,r,t){var o=e.$.dN;o&&(o[r]&&void 0===t?delete o[r]:o[r]&&o[r].get(t)&&(o[r].delete(t),o[r].size||delete o[r]),Object.keys(o).length||(delete e.$.dN,e.$.isModified||e.$.isNew||store.$.removeParentNesting(e),store.$.changePersist(e,!0)))},updateJSON:function(e,r,t){var o={},a=r._arrPk,i=e.$._attributes;for(var s in i)o[s]=e[s];var n=t;1==t&&(n=store.$.isDirty(e,r.relations)||[]);for(var d=0;d<n.length;d++)o[n[d]]=e[n[d]];return a.forEach(function(r){o[r]=e[r]}),o},removeDeepNest:function(e){if(Lyte.isRecord(e)&&(e.$.dN&&Object.keys(e.$.dN).length)){e.$.dN={};var r=e.$.model.relations;for(var t in r){r[t].forEach(function(r){var t=r.opts;if(t&&(t.deepNest||"partial"==t.serialize)){var o=e[r.relKey];Array.isArray(o)?o.forEach(function(e){Lyte.isRecord(e)&&(store.$.removeDeepNest(e),e.$.isNew||e.$.isModified||e.$.dN&&(!e.$.dN||0!=Object.keys(e.$.dN).length)||store.$.removeParentNesting(e))}):Lyte.isRecord(o)&&(store.$.removeDeepNest(o),o.$.isNew||o.$.isModified||o.$.dN&&(!o.$.dN||0!=Object.keys(o.$.dN).length)||store.$.removeParentNesting(o))}})}}},addDeepNest:function(e,r,t,o,a,i){a=a||new Map;var s,n=r?store.model[e.$.model.extend]:e.$.model,d=e.$.pK,l=(t=t||"updated",n.relations);for(var c in l){l[c].forEach(function(r){var l,c,p,y,f=store.model[r.relatedTo];if(f&&(l=store.$.getBackwardRel(n,r,f),s=r.relKey&&l!==r?e[r.relKey]:store.$.getRelatedRecord(e,r.relatedTo,r.dummy?r.dummy:r.relKey))){var v,u=!1;if(!a.get(l)){var h=a.set(l,new Map);u=!0}if(h=a.get(l),(u||!h.get(s))&&(h.set(s,!0),l&&l.opts&&(c=l.opts.deepNest,p="partial"==l.opts.serialize,y=!!l.opts.serialize&&l.opts.serialize),"updated"==t&&"id"==y&&(v=!0),(!i||i&&p)&&!v&&(c&&store.$.makeDirty("dirty",s,t,l,d,a),y&&e&&s&&(!o||!o||o.model!==r.relatedTo||l.relKey!==o.relKey)))){var m=s;"hasMany"==l.relType?Array.isArray(m)?m.forEach(function(e){store.$.partialData(e,l.relKey,d,/^(added|removed)$/.test(t)?t:"modified")}):Lyte.isRecord(m)&&store.$.partialData(m,l.relKey,d,/^(added|removed)$/.test(t)?t:"modified"):Array.isArray(m)?m.forEach(function(e){"added"==t&&e&&e.$&&e.$.partial&&e.$.partial[l.relKey]&&e.$.partial[l.relKey].has(d)&&delete e.$.partial}):Lyte.isRecord(m)&&"added"==t&&m&&m.$&&m.$.partial&&m.$.partial[l.relKey]&&m.$.partial[l.relKey].has(d)&&delete m.$.partial}}})}n.extend&&this.addDeepNest(e,!0)},getRelatedRecord:function(e,r,t){if(e){var o=e.$._relationships;if(o[r]&&o[r][t])return o[r][t]}},makeDirty:function(e,r,t,o,a,i){if("id"!=o.opts.serialize||"updated"!=t){var s=o.relKey;Array.isArray(r)?r.forEach(function(e){store.$.setDeepNest(e,s,a,t,i)}):Lyte.isRecord(r)&&store.$.setDeepNest(r,s,a,t,i)}},setDeepNest:function(e,r,t,o,a){var i=e.$.dN=e.$.dN||{},s=i[r]=i[r]||new Map;s.has(t)||s.set(t,{});var n=s.get(t);switch(n.type){case"added":"removed"==o&&store.$.deleteDeepNest(e,r,t);break;case"removed":"added"==o&&store.$.deleteDeepNest(e,r,t),"modified"==o&&(n.type="updated");break;default:n.type=o,store.$.changePersist(e,!1),store.$.addDeepNest(e,void 0,void 0,void 0,a)}},isDirty:function(e,r,t,o){var a=[];for(var i in r)for(var s=r[i],n=0;n<s.length;n++){if((i=s[n]).opts&&i.opts.serialize){var d=i.relKey,l=i.relType,c=e[d],p=store.model[i.relatedTo];if(t&&p)if(t==store.$.getBackwardRel(o,i,store.model[i.relatedTo])&&o._name!=i.relatedTo)continue;if("record"==i.opts.serialize){if(store.$.isRelDirty(i,c,i)){a.push(d);continue}}else if("partial"==i.opts.serialize)if("hasMany"==l){if(c&&c.partial&&c.partial.size){a.push(d);continue}}else if(Lyte.isRecord(c)&&c.$.isModified||e&&e.$&&e.$.partial&&e.$.partial.hasOwnProperty(d)){a.push(d);continue}i.opts.deepNest&&e.$.dN&&e.$.dN[d]&&a.push(d)}}return a},isRelDirty:function(e,r,t){var o=e.relType,a=store.model[e.relatedTo],i=a.relations;if(!store.$.isEmpty(r))if("hasMany"==o&&Array.isArray(r)&&r.length){for(var s=r.length,n=0;n<s;n++)if(1==r[n].$.isModified)return!0;for(var d=0;d<s;d++){var l=r[d];if(this.isDirty(l,i,t,a).length)return!0}}else if("belongsTo"==o&&Lyte.isRecord(r)){if(1==r.$.isModified)return!0;if(this.isDirty(r,i,t,a).length)return!0}return!1},handleCachedResponse:function(e,r){var t=store.$.cachedBatch=store.$.cachedBatch||{},o=0;return(t[e]||[]).forEach(function(e,t){r.splice(e.ind+o++,0,e.data)}),delete t[e],r},addToCachedBatch:function(e){var r=store.$.currentBatch,t=store.$.cachedBatch=store.$.cachedBatch||{},o=t[r]=t[r]||[],a=(store.$.batch[r]||[]).length;o.push({ind:a,data:e})},establishToRelated:function(e,r){var t=e.$.model,o={};r.forEach(function(r){var a=store.peekRecord(r.model,r.pkVal);if(a){var i=a.$.model;store.$.getRelations(i,r.key,t,o),store.$.establishLink(o.forward,o.backward,a,e,void 0,!0)}})},checkObjAndAddToArr:function(e,r,t){for(var o=Object.keys(t).length,a=-1,i=e.length,s=0;s<i;s++){var n=e[s],d=0;for(var l in t)n[l]==r[l]&&d++;if(d==o)return a=s,void e.splice(s,1,r)}return-1==a&&e.push(r),a},addToRelate:function(e,r,t,o){var a=t.forward.relatedTo,i=store.$.toRelate[a]=store.$.toRelate[a]||new Map;i.has(o)||i.set(o,[]);var s=i.get(o),n={model:e,pkVal:r.$.pK,key:t.forward.relKey};s.push(n)},addOnSave:function(e,r,t,o,a,i){store.$.onSave=store.$.onSave||{};var s=store.$.onSave[e]=store.$.onSave[e]||{},n=s[r[a]]=s[r[a]]||{},d=r[t]||[];"belongsTo"==o.relType&&(d=Array.isArray(r[t])?r[t]:[r[t]]),d.forEach(function(e){var r=n[o.relKey]=n[o.relKey]||[];store.$.checkAndAddToArray(r,e[i])})},addToIDBonSave:function(e,r){var t=store.model[e].fieldList,o=store.$.onSave?store.$.onSave[e]:void 0;if(o){var a=store.model[e]._pK,i=r&&a?o[r[a]]:void 0;if(i){for(var s in i){var n=i[s],d=t[s].relatedTo;n.forEach(function(e){var r=store.peekRecord(d,e);if(r){var t=r.$.parent;if(Lyte.isRecord(t)){var o=t.$.model,a=o._name,i=o._pK;store.$.checkAndAddToIDBQ(a,"updateRecord",store.peekRecord(a,t[i]).$.toJSON(!0))}else store.$.checkAndAddToIDBQ(d,"updateRecord",store.peekRecord(d,e).$.toJSON(!0))}})}store.$.removeOnSave(e,r[a])}}},removeOnSave:function(e,r){var t=store.$.onSave?store.$.onSave[e]:void 0;t&&t[r]&&delete t[r]},checkAndAddToIDBQ:function(e,r,t){var o={model:e,type:r,data:t};(store.$.idbQ2[e]=store.$.idbQ2[e]||[]).push(o)},checkAndRemoveKey:function(e,r,t){for(var o in e){var a=r[o];a&&"relation"==a.type&&(t&&!this.checkPresenceInArray(t,o)?delete e[o]:this.removeNotNeededKeys(a.relatedTo,e[o]))}},removeNotNeededKeys:function(e,r,t){var o=store.model[e],a=o.fieldList,i=t?t.deserializeKeys:void 0;if(o){var s=this;Array.isArray(r)?r.forEach(function(e){s.checkAndRemoveKey(e,a,i)}):this.checkAndRemoveKey(r,a,i)}return r},getIDBObj:function(e,r,t,o,a,i){if(e&&e.hasOwnProperty("idb"))return"function"==typeof e.idb?e.idb.apply(e,[{model:i||e._name,type:t,queryParams:r,key:o,customData:a}]):e.idb},idbQ2Push:function(e,r,t,o,a,i,s){try{var n=store.model[e],d=store.$.getIDBObj(n,t,o,a,s);if(d){var l={model:e,type:o,customData:s};l.queryCache=d.queryCache;n._pK;var c=store.$.idbQ2[e]=store.$.idbQ2[e]||[];switch(o){case"action":return void delete c[o];case"update":case"create":l.data=[],r.forEach(function(e){l.data.push(Lyte.isRecord(e)?e.$.toJSON(void 0,!0):e)});break;case"updateRecord":case"createRecord":case"delete":l.data=r;break;case"destroyRecord":case"deleteRecord":l.id=r;break;case"findRecord":l.key=a;var p=r[0].$.toJSON("idb");(y={})[e]=p,i&&(y.meta=i),!0===d.queryCache&&(l.queryParams=t),l.data=y;break;case"findAll":var y;p=[];r.forEach(function(e){p.push(e.$.toJSON("idb"))}),(y={})[e]=p,i&&(y.meta=i),!0===d.queryCache&&(l.queryParams=t),l.data=y;break;case"pushPayload":Lyte.isRecord(r)&&(r=r.$.toJSON("idb")),l.data=r}c.push(l)}}catch(e){Lyte.error("Error while adding to IDBQueue ",e)}},isEmpty:function(e){return void 0==e||""===e||null==e},isEmptyObj:function(e){return null!==e&&"object"==typeof e&&0==Object.keys(e).length},isEmptyArray:function(e){return!(!Array.isArray(e)||0!=e.length)},registerField:function(e,r,t,o){var a=e.fieldList[r]?Object.assign({},e.fieldList[r]):void 0;if("observer"==t.type)o.push(t);else if("callBack"==t.type){t.observes&&o.push(t.observes);for(var i=t.properties,s=0;s<i.length;s++)"didLoad"===i[s]||"init"===i[s]?(e.didLoad||(e.didLoad=[]),e.didLoad.push(t.value)):"add"!==i[s]&&"change"!==i[s]||e.on(i[s],t.value);"didLoad"==r&&(e.didLoad||(e.didLoad=[]),e.didLoad.push(t.value))}else if("didLoad"==r)e.didLoad||(e.didLoad=[]),e.didLoad.push(t);else if(Object.keys(t).length){if(t.primaryKey&&(e.fieldList.id&&0==e.fieldList.id.defined&&delete e.fieldList.id,t.hasOwnProperty("default")&&(Lyte.warn("LD23",e._name,r),delete t.default),void 0!=e._pK?(e._pK=e._pK+","+r,e.isComposite=!0):e._pK=r,t.baseKey)){if(e.bK)return void Lyte.warn("LD26");e.bK=r}if(e.fieldList.hasOwnProperty(r));if(e.fieldList[r]=t,a&&e._fldGrps&&(a.hasOwnProperty("default")&&delete e._fldGrps.default[r],a.hasOwnProperty("watch")&&delete e._fldGrps.watch[r],a.opts&&a.opts.hasOwnProperty("inherit")&&delete e._fldGrps.inherit[r]),t.hasOwnProperty("default")&&(e._fldGrps.default[r]=t),t&&t.opts&&t.opts.hasOwnProperty("inherit")&&(e._fldGrps.inherit[r]=t),t.hasOwnProperty("watch")&&(1==t.watch||Array.isArray(t.watch))&&/^(array|object)$/.test(t.type)&&(e._fldGrps.watch[r]=t),Lyte.Transform[t.type]){var n=Lyte.Transform[t.type];(/^(array|object)$/.test(n.extends)&&n.hasOwnProperty("properties")||n.hasOwnProperty("items"))&&(e._fldGrps.nested_prop[r]=t)}}if("relation"===t.type){t.relKey=r;var d=t.relatedTo,l=e.fieldList[r];e.relations[d]||(e.relations[d]=[]);var c={};c.relKey=l.relKey,store.$.checkObjAndAddToArr(e.relations[t.relatedTo],l,c),"hasMany"==t.relType&&(e._fldGrps.hasMany[r]=t),t.hasOwnProperty("opts")&&t.opts.hasOwnProperty("inverse")&&(e._fldGrps.inverse[d]=t)}},setError:function(e,r,t){e.$.hasOwnProperty("error")?Array.isArray(r)?r.forEach(function(r){store.$.cmpSet(e.$.error,r,t)}):store.$.cmpSet(e.$.error,r,t):Lyte.error("LD03",e,r)},unRegCb:function(e,r){var t=store[e][r];if(t){var o=t.__extendedBy;if(o.length){if(store[e].__toAddSuper=store[e].__toAddSuper||{},store[e].__toAddSuper[r]?o.forEach(function(t){store[e].__toAddSuper[r].push(t)}):store[e].__toAddSuper[r]=o.slice(),o.forEach(function(r){store[e][r].$super=void 0}),store[e].application&&"application"!=r){var a=store[e].application;o.forEach(function(r){store[e][r].$super=a,store[e].application.__extendedBy.push(r)})}store[e].application||(store[e].__toAddSuper.application?o.forEach(function(r){store[e].__toAddSuper.application.push(r)}):store[e].__toAddSuper.application=o.slice())}t.$super&&t.$super.__extendedBy.splice(t.$super.__extendedBy.indexOf(r),1),delete store[e][r]}else Lyte.error("LD02",e,r)},eventListeners:{add:function(e,r,t){return e.events=e.events||{},e.events[r]=e.events[r]||[],e.events[r].push({f:t}),r+"-"+(e.events[r].length-1)},remove:function(e,r){var t;if(r)if(/^(add|remove|change)$/.test(r))t=r,e.events&&e.events[t]&&delete e.events[t];else{var o=r?r.split("-"):void 0;if(o){var a=e.events[o[0]];a&&o[1]&&(a[o[1]]=null)}}else{var i=e.events;for(var s in i)i&&i[s]&&delete i[s]}},emit:function(e,r,t){for(var o=e.events&&e.events[r]?e.events[r]:[],a=0;a<o.length;a++)o[a]&&o[a].f.apply(null,t)}},extendCallback:function(e,r,t){var o,a,i=e[r];if(t&&"string"==typeof t&&((a=i[t])||(i.__toAddSuper=i.__toAddSuper||{},i.__toAddSuper.hasOwnProperty(t)||(i.__toAddSuper[t]=[]),i.__toAddSuper[t].push(this.__name))),a&&a.is==r&&(!this.$super||"application"==this.$super.__name)){if(this.$super=a,a.__extendedBy.push(this.__name),i.application){var s=i.application.__extendedBy.indexOf(this.__name);s>-1&&i.application.__extendedBy.splice(s,1)}if((o=i.__toAddSuper)&&o.application){var n=o.application.indexOf(this.__name);n>-1&&i.__toAddSuper.application.splice(n,1)}}return this},super:function(){var e=this.$super,r=arguments[0][0][arguments[0][0].length-1],t=[],o=arguments[0][0],a=e[r];if("function"==typeof a){for(var i in delete o[o.length-1],o)o.hasOwnProperty(i)&&t.push(o[i]);return a.apply(e,t)}if(a)return a},extendModel:function(e,r){var t=r||this;if(e&&store.model[e]){var o=Object.assign({},store.model[e].fieldList);for(var a in o)"relation"==o[a].type&&delete o[a];var i={},s="id"==t._pK&&0==t.fieldList.id.defined;for(var a in o){var n=o[a];s&&n.primaryKey&&n.defined;if(t.fieldList.hasOwnProperty(a)&&t._fldGrps){var d=t.fieldList[a];d.hasOwnProperty("default")&&delete t._fldGrps.default[a],d.hasOwnProperty("watch")&&delete t._fldGrps.watch[a]}n.hasOwnProperty("default")&&(t._fldGrps.default[a]=n),n.hasOwnProperty("watch")&&1==n.watch&&/^(array|object)$/.test(n.type)&&(t._fldGrps.watch[a]=n),n.primaryKey?i[a]=n:t.fieldList[a]=n}var l=Object.keys(i),c=l.length;if(s&&c){for(var a in delete t.fieldList.id,i)t.fieldList[a]=i[a];1==c?(t._pK=l[0],t._arrPk=Array.from(l)):(t.isComp=!0,t._arrPk=Array.from(l),t._pK=t._arrPk.toString())}var p=t._name;if(store.model[p].extend=e,store.model[e].extendedBy=store.model[e].extendedBy||{},store.model[e].extendedBy[p]=!0,store.model[e].actions){var y=t.actions=t.actions||{};for(var a in store.model[e].actions)y.hasOwnProperty(a)||(y[a]=store.model[e].actions[a])}}},demoLishObserverBindings:function(e,r,t){for(key in t||(t=e),r){if(e[key]instanceof Object){if(t&&e[key]._setterScope){var o=e[key]._setterScope.indexOf(t);-1!=o&&e[key]._setterScope.splice(o,1)}Object.keys(r[key]).length&&this.demoLishObserverBindings(e[key],r[key],e)}if(e._setterScope&&e!=t){var a=e._setterScope.indexOf(t);-1!=a&&e._setterScope.splice(a,1)}}},establishObserverBindings:function(e,r,t){for(key in t||(t=e),r){if(e[key]instanceof Object)e[key]._bindings||store.$.defProp(e[key],"_bindings",new Set,!1,!0),t&&!e[key]._setterScope&&store.$.defProp(e[key],"_setterScope",[]),-1==e[key]._setterScope.indexOf(t)&&e[key]._setterScope.push(t),e[key]._bindings.add(r[key]),Object.keys(r[key]).length&&this.establishObserverBindings(e[key],r[key],e);e._setterScope||(store.$.defProp(e,"_setterScope",[]),e._setterScope.push(e))}},setData:function(e,r,t,o,a,i,s){var n,d={emit:!1,attr:[],oldRec:{}},l=e.model,c=!1,p=e.record;if(s&&r){var y=e.model._fldGrps.inherit;for(var f in y)if(e.record[y[f].relKey]&&r[y[f].relKey]){if("belongsTo"==y[f].relType)e.model._arrPk.forEach(function(e){delete r[y[f].relKey][e]}),this.setData(e.record[y[f].relKey].$,r[y[f].relKey],void 0,void 0,void 0,i,!0);else for(var v=r[y[f].relKey].length-1;v>=0;v--)e.model._arrPk.forEach(function(e){delete r[y[f].relKey][v][e]}),this.setData(e.record[y[f].relKey][v].$,r[y[f].relKey][v],void 0,void 0,void 0,i,!0);delete r[y[f].relKey]}}if(r&&"object"==typeof r)for(var u in n=[],o=t,r)n.push(u),this.setValue(e,u,r[u],o,d,i),l&&l._properties&&l._properties.hasOwnProperty(u)&&(c=!0);else n=r,this.setValue(e,r,t,o,d,i),l&&l._properties&&l._properties.hasOwnProperty(r)&&(c=!0);return e.emit("set",[e.record,n]),e.model.emit("set",[l._name,e.record,n]),store.emit("set",[l._name,e.record,n]),c&&store.$.establishObserverBindings(p,l._properties),!i&&d.emit&&store.$.changeCallbck(p,d,a),p},changeCallbck:function(e,r,t){var o=[e,r.attr],a=e.$;if(a.emit("change",o),a.model.emit("change",o),store.emit("change",[a.model._name,a.record,r.attr]),t)for(var i in r.oldRec)t[i]=r.oldRec[i];else{for(var s=0;s<r.attr.length;s++){i=r.attr[s];a.undoStack[i]=a.undoStack[i]||[],a.undoStack[i].push(r.oldRec[i])}a.undoStack._order_.push(r.attr)}},setValue:function(e,r,t,o,a,i,s){var n=e.model,d=n._pK,l=e.record;if(r!=n._pK){var c=n.fieldList[r],p=c&&c.opts?1==c.opts.watch:void 0;l.hasOwnProperty(r),l[r];if(!c)return void store.$.cmpSet(l,r,t,void 0,!0);if(!c.mandatory||void 0!=t&&null!=t&&""!==t){if(c.relType){var y,f,v=c.relType,u={},h=store.modelFor(c.relatedTo),m=h._pK,$=h._pK,g=(b=h.isComp)||h.fieldList[m].type,b=h.isComp,_=(m=h._pK,g=b?"object":h.fieldList[m].type,c&&c.opts?c.opts.polymorphic:void 0);if(this.getRelations(n,c.relKey,h,u),l[r]&&"hasMany"==v){if(y=[],l[r].forEach(function(e){y.push(e.$.pK)}),l[r]===t)return;if(Array.isArray(t)&&t.length===l[r].length){for(var L,R=t.length,O=0,k=0;k<R&&(L=t[k],Lyte.isRecord(L)?f=L:L&&typeof L==g&&(f=store.peekRecord(L._type?L._type:c.relatedTo,L)),Lyte.isRecord(f)&&f===l[r][k]);k++)O++;if(O&&O==R)return}store.$.addOnSave(n._name,l,r,c,d,$),Array.from(l[r]).forEach(function(e){store.$.demolishLink(e,$,l,u.forward.relKey,void 0,void 0,void 0,!0),null!==u.backward&&store.$.demolishLink(l,n._pK,e,u.backward.relKey,u.forward)})}else if(l[r]&&Lyte.isRecord(l[r])&&"belongsTo"==v){if(y=l[r].$.pK,Lyte.isRecord(t)?f=t:t&&typeof t==g&&(f=store.peekRecord(t._type?t._type:c.relatedTo,t)),Lyte.isRecord(f)&&f===l[r])return;store.$.addOnSave(n._name,l,r,c,d,$);var w=l[r];store.$.demolishLink(w,$,l,u.forward.relKey,void 0,void 0,void 0,!0),null!==u.backward&&store.$.demolishLink(l,n._pK,w,u.backward.relKey,u.forward),store.$.cmpSet(l,r,{},o,!0)}if("hasMany"==v&&store.$.isEmpty(t)){var A=l[r]&&l[r].partial?l[r].partial:void 0;store.$.cmpSet(l,r,[],o,!0),A&&store.$.defProp(l[r],"partial",A),store.$.establishObserverBindings(l,l.$.model._properties),store.$.defArrUtls(l[r]),store.$.defPolyUtls(l[r]),store.$.defUtls(l[r],h,l,r)}if(Array.isArray(t)){if("belongsTo"==v)return this.revertToOldVal(l,r,y,u),void store.$.setRecErr(e,r,"ERR21",t)}else t=[t];var P=[];for(k=0;k<t.length;k++)if(!(this.isEmpty(t[k])||"belongsTo"==v&&this.isEmptyObj(t[k])||"hasMany"==v&&this.isEmptyArray(t[k]))){var j=t[k],S=t[k]&&t[k]._type?t[k]._type:c.relatedTo;if(!b&&t[k]&&typeof t[k]===g){if(void 0==(j=store.peekRecord(t[k]._type?t[k]._type:c.relatedTo,t[k])))this.addToRelate(n._name,l,u,t[k]);else if(j.$&&j.$.isError){P.push({code:"ERR15",message:Lyte.errorCodes.ERR15,error:Object.assign({},j)});continue}}else if(t[k]&&"object"==typeof t[k]){if(j.$&&j.$.isError){P.push({code:"ERR15",message:Lyte.errorCodes.ERR15,error:Object.assign({},j)});continue}if(!Lyte.isRecord(j)&&(_&&t[k]&&t[k]._type?j=store.peekRecord(t[k]._type,store.$.getpKVal(t[k],store.modelFor(t[k]._type))):b&&(j=store.peekRecord(t[k]._type?t[k]._type:c.relatedTo,t[k]))||(j=this.newRecord(S,t[k],o?o.skipValidation:void 0)),j.$.isError)){P.push({code:"ERR15",data:t[k],message:Lyte.errorCodes.ERR15,error:Object.assign({},j)});continue}}1!=(T=this.establishLink(u.forward,u.backward,l,j,void 0,!!i||void 0))?P.push({code:T,data:t[k],message:Lyte.errorCodes[T]}):store.$.addOnSave(n._name,l,r,c,d,$)}if(P.length&&P.length==t.length)return this.revertToOldVal(l,r,y,u),void("belongsTo"==c.relType?store.$.setRecErr(e,r,P[0]):store.$.setRecErr(e,r,P));if(P.length>1?store.$.setRecErr(e,r,P):store.$.clrRecErr(e,r),!i){var K=l.$._attributes;K.hasOwnProperty(r)||(K[r]=[]),K[r].push({_type:"changed",records:y}),a.emit=!0,a.attr.push(r);var E={};E.records=y,E._type="update",a.oldRec[r]=E;var D=l.$.getInitialValues(r),T=!0;if(D&&Array.isArray(l[r])&&D.length==l[r].length){T=!1;for(k=0;k<D.length;k++)if(!store.$.comparePk(l[r][k],D[k])){T=!0;break}}T||delete K[r]}}else if(t!==l[r]){if(!o||o&&!0!==o.skipValidation){(F=c).any&&Array.isArray(F)||(F=[F]);var C=F.length,M=!0;for(k=0;k<C;k++){var N=F[k];for(var B in N){!0!==(I=Lyte.checkProperty(B,t,r,N[B],N,l,void 0,n._name))&&!0===M&&("object"==typeof I&&(I.value=t),M=I)}}if(!0!==M)return void store.$.setRecErr(e,r,M)}if(i){var x=!1;if(Lyte.Transform[c.type]){var z=Lyte.Transform[c.type];(z.hasOwnProperty("properties")||z.hasOwnProperty("items"))&&(x=!0)}(p&&/^(array|object)$/.test(c.type)||x)&&Lyte.establishObjectBinding(l,r,!0),store.$.cmpSet(l,r,t,o,!0)}else store.$.estAttrs(l,r,t,a,s,o)}else if(t===l[r]&&l.$.isError&&l.$.error[r]){var F,q=!0;(F=c).any&&Array.isArray(F)||(F=[F]);for(C=F.length,M=!0,k=0;k<C;k++){N=F[k];for(var B in N){var I;!0!==(I=Lyte.checkProperty(B,t,r,N[B],N,l,void 0,n._name))&&(M=!1)}}!0!==M&&(q=!1),q&&store.$.clrRecErr(e,r)}}else store.$.setRecErr(e,r,{code:"ERR02",message:Lyte.errorCodes.ERR02,value:t});store.$.checkAttrs(l)}else l[r]!==t&&store.$.setRecErr(e,r,"ERR01",t)},estAttrs:function(e,r,t,o,a,i){var s=e.$._attributes,n=e.$.model,d=s[r],l=s.hasOwnProperty(r);l?(a&&Lyte.cmpData(l?d:a.data,e[r])||t&&"object"==typeof t&&!a&&store.adapter.$.compareObjects(d,t)||d==t)&&delete s[r]:s[r]=a?a.data:this.createCopy(e[r]);var c=e.hasOwnProperty(r),p=a?a.data:e[r];if(!a){var y={};n._properties&&n._properties.hasOwnProperty(r)&&(y[r]=n._properties[r],store.$.demoLishObserverBindings(e,y)),store.$.cmpSet(e,r,t,i,!0)}store.$.clrRecErr(e.$,r),e.$.srtObs&&store.$.changeRelPkMaps(e,void 0,void 0,"sort",r);var f={_type:"update"};f.val=p,c||(f._type="propAdd"),o.emit=!0,o.attr.push(r),o.oldRec[r]=f},checkAttrs:function(e){var r=e.$.model;Object.keys(e.$._attributes).length?(store.$.cmpSet(e.$,"isModified",!0),store.$.changePersist(e,!1),store.$.addDeepNest(e),this.checkAndAddToArray(r.dirty,e.$.pK)):(store.$.cmpSet(e.$,"isModified",!1),store.$.changePersist(e,!0),e.$.isNew||e.$.hasOwnProperty("dN")&&(!e.$.dN||Object.keys(e.$.dN).length)||store.$.removeParentNesting(e),e.$.isNew||this.deleteFromArray(r.dirty,e.$.pK))},checkForCorrectRelation:function(e,r){var t=e.relatedTo;return!!Lyte.isRecord(r)&&(e.opts&&e.opts.polymorphic?!!r.$.model.extend&&e.relatedTo===r.$.model.extend:!(!e||!r)&&t===r.$.model._name)},removeKeys:function(e,r){for(var t in r)if(e.hasOwnProperty(t)){var o=e[t];("belongsTo"===o.type||"hasMany"===o.type&&r[t])&&this.removeNotDefinedKeys(o.relatedTo,r[t],!(!o.opts||!o.opts.polymorphic)||void 0)}else delete r[t]},removeNotDefinedKeys:function(e,r,t){var o=e.fieldList;if(Array.isArray(r))for(var a=0;a<r.length;a++){var i=r[a];this.removeKeys(t&&Lyte.isRecord(i)?i.$.model.fieldList:o,i)}else this.removeKeys(t&&Lyte.isRecord(r)?r.$.model.fieldList:o,r)},add:function(e,r,t,o){var a,i=this.record,s=i.$.model,n=this.key,d=s.fieldList[n],l={};store.$.getRelations(s,d.relKey,store.modelFor(d.relatedTo),l),Array.isArray(e)||(e=[e]);var c=store.modelFor(l.forward.relatedTo),p=c._pK,y=[],f=[],v=c.isComp;i.$._attributes.hasOwnProperty(n)&&i.$._attributes[n].length&&(a=i.$.getInitialValues(n));for(var u=0;u<e.length;u++){var h=e[u];if(v&&"object"==typeof h&&Object.keys(h).length===c._arrPk.length){if(this.polymorphic&&!r){y.push({code:"ERR22",data:e[u],message:Lyte.errorCodes.ERR22});continue}h=store.peekRecord(r||l.forward.relatedTo,h)}if(!v&&c.fieldList[p].type.toLowerCase()==typeof h||v&&"object"==typeof h&&Object.keys(h).length===c._arrPk.length){if(this.polymorphic&&!r){y.push({code:"ERR22",data:e[u],message:Lyte.errorCodes.ERR22});continue}h=store.peekRecord(r||l.forward.relatedTo,h)}else"object"!=typeof h||Lyte.isRecord(h)||(h=store.$.newRecord(h._type?h._type:r||d.relatedTo,h,t?t.skipValidation:void 0));var m=this.polymorphic&&r?r:h&&h._type?h._type:void 0;if(void 0==h)y.push({code:"ERR13",data:e[u],message:Lyte.errorCodes.ERR13});else if(h.$&&h.$.isError)y.push({code:"ERR15",data:e[u],message:Lyte.errorCodes.ERR15,error:h});else if(Lyte.isRecord(h)&&!store.$.hasDuplicateRelation(h,i[n],p,m,c)){var $=store.$.establishLink(l.forward,l.backward,i,h);1!=$?y.push({code:$,data:e[u],message:Lyte.errorCodes[$]}):f.push(h)}}if(f.length){var g=i.$._attributes;g[n]?store.$.hasRecordsArrayChanged(i,n,a)?g[n].push({_type:"added",records:f}):(delete i.$._attributes[n],Object.keys(i.$._attributes).length||(store.$.cmpSet(i.$,"isModified",!1),store.$.changePersist(i,!0),delete g[n],i.$.isNew||(store.$.deleteFromArray(s.dirty,i.$.pK),(!i.$.dN||i.$.dN&&!Object.keys(i.$.dN).length)&&store.$.removeParentNesting(i)))):(g[n]=[{_type:"added",records:f}],store.$.cmpSet(i.$,"isModified",!0),store.$.changePersist(i,!1),store.$.checkAndAddToArray(s.dirty,i[s._pK])),store.$.emit("change",i,[n]);var b={_type:"added",records:f};if(o)o[n]=b;else{i.$.undoStack[n]=i.$.undoStack[n]||[],i.$.undoStack[n].push(b),i.$.undoStack._order_.push([n])}}return y.length>0?store.$.setRecErr(i.$,n,y):store.$.clrRecErr(i.$,n),i},remove:function(e,r,t){var o,a=this.record,i=a.$.model,s=this.key,n=i.fieldList[s],d={};store.$.getRelations(i,n.relKey,store.modelFor(n.relatedTo),d),Array.isArray(e)||(e=[e]);var l,c=store.modelFor(d.forward.relatedTo),p=c._pK,y=c.isComp,f=[],v=[],u=[];a.$._attributes.hasOwnProperty(s)&&a.$._attributes[s].length&&(o=a.$.getInitialValues(s));for(var h=0;h<e.length;h++){var m,$=e[h];if(!y&&c.fieldList[p].type.toLowerCase()==typeof e[h]||y&&"object"==typeof $&&Object.keys($).length===c._arrPk.length){if(1==this.polymorphic&&!r){f.push({code:"ERR22",data:e[h],message:Lyte.errorCodes.ERR22});continue}l=store.peekRecord(r||d.forward.relatedTo,e[h]),m=r}else Lyte.isRecord(e[h])&&(l=e[h],m=r||(l&&l._type?l._type:void 0));if(l){var g=store.$.getIndex(a[s],p,l.$.get(p),m);store.$.demolishLink(l,p,store.peekRecord(i._name,a.$.pK),d.forward.relKey,void 0,void 0,void 0,!0),null!=d.backward&&store.$.demolishLink(a,i._pK,store.peekRecord(m||d.forward.relatedTo,l.$.pK),d.backward.relKey,d.forward),v.push(l),u.push(g)}}if(v.length){var b=a.$._attributes;b[s]?store.$.hasRecordsArrayChanged(a,s,o)?b[s].push({_type:"removed",records:v,_indices:u}):(delete a.$._attributes[s],Object.keys(a.$._attributes).length||(store.$.cmpSet(a.$,"isModified",!1),store.$.changePersist(a,!0),delete b[s],a.$.isNew||(store.$.deleteFromArray(i.dirty,a.$.pK),(!a.$.dN||a.$.dN&&!Object.keys(a.$.dN).length)&&store.$.removeParentNesting(a)))):(b[s]=[{_type:"removed",records:v,_indices:u}],store.$.cmpSet(a.$,"isModified",!0),store.$.changePersist(a,!1),store.$.checkAndAddToArray(i.dirty,a[i._pK])),store.$.emit("change",a,[s]);var _={_type:"removed",records:v,_indices:u};if(t)t[s]=_;else{a.$.undoStack[s]=a.$.undoStack[s]||[],a.$.undoStack[s].push(_),a.$.undoStack._order_.push([s])}}f.length>0?store.$.setRecErr(a.$,s,f):store.$.clrRecErr(a.$,s)},filter:function(e,r,t){var o=0;for(var a in r)e[a]===r[a]&&o++;if(o===t)return!0},filterBy:function(e){for(var r=Object.keys(e).length,t=[],o=0;o<this.length;o++)store.$.filter(this[o],e,r)&&t.push(this[o]);return t.filterBy||(store.$.defArrUtls(t),store.$.defUtls(t,this.model)),t},idbSerialize:function(e,r,t,o,a,i){var s=r.forward.relatedTo,n=t._pK,d=o._pK;Array.isArray(e)?e.forEach(function(t,l){Lyte.isRecord(t)&&t.$.inIDB?e[l]=t[d]:store.$.checkPresenceInArray(store.$.recStack[s],t[d])?e[l]=t[d]:(store.$.removeBackwardRel(t,r,n,a,!0),store.$.removeSelfCircularReference(o._name,t,i))}):e&&Lyte.isRecord(e)&&(Lyte.isRecord(e)&&e.$.inIDB?e[r.relKey]=e[d]:this.checkPresenceInArray(store.$.recStack[s],e[d])?e[r.relKey]=e[d]:(this.removeBackwardRel(e,r,n,a,!0),this.removeSelfCircularReference(o._name,e,i)))},idSerialize:function(e,r,t,o,a){var i=r.forward.opts?r.forward.opts.polymorphic:void 0,s=r.forward.relKey,n=e[s=r.forward.relKey],d=store.model[r.backward.relatedTo],l=store.model[r.forward.relatedTo],c=store.$.getpKVal(e,d);if(Array.isArray(n))if(i)e[s]=this.polymorphicToJSON(r.forward,n);else{var p=[];if(o)var y=o[s]=o[s]||[];n.forEach(function(e){if(e.$&&e.$.isNew&&1!=t&&"state"!=t)!0,store.$.rSerialize(e,r,l,d._pK,c,t,y,a),p.push(e);else{if(y){var o={},i="related";e.$.isDeleted&&(i="removed"),store.$.defProp(o,"$",{});var s=o.$,n=r.forward.relatedTo;Object.defineProperties(s,{pkVal:{value:e.$.pK},type:{value:i},model:{value:n},record:{value:store.peekRecord(n,e.$.pK)}}),e.$.isDeleted&&(o.$.onlyDetach=!0),y.push(o)}e.$&&!e.$.isDeleted&&p.push(e.$.pK&&"object"==typeof e.$.pK?Object.assign({},e.$.pK):e.$.pK)}}),e[s]=p}else if(n&&Lyte.isRecord(n))if(n.$.isNew&&1!=t&&"state"!=t){if(o)y=o[s]=o[s]||{};y=store.$.rSerialize(n,r,l,d._pK,c,t,y,a),o[s]=y}else i?e[s]=this.polymorphicToJSON(r.forward,n):n.$.isDeleted||(e[s]=n.$.pK&&"object"==typeof n.$.pK?Object.assign({},n.$.pK):n.$.pK)},recordSerialize:function(e,r,t,o,a,i,s,n,d,l){var c=a._pK;if(Array.isArray(t)){if(0==t.length)return delete e[r],0;t=Array.from(t);var p=d[r]=d[r]||[];if(t.length){for(var y=[],f=0;f<t.length;f++)t[f]&&Lyte.isRecord(t[f])&&(this.rSerialize(t[f],o,i,c,s,n,p,l),t[f].$.isDeleted&&(p[f]&&p[f].$&&(p[f].$.onlyDetach=!0),t.splice(f,1),f--));if(y.length)for(var v=0;v<y.length;v++)t.splice(v,1)}}else if(t&&Lyte.isRecord(t)){p=d[r]=d[r]||{};p=this.rSerialize(t,o,i,c,s,n,p,l),d[r]=p}},rSerialize:function(e,r,t,o,a,i,s,n){var d=r.forward.relatedTo,l=(store.model[r.backward.relatedTo],r.forward.opts?r.forward.opts.polymorphic:void 0);if(this.removeBackwardRel(e,r,o,a),s){var c,p={},y=e.$.isNew?"added":e.$.isModified?"modified":e.$.isDeleted?"removed":"related";l&&(c=e.$.model._name,e.$.polymorphicType=c,t=store.model[c]),store.$.defProp(p,"$",{});var f=p.$,v=l?c:d;Object.defineProperties(f,{pkVal:{value:e.$.pK},type:{value:y},model:{value:v},record:{value:store.peekRecord(v,e.$.pK)}}),Array.isArray(s)&&s.push(p)}return this.removeSelfCircularReference(t._name,e,i,void 0,p,n),p},partialSerialize:function(e,r,t,o,a,i,s,n,d,l){var c=o.forward,p=a._pK,y=o.forward.relatedTo,f=o.forward.opts?o.forward.opts.polymorphic:void 0;if("hasMany"==c.relType)if(t&&t.partial){var v=t.partial,u=i._pK;if(d&&(R=d[r]=d[r]||[],store.$.defProp(R,"partial",!0)),v){var h,m,$=[],g=this;v.forEach(function(e,r){if(m=r,/^(added|modified)$/.test((h=e).type)){var a="related",d=store.$.getIndex(t,u,m,void 0,store.model[y]);if(-1!=d){var c,v,b,_=t[d];_&&_.$&&(v=Object.assign({},_.$),_=Object.assign({},_),store.$.defProp(_,"$",v)),c=_,f&&_&&(b=_._type?_._type:_.$.model._name,i=store.model[b]);var L=store.peekRecord(i._name,m);if(g.removeBackwardRel(_,o,p,s),_.$.isNew)a="added";else if(_.$.isModified){a="modified";var O=store.$.isDirty(L,i.relations);c=store.$.updateJSON(_,i,O)}else{O=store.$.isDirty(L,i.relations);c=store.$.updateJSON(_,i,O)}if(R){var k={};store.$.defProp(k,"$",{});var w=k.$,A=f?b:y;Object.defineProperties(w,{pkVal:{value:m},type:{value:a},model:{value:f?b:y},record:{value:store.peekRecord(A,m)}}),R.push(k)}g.removeSelfCircularReference(i._name,c,n,void 0,k,l),Lyte.isRecord(c)?c.$.partialType=h.type:(store.$.defProp(c,"$",{}),store.$.defProp(c.$,"partialType",h.type),c.$.hasOwnProperty("pK")||store.$.defProp(c.$,"pK",m)),f&&(c.$.polymorphicType=b),$.push(c)}}else if("removed"==h.type){var P={};m&&"object"==typeof m?Object.assign(P,Object.assign({},m)):P[u]=m;L=store.peekRecord(i._name,m)||store.peekRecord(i._name,m,!0);if(R){k={};store.$.defProp(k,"$",{});w=k.$;if(Object.defineProperties(w,{pkVal:{value:m},type:{value:"removed"},model:{value:f&&h.polymorphicType?h.polymorphicType:y},record:{value:L}}),l){var j="rec"+ ++l.size;P[l.refKey]=j,l.set(j,k)}R.push(k)}store.$.defProp(P,"$",{}),P.$.partialType="removed",f&&h.polymorphicType&&(P.$.polymorphicType=h.polymorphicType),P.$.hasOwnProperty("pK")||(P.$.pK=m),$.push(P)}}),$.length?t=e[r]=$:delete e[r]}}else delete e[r];else if("belongsTo"==c.relType&&t&&Lyte.isRecord(t)){var b;f&&t&&(b=t._type?t._type:t.$.model._name,i=store.model[b]),this.removeBackwardRel(t,o,p,s);var _,L=t;if(t.$.isNew?this.removeBackwardRel(t,o,p,s):(_=store.$.isDirty(t,i.relations),L=store.$.updateJSON(t,i,_)),d){var R=d[r]=d[r]||{},O=t.$.isNew?"added":t.$.isModified?"modified":"related";store.$.defProp(R,"$",{});var k=R.$,w=f?b:y;Object.defineProperties(k,{pkVal:{value:t.$.pK},type:{value:O},model:{value:w},record:{value:store.peekRecord(w,t.$.pK)}})}f&&(L.$||store.$.defProp(L,"$",{}),L.$.polymorphicType=b),this.removeSelfCircularReference(i._name,L,n,void 0,R,l),t=e[r]=L}},removeSelfCircularReference:function(e,r,t,o,a,i,s,n){var d=store.model[e],l=d.fieldList,c=(d.extend,store.$.getpKVal(r,d));store.$.recStack[e]=store.$.recStack[e]||[];store.$.checkAndAddToArray(store.$.recStack[e],c);var p,y=store.peekRecord(e,c),f=Lyte.isRecord(y)?y.$.partial:void 0,v=r&&r.$?r.$.polymorphicType:void 0,u=new Map;if(u.set(r,c),i){p="rec"+ ++i.size;var h={};store.$.defProp(h,"$",{pkVal:y.$.pK,model:y.$.model._name}),i.set(p,h)}var m=store.$.getFromCB("serializer",e,"serializeEmptyRelation");for(var $ in r){var g,b,_,L,R,O=l[$],k=!1;if(!(!("create"==o||Lyte.isRecord(r)&&r.$.isNew)||d._pK!=$)&&1!=t)delete r[$];else if(O)if(O&&"relation"!=O.type&&!t&&Lyte.Transform[O.type]&&Lyte.Transform[O.type].serialize&&r.hasOwnProperty($))r[$]=Lyte.Transform[O.type].serialize(r[$],$,y);else{if(f&&f.hasOwnProperty($)){var w={},A=store.model[O.relatedTo]._pK,P=!1;if(f[$].forEach(function(e,t){if((!0===m||Array.isArray(m)&&m.indexOf(O.relKey))&&O.opts&&/^(id|record)$/.test(O.opts.serialize)?(r[$]=null,P=!0):"partial"==O.opts.serialize&&(w[A]=t,store.$.defProp(w,"$",{}),store.$.defProp(w.$,"partialType","removed"),store.$.defProp(w.$,"pK",t),r[$]=w,P=!0),a){var o=a[$]=a[$]||{};store.$.defProp(o,"$",{});var i=o.$;Object.defineProperties(i,{pkVal:{value:t},type:{value:"removed"},model:{value:O.relatedTo},parent:{value:y},record:{value:store.peekRecord(O.relatedTo,t)}}),O&&O.opts&&/^(id|record)$/.test(O.opts.serialize)&&Object.defineProperties(i,{onlyDetach:{value:!0},relKey:{value:$}})}}),P)continue}if(1!=t&&"state"!=t||!r[$]||"object"!=typeof r[$]||!O||"relation"==O.type){if(t&&"isClone"==t.type&&r[$]&&O&&"relation"==O.type&&((R=!(!O.opts||!O.opts.inherit))||delete r[$]),r[$]&&O&&"relation"==O.type){if(b=O.relatedTo,L=O.relType,R=!(!O.opts||!O.opts.inherit),void 0==(_=store.modelFor(b)))continue;var j=O.relKey,S={};k?this.getRelations(g,O.relKey,_,S):this.getRelations(d,j,_,S);var K=O.opts,E=K?K.serialize:void 0,D=r[j];if("idb"==t)store.$.idbSerialize(D,S,d,_,c,t);else if(s&&R)store.$.toChildJSON(b,L,r[$],$,e,u,n),"belongsTo"==L&&(r[$][store.modelFor(b)._pK]==c&&b==e&&delete r[$],r[$]=Object.assign({},r[$]));else if(t&&!s||s&&!R||"id"==E)store.$.idSerialize(r,S,t,a,i);else if("record"===E){if(0==store.$.recordSerialize(r,$,D,S,d,_,c,t,a,i)&&"hasMany"===L&&(!0===m||Array.isArray(m)&&m.indexOf(O.relKey))&&Array.isArray(y[$])&&y[$].partial&&y[$].partial.size){var T=!0;if(y[$].partial.forEach(function(e){"removed"!==e.type&&(T=!1)}),T){r[$]=[];continue}}}else{if("partial"!==E){delete r[j];continue}store.$.partialSerialize(r,$,D,S,d,_,c,t,a,i)}((D=r?r[j]:void 0)&&"hasMany"==L&&Array.isArray(D)&&0==D.length||"belongsTo"==L&&"object"==typeof D&&0==Object.keys(D).length)&&((!0===m||Array.isArray(m)&&m.indexOf(O.relKey))&&"hasMany"==L&&O.opts&&/^(id|record)$/.test(O.opts.serialize)?r[j]=[]:delete r[j])}}else r[$]=Lyte.deepCopyObject(r[$])}else v&&(g=store.modelFor(v),O=g.fieldList[$],k=!0),n||delete r[$]}if(i){var C=i.refKey;r[C]=p}},removeBackwardRel:function(e,r,t,o,a){if(a)delete e[r.backward.relKey];else if(null!=r.backward){var i=e[r.backward.relKey];if(Array.isArray(i)){for(var s=0;s<i.length;s++)if(this.comparePk(i[s],o))return i.splice(s,1),void(0==i.length&&delete e[r.backward.relKey])}else i&&Lyte.isRecord(i)&&this.comparePk(i,o)&&delete e[r.backward.relKey]}},polymorphicToJSON:function(e,r){var t=e.opts;if(t&&t.polymorphic){if(Array.isArray(r)){var o=[];return r.forEach(function(e){o.push(store.$.polyToJSON(e))}),o}return store.$.polyToJSON(r)}},polyToJSON:function(e){var r=e.$.model;!r.hasOwnProperty("fieldList")&&r._name&&(r=store.model[r._name]);var t=r?r._pK:void 0,o={},a=e.$.pK;return"object"==typeof a?o=Object.assign({},a):o[t]=a,o._type=e._type?e._type:e.$.model._name,o},toChildJSON:function(e,r,t,o,a,i,s){var n=store.modelFor(e),d=n.fieldList,l={};Array.isArray(t)||(t=[t]);for(var c=0;c<t.length;c++){if(!i.get(t[c])){var p=store.$.getpKVal(t[c],n);i.set(t[c],p)}if(!s)for(var y in t[c])d.hasOwnProperty(y)||delete t[c][y];for(var f in n.relations)for(var v=0;v<n.relations[f].length;v++){var u=n.relations[f][v].relKey?n.relations[f][v].relKey:void 0;if(u&&d[u]&&"relation"==d[u].type&&t[c][d[u].relKey])if(t[c][d[u].relKey]&&d[u].opts&&d[u].opts.inherit){if("hasMany"==d[u].relType&&t[c][d[u].relKey])for(var h=0;h<t[c][d[u].relKey].length;h++)if(p=store.$.getpKVal(t[c][d[u].relKey][h],store.modelFor(d[u].relatedTo)),i.get(t[c][d[u].relKey][h])){if(Lyte.isRecord(t[c][d[u].relKey][h])&&i.get(t[c][d[u].relKey][h])){if("object"==typeof p)t[c][d[u].relKey][h]=p;else{var m={};m[store.modelFor(d[u].relatedTo)._pK]=p,t[c][d[u].relKey][h]=m}t[c][d[u].relKey][h]="object"==typeof p?p:{[store.modelFor(d[u].relatedTo)._pK]:p}}}else i.set(t[c][d[u].relKey][h],p),store.$.toChildJSON(d[u].relatedTo,d[u].relType,t[c][d[u].relKey][h],d[u].relKey,d[u].relatedTo,i,s),"object"==typeof t[c][d[u].relKey][h]&&(t[c][d[u].relKey][h]=Object.assign({},t[c][d[u].relKey][h]));else"belongsTo"==d[u].relType&&t[c][d[u].relKey]&&(p=store.$.getpKVal(t[c][d[u].relKey],store.modelFor(d[u].relatedTo)),i.get(t[c][d[u].relKey])?t[c][d[u].relKey]="object"==typeof p?p:{[store.modelFor(d[u].relatedTo)._pK]:p}:(i.set(t[c][d[u].relKey],p),store.$.toChildJSON(d[u].relatedTo,d[u].relType,t[c][d[u].relKey],d[u].relKey,d[u].relatedTo,i,s),t[c][d[u].relKey]=Object.assign({},t[c][d[u].relKey])));0==Object.keys(t[c][d[u].relKey]).length&&delete t[c][d[u].relKey]}else(Lyte.isRecord(t[c][d[u].relKey])||"hasMany"==d[u].relType&&Lyte.isRecord(t[c][d[u].relKey][0]))&&(this.getRelations(n,d[u].relKey,store.modelFor(d[u].relatedTo),l),store.$.idSerialize(t[c],l,!0))}Lyte.isRecord(t[c])&&(t[c]=Object.assign({},t[c]))}},toJSONObj:function(e,r,t,o,a,i,s){var n,d,l=e._name,c=(e._pK,e._fldGrps.inherit&&Object.keys(e._fldGrps.inherit).length);if(n=1!=t&&"state"!=t||i&&(!i||c)?Lyte.deepCopyObject(r):Object.assign({},r),Lyte.isRecord(n))d=n.$.pK;else{if(!store.$.getpKVal(n,e))return;if(!store.peekRecord(l,store.$.getpKVal(n,e)))return;d=store.peekRecord(l,store.$.getpKVal(n,e)).$.pK}var p,y=a?a.obj:void 0;return y&&!y.has(d)&&(y.set(d,{}),p=y.get(d)),this.removeSelfCircularReference(l,n,t,o,p,a&&a.ref?a.ref:void 0,i,s),"idb"==t&&this.removeNotNeededKeys(l,n,e.idb),n},toJSON:function(e,r,t,o,a,i,s){var n,d=store.model[e];if(store.$.recStack={},Array.isArray(r)){for(var l=[],c=0;c<r.length;c++)n=this.toJSONObj(d,r[c],t,o,a,i,s),l.push(n);return l}return r&&("object"==typeof r||Lyte.isRecord(r))&&(n=this.toJSONObj(d,r,t,o,a,i,s)),store.$.recStack={},n},createCopy:function(e){if(Array.isArray(e)){if(e.save){for(var r=[],t=0;t<e.length;t++){var o=Lyte.deepCopyObject(e[t]);r.push(o)}return r}}else if(e&&(Lyte.isRecord(e)||"object"==typeof e))return Lyte.deepCopyObject(e);return e},compareRecords:function(e,r,t,o,a){t=a._arrPk;if(Lyte.isRecord(e)&&Lyte.isRecord(r)&&t.length){if(o&&e._type&&o!==e._type)return!1;for(var i=t.length,s=0;s<i;s++){var n=t[s];if(e[n]&&r[n]&&e[n]!==r[n])return!1}return!0}return!1},hasRecordInArray:function(e,r,t,o,a){if(Lyte.isRecord(r)&&t)for(var i=e.length,s=0;s<i;s++){var n=e[s];if(!o||n._type===o)if(a){if(this.compareRecords(n,r,t,void 0,r.$.model))return!0}else if(o&&n._type&&o===r._type&&n[t]===r[t]||n[t]===r[t])return!0}return!1},hasDuplicateRelation:function(e,r,t,o,a){var i=a.isComp;return Array.isArray(r)?i||r.isPolymorphic||!r._recMap?this.hasRecordInArray(r,e,t,o,i):r._recMap.get(e[t]):!(!r||!Lyte.isRecord(r))&&this.compareRecords(e,r,t,o,a)},checkPresenceInArray:function(e,r){return e&&e.some(function(e){return e===r})},checkAndAddToArray:function(e,r){if(this.checkPresenceInArray(e,r))return-1;e.push(r)},deleteFromArray:function(e,r){var t=e.indexOf(r);-1!=t&&e.splice(t,1)},genPk:function(e,r,t){var o;e.forEach(function(e){o=t[e].type;var a=r[e]=Math.floor(1e5*Math.random()+1);"string"==o&&(r[e]=a.toString())})},generateRandomPk:function(e,r,t,o){for(this.genPk(t,r,o);this.isDuplicateRecord(e,r,t.toString());)this.genPk(t,r,o)},pkPresence:function(e,r){var t=!0;return r.forEach(function(r){e.hasOwnProperty(r)&&e[r]||(t=!1)}),t},newRecord:function(e,r,t){var o=store.modelFor(e);if(void 0===o)return Lyte.warn("LD02","Model",e),new error1(void 0,void 0,Lyte.getErrorMessage("LD02","Model",e));if(void 0===r&&(r={}),r&&"object"!=typeof r)return Lyte.warn("LD25",r),new error1(void 0,void 0,Lyte.getErrorMessage("LD25",r));var a=o.fieldList,i={},s=new error1,n=o._arrPk;for(var d in this.pkPresence(r,n)?this.isDuplicateRecord(o,r,n)&&store.$.setError(s,n,{code:"ERR16",message:Lyte.errorCodes.ERR16}):this.generateRandomPk(o,r,n,a),a){"hasMany"==(k=a[d]).relType&&(i[d]=[]);var l=r[d];if("relation"!=k.type&&(void 0!==l&&""!==l||k.hasOwnProperty("default")&&(l=i[d]=store.$.getDefaultVal(i,k.default)),!t)){var c=k;c.any&&Array.isArray(c)||(c=[c]);for(var p=c.length,y=!0,f=0;f<p;f++){var v=c[f];for(var u in v){1!=(O=Lyte.checkProperty(u,l,d,v[u],v,r,i,e))&&!0===y&&("object"==typeof O&&(O.value=l),y=O)}}!0!==y&&store.$.setError(s,d,y)}}for(var h in r)i[h]=r[h];i=new Record(e,i),store.$.cmpSet(i.$,"isNew",!0),store.$.changePersist(i,!1);var m=o.relations;for(var $ in m){var g=m[$];for(f=0;f<g.length;f++){var b=g[f],_=b.relKey,L=b.opts?b.opts.polymorphic:void 0;if(i&&i[_]){var R=r[_];i[_]=void 0;var O,k=g[f],w={};if(1!=(O=this.getRelations(o,k.relKey,store.modelFor(k.relatedTo),w))){store.$.setError(s,k.relKey,{code:O,data:g,message:Lyte.errorCodes[O]});continue}var A=store.modelFor(k.relatedTo),P=A._pK,j=A.isComp,S=j?void 0:A.fieldList[A._pK].type;if(Array.isArray(R)){if("belongsTo"==g[f].relType){store.$.setError(s,k.relKey,{code:"ERR21",data:R,message:Lyte.errorCodes.ERR21});continue}}else R=[R];s[k.relKey]=[];for(var K=0;K<R.length;K++){var E=void 0,D=k.relatedTo;if(R[K]&&Lyte.isRecord(R[K]))E=R[K];else if(j&&"object"==typeof R[K]){var T;if(-1!=(T=store.$.getIndex(A.data,P,store.$.getpKVal(R[K],A))))E=A.data[T];else{if(L){if(!R[K]||!R[K].hasOwnProperty("_type")){store.$.setError(s,k.relKey,{code:"ERR22",data:R[K],message:Lyte.errorCodes.ERR22});continue}D=R[K]._type}E=this.newRecord(D,R[K])}}else if(R[K]&&typeof R[K]==S.toLowerCase())E=store.peekRecord(D,R[K]);else if(R[K]&&"object"==typeof R[K]){if(L){if(!R[K]||!R[K].hasOwnProperty("_type")){store.$.setError(s,k.relKey,{code:"ERR22",data:R[K],message:Lyte.errorCodes.ERR22});continue}D=R[K]._type}E=this.newRecord(D,R[K])}E&&E.$&&E.$.isError?store.$.setError(s,k.relKey,{code:"ERR15",data:R[K],message:Lyte.errorCodes.ERR15,error:Object.assign({},E)}):E&&E.$&&!E.$.isError&&1!=(O=this.establishLink(w.forward,w.backward,i,E,void 0,!1))&&store.$.setError(s,k.relKey,{code:O,data:R[K],message:Lyte.errorCodes[O]})}if(0==s[k.relKey].length&&delete s[k.relKey],"hasMany"==g[f].relType){var C=_;void 0==i[C]&&(i[C]=[]),i[C].add||(L&&store.$.defProp(i[C],"polymorphic",!0),store.$.defArrUtls(i[C]),store.$.defUtls(i[C],store.modelFor(g[f].relatedTo),i,C),store.$.defPolyUtls(i[C]))}}}}if(s&&s.$&&Object.keys(s.$.error).length>0)return s;var M=store.$.toRelate[o._name],N=i.$.pK;if(M&&M.has(N)&&(store.$.establishToRelated(i,M.get(N)),M.delete(N)),o.didLoad){var B=o.didLoad;for(f=0;f<B.length;f++)B[f].apply(i)}return this.handleArrOp(o.data,"push",i),this.checkAndAddToArray(o.dirty,i.$.pK),o.emit("add",[i]),store.emit("add",[o._name,i]),t&&(i.$.validatedOnCreate=!1),i},toInsertData:function(e,r,t,o){var a=store.model[e],i=this.insertIntoStore(e,r[e],t,!0,void 0,void 0,void 0,void 0,o);return a&&delete a.rel,i},insertIntoStore:function(e,r,t,o,a,i,s,n,d){if(Array.isArray(r)){h=[];for(var l=0;l<r.length;l++)h[l]=this.insertIntoStore(e,r[l],t,o,a),h[l]&&h[l].$&&h[l].$.isError&&(h.$=h.$||store.$.defProp(h,"$",{}),store.$.cmpSet(h.$,"isError",!0))}else if(r&&"object"==typeof r&&Object.keys(r).length){var c=store.modelFor(e);if(r._type&&c.extendedBy&&(c=c.extendedBy[r._type]?store.modelFor(r._type):void 0),!c){var p=store.modelless,y=p[e]=p[e]||{};if(d){if(y._pK&&y._pK!==d)return void Lyte.error("");y._pK=d,y._arrPk=[d]}else y._pK=d="id",y._arrPk=[d];y.data=y.data||[],y.data.modelless||(store.$.defProp(y.data,"modelless",!0),store.$.defProp(y.data,"pK",y._pK));var f=store.$.getInd(y.data,d,r[d]);return-1==f?store.$.handleArrOp(y.data,"push",r):store.$.handleArrOp(y.data,"replaceAt",r,f),r}if(Lyte.isRecord(r)&&!n)return;if(s&&r&&c){var v=c.relations;for(var u in v){v[u].forEach(function(e){var t=e.relKey,o=e.relType;if("hasMany"==o&&r.hasOwnProperty(t)&&Array.isArray(r[t])&&r[t].length){var a=[];r[t].forEach(function(e){Lyte.isRecord(e)?a.push(e.$.pK):a.push(e)}),r[t]=a}else"belongsTo"==o&&r.hasOwnProperty(t)&&Lyte.isRecord(r[t])&&(r[t]=r[t].$.pK)})}}if(n){m=new Record(c._name,r,c._pK,n);var h=this.validateAndPush(c,m,void 0,n)}else if(this.isDuplicateRecord(c,r,c._pK))(h=this.validateAndMerge(c,r,a))&&h.data?h=h.data:h&&h.type&&Lyte[h.type].apply(Lyte,h.args||[]);else{var m=new Record(c._name,r);c.data.push(m);var $=store.$.toRelate[c._name],g=m.$.pK;t&&(store.$.saveParent=m),h=this.validateAndPush(c,m,a),$&&$.has(g)&&(store.$.establishToRelated(m,$.get(g)),$.delete(g))}t&&(store.$.saveParent=void 0),o&&(store.$.recStack={})}return h},removeFromStore:function(e,r,t,o,a,i,s){var n=e.data,d=e._name;if(0!=n.length){Array.isArray(r)||(r=[r]);for(var l=e._pK,c=0;c<r.length;c++){var p=this.getIndex(n,l,r[c]);if(-1!=p){var y,f=n[p],v=f.$.pK,u=e.relations;if(f.$.isNew&&(i=a=void 0,t=!0),Object.keys(u).length&&this.toDemolishRelation(e,p,o,i,a,s),!0!==a&&!1!==i&&(y=this.handleArrOp(n,"removeAt",void 0,p,1),e.emit("remove",[y[0]]),store.emit("remove",[e._name,y[0]]),e._properties&&store.$.demoLishObserverBindings(f,e._properties)),!0===t){store.$.cmpSet(f.$,"isUnloaded",!0);var h=f.$.__scpObj;for(var m in h){var $=h[m].split("_"),g=Lyte.nestScp[$[0]];g&&Lyte.removeNestScp(g._data,$[0],$[1],void 0,f,void 0,void 0,{model:d,pK:f.$.pK,attr:m})}if(_=store.model.cachedQueries){if((R=_[d])&&R.length)for(var b=R.length-1;b>=0;b--){if((O=R[b]).hasDeletedRecords)if(O.data)-1!==(k=O.data[d].indexOf(f))&&R.splice(b,1)}}}if(1!=i){var _,L=y?y[0]:f;if(!t)if(store.$.cmpSet(L.$,"isDeleted",!0),store.$.changePersist(L,!0),!0!==a&&!1!==i&&(L.$.isNew||L.$.isModified)&&store.$.deleteFromArray(e.dirty,L.$.pK),L.$.isNew||store.$.addTo_Del(e,L,p),_=store.model.cachedQueries){var R;if((R=_[d])&&R.length)for(b=R.length-1;b>=0;b--){var O,k;if((O=R[b])&&O.data)-1!=(k=O.data[d].indexOf(f))&&(O.hasDeletedRecords=!0)}}Array.isArray(e.dirty)&&-1!=(k=e.dirty.indexOf(v))&&e.dirty.splice(k,1)}}}}},getIndex:function(e,r,t,o,a){return(a?a.isComp:r.split(",").length>1)?this.getCompInd(e,t,o,a):this.getInd(e,r,t,o)},getCompInd:function(e,r,t,o){for(var a=0;e&&a<e.length;a++){var i=e[a];if((!t||e[a]._type===t)&&store.adapter.$.compareObjects(store.$.getpKVal(i,o),r))return a}return-1},getInd:function(e,r,t,o){for(var a=0;e&&a<e.length;a++){var i=e[a];if((!o||i._type===o)&&(i[r]==t||Lyte.isRecord(i)&&i.$.get&&i.$.get(r)==t))return a}return-1},isDuplicateRecord:function(e,r){var t=e.data,o=e._pK,a=e.isComposite;if(t.length){if(!a&&e.data._recMap){var i=r[o];return void 0!==i&&void 0!==e.data._recMap.get(i.toString())}return t.some(function(t){if(store.adapter.$.compareObjects(store.$.getpKVal(r,e),store.$.getpKVal(t)))return!0})}return!1},validateAndPush:function(e,r,t,o){e.rel||(e.rel={});for(var a=e._arrPk,i=a.length,s=0;s<i;s++){var n=a[s];if(!r.hasOwnProperty(n))return l=e.data.indexOf(r),e.data.splice(l,1),new error1(n,{code:"ERR23",data:r,message:Lyte.errorCodes.ERR23});if(void 0==r[n]||null==r[n])return l=e.data.indexOf(r),e.data.splice(l,1),new error1(n,{code:"ERR26",data:r,message:Lyte.errorCodes.ERR26})}if(o)return r=this.validateJSON(e,r,void 0,void 0,void 0,o);var d=void 0==r.$.pK||"object"==typeof r.$.pK?r.$.pK:r.$.pK.toString();e.data._recMap.set(d,r),r=this.validateJSON(e,r,void 0,void 0,t);var l=e.data.indexOf(r);if(e.data.splice(l,1),this.handleArrOp(e.data,"push",r),e.didLoad){var c=e.didLoad;for(s=0;s<c.length;s++)c[s].apply(r)}return e.emit("add",[r]),store.emit("add",[e._name,r]),r},validateAndMerge:function(e,r,t,o){if(e.rel||(e.rel={}),void 0===store.$.getpKVal(r,e))return{type:"error",args:["LD28",e._name,Lyte.isRecord(r)?r:JSON.stringify(r)]};var a=store.peekRecord(e._name,store.$.getpKVal(r,e));if(!a||!Lyte.isRecord(a))return{type:"error",args:["LD04",Lyte.isRecord(r)?r:JSON.stringify(r)]};if(this.mergeData(a,r,t,o),e.didLoad)for(var i=e.didLoad,s=0;s<i.length;s++)i[s].apply(a);return{data:a}},mergeData:function(e,r,t,o){if(e&&r){var a,i=e.$.model,s=!1;for(var n in o&&store.adapter.$.mergeError(i,e,r),r)if(a=i.fieldList[n]){if("relation"!=a.type){var d=store.$.getDsrzEmpData(a,i._name),l=!d&&r[n];r.hasOwnProperty(n)&&(l||d)&&Lyte.Transform.hasOwnProperty(a.type)&&Lyte.Transform[a.type].hasOwnProperty("deserialize")&&(r[n]=Lyte.Transform[a.type].deserialize(r[n],n,i._name,store.$.getpKVal(r,i)));var c={};i._properties&&i._properties.hasOwnProperty(n)&&(c[n]=i._properties[n],store.$.demoLishObserverBindings(e,c)),store.$.cmpSet(e,n,r[n],void 0,!0),i._properties&&i._properties.hasOwnProperty(n)&&(s=!0)}else if(a&&"relation"==a.type){var p={},y={};store.$.getRelations(e.$.model,n,store.modelFor(a.relatedTo),y);var f=store.model[y.forward.relatedTo];if("hasMany"==a.relType&&t&&t[n]&&t[n].replace){var v=[];e[n]._recMap.forEach(function(e,r){v.push(r)}),v.forEach(function(r){store.peekRecord(a.relatedTo,r).$.isNew?store.$.removeFromStore(store.modelFor(a.relatedTo),r,!0):(store.$.demolishLink(store.peekRecord(a.relatedTo,r),store.peekRecord(a.relatedTo,r).$.model._pK,e,y.forward.relKey,void 0,void 0,!0,!0),null!=y.backward&&store.$.demolishLink(e,i._pK,store.peekRecord(a.relatedTo,r),y.backward.relKey,y.forward,void 0,!0,!0))}),delete t[n]}var u=this.compareRelations(e,r,n,a,t?t[n]:void 0,p,o);this.mergeRecords(p,u,i,f,e,n,r,y,t,o)}}else"$"!=n&&store.$.cmpSet(e,n,r[n],void 0,!0);s&&store.$.establishObserverBindings(e,i._properties)}},mergeRecords:function(e,r,t,o,a,i,s,n,d,l){if(!n){n={};store.$.getRelations(t,i,o,n)}var c=t._pK;if(("hasMany"==n.forward.relType&&store.$.isEmptyArray(s[i])&&Array.isArray(e.remove)&&a&&a[i]&&e.remove.length!=a[i].length||a&&!a[i]&&Array.isArray(s[i]))&&(store.$.cmpSet(a,i,[],void 0,!0),store.$.establishObserverBindings(a,a.$.model._properties),store.$.defArrUtls(a[i]),store.$.defPolyUtls(a[i]),store.$.defUtls(a[i],o,a,i)),Array.isArray(e.add)&&e.add.forEach(function(e){store.$.createAndRelate(t,o,a,i,e,n,d)}),Array.isArray(e.remove)&&e.remove.forEach(function(e){var r=e.pK,t=e.model;store.$.demolishLink(a,c,store.peekRecord(t,r),n.backward.relKey,n.forward,n.backward,!0),store.$.demolishLink(store.peekRecord(t,r),store.modelFor(t)._pK,a,n.forward.relKey,n.backward,n.forward,!0)}),a&&a.hasOwnProperty(i)&&(store.$.deleteDeepNest(a,i),Array.isArray(a[i])&&a[i].hasOwnProperty("partial"))){var p=[];a[i].partial.forEach(function(e,r){p.push(r),a[i].partial.delete(r)})}switch(r){case 0:Lyte.isRecord(a[i])&&(store.$.demolishLink(a,c,a[i],n.backward.relKey,n.forward,n.backward,!0),store.$.demolishLink(a[i],o._pK,a,n.forward.relKey,n.backward,n.forward,!0)),store.$.createAndRelate(t,o,a,i,s[i],n,d);break;case 1:break;case 2:this.mergeData(a[i],s[i],void 0,l)}},compareRelations:function(e,r,t,o,a,i,s){var n=store.modelFor(o.relatedTo),d=n._pK;if("belongsTo"==o.relType)return a&&"removed"===a.$.type&&(!r||r&&store.$.comparePk(e,store.$.getpKVal(r,n)))?1:this.compareRecordWithObj(e[t],r[t],d,a,s);var l=!1;if(a&&a.partial&&(l=!0),!l&&(!e.hasOwnProperty(t)||e&&e.hasOwnProperty(t)&&(store.$.isEmpty(e[t])||store.$.isEmptyArray(e[t]))))return i?void(r[t]||[]).forEach(function(e){(i.add=i.add||[]).push(e)}):0;for(var c=r[t]?r[t].length:0,p=[],y=0;y<c;y++){var f=r[t][y];if(!a||!a[y]||"removed"!=a[y].$.type){var v=this.getIndex(e[t],d,"object"==typeof f?store.$.getpKVal(f,n):f);if(-1!=v){p.push(e[t][v].$.pK);var u=this.compareRecordWithObj(e[t][v],f,d,a?a[y]:void 0,s);1==u&&0,2==u?this.mergeData(e[t][v],f,a?a[y]:void 0,s):0==u&&0}else{i&&(i.add=i.add||[]).push(f),0}}}i&&!l&&(e[t]||[]).forEach(function(e){var r=e.$.pK;-1==p.indexOf(r)&&(i.remove=i.remove||[]).push({pK:r,model:e.$.model._name})})},compareRecordWithObj:function(e,r,t,o,a){if(!e||!Lyte.isRecord(e))return 0;var i=e.$.model,s=(i._pK,i.isComp),n=i.fieldList;if(!s&&typeof r==(l=i.fieldList[t]).type)return e[t]==r?1:0;if(r&&"object"==typeof r){if(!store.$.comparePk(e,store.$.getpKVal(r,i)))return 0;if(Lyte.isRecord(r)&&r===e)return 1;for(var d in r){var l;if(l=n[d]){if("relation"==l.type){var c={},p=this.compareRelations(e,r,d,l,o?o[d]:void 0,c,a);this.mergeRecords(c,p,i,store.modelFor(l.relatedTo),e,d,r,void 0,o)}else if(e[d]!=r[d])return 2}else if(e[d]!=r[d])return 2}return 1}return 0},validateJSON:function(e,r,t,o,a,i){var s=o?o.toValidate:void 0,n=s&&Object.keys(s).length?s:e.fieldList,d=!!e.extend;for(var l in r)if(!t||-1!=t.indexOf(l)){var c=n[l];if(c){if("relation"==c.type&&r[l]){var p=o&&o.toPartialAdd?o.toPartialAdd[l]:void 0;if(1!=(m=this.handleRelation(l,e,c,r,p,a,i)))return new error1(l,{code:m,data:r,message:Lyte.errorCodes[m]});"hasMany"!=c.relType||r[l].add||(store.$.defArrUtls(r[l]),store.$.defPolyUtls(r[l]),store.$.defUtls(r[l],store.model[c.relatedTo],r,l))}else if(c.type){var y=c;void 0===r[l]&&y.default&&(r[l]=store.$.getDefaultVal(r,y.default));var f=store.$.getDsrzEmpData(c,e._name),v=!f&&r[l];r.hasOwnProperty(l)&&(v||f)&&Lyte.Transform.hasOwnProperty(y.type)&&Lyte.Transform[y.type].hasOwnProperty("deserialize")&&(r[l]=Lyte.Transform[y.type].deserialize(r[l],l,e._name,store.$.getpKVal(r,e)))}}else if(d){var u=store.modelFor(e.extend),h=u.fieldList[l];if(h&&"relation"==h.type){var m;p=o&&o.toPartialAdd?o.toPartialAdd[l]:void 0;if(1!=(m=this.handleRelation(l,u,h,r,p)))return new error1(l,{code:m,data:r,message:Lyte.errorCodes[m]});"hasMany"!=h.relType||r[l].add||(store.$.defArrUtls(r[l]),store.$.defPolyUtls(r[l]),store.$.defUtls(r[l],u,r,l))}}}return r},handleRelation:function(e,r,t,o,a,i,s){var n={};if(r.rel.hasOwnProperty(e))n=r.rel[e];else{var d=this.getRelations(r,e,store.modelFor(t.relatedTo),n);if(!0!==d)return d;r.rel[e]=n}return this.solveRelation(n,r,store.modelFor(t.relatedTo),e,o,a,i,s)},getRelations:function(e,r,t,o){if(void 0==t)return Lyte.error("LD05",e.fieldList[r].relatedTo,r,e._name),"ERR11";if(o.forward=e.fieldList[r],o.backward=this.getBackwardRel(e,o.forward,t),void 0===o.backward){var a={type:"relation",relatedTo:e._name,dummy:o.forward.relKey,relKey:void 0};t.relations[e._name]=t.relations[e._name]||[],t.relations[e._name].push(a),o.backward=a}return!0},getBackwardRel:function(e,r,t){var o,a,i;if(r.opts){if(o=r.opts.inverse,a=r.opts.polymorphic,null===o)return;if(a){var s=t.extendedBy;if(s)for(var n in s){var d=store.modelFor(n);if(d.relations[e._name]){t=d;break}}}}if(o&&""!=o)i=o;else{var l,c=t.relations[e._name],p=store.modelFor(e.extend);!c&&p&&t.relations[p._name]&&(c=t.relations[p._name],l=!0),i=!c||1!=c.length||c[0].opts&&c[0].opts.inverse&&c[0].opts.inverse!==r.relKey||l&&!(l&&c[0].opts&&c[0].opts.polymorphic)?void 0:c[0].relKey}if(!i){var y=t.relations[e._name],f=store.modelFor(e.extend);if(!y&&f&&t.relations[f._name]&&t.relations[f._name].opts&&t.relations[f._name].opts.polymorphic&&(y=t.relations[f._name]),r.dummy&&y){for(var v=0;v<y.length;v++)if(y[v]&&y[v].relKey&&y[v].relKey==r.dummy){i=y[v].relKey;break}}else if(y)for(v=0;v<y.length;v++){if(y[v]&&y[v].opts&&y[v].opts.inverse&&y[v].opts.inverse===r.relKey){i=y[v].relKey;break}if(y[v]&&y[v].dummy&&y[v].dummy==r.relKey){i=y[v];break}}}return i&&i.dummy?i:i&&e._fldGrps.inverse.hasOwnProperty(r.relatedTo)&&!r.dummy&&i&&e.relations[r.relatedTo]&&e.relations[r.relatedTo].length>1&&!o&&(!t.fieldList[i].opts||t.fieldList[i].opts&&!t.fieldList[i].opts.inverse)?void 0:i&&t?t.fieldList[i]:void 0},solveRelation:function(e,r,t,o,a,i,s,n){e.backward;var d=e.forward,l=s?s[o]:void 0,c=l&&l.partial,p=(r._pK,[]);if(i)p=i;else if(c){if(Array.isArray(a[o]))p=a[o].splice(0,a[o].length)}else{if(a[o]&&(a[o].add||Lyte.isRecord(a[o])))return!0;if(Array.isArray(a[o])){if("belongsTo"==d.relType)return"ERR21"}else a[o]=[a[o]];p=a[o].splice(0,a[o].length),"belongsTo"==d.relType&&(a[o]=void 0)}for(var y=0;y<p.length;y++){var f;if(1!=(f=this.createAndRelate(r,t,a,o,p[y],e,l,n)))return f}return!0},createAndRelate:function(e,r,t,o,a,i,s,n){if(!i.backward&&(i.forward.relatedTo===e._name&&(i.backward=i.forward),void 0===i.backward))return"ERR12";var d,l=e._pK,c=r.isComp,p=i.forward&&i.forward.opts?i.forward.opts.polymorphic:void 0,y=s&&s.hasOwnProperty(a[l])?s[a[l]]:s;if(c||typeof a!=r.fieldList[r._pK].type?"object"!=typeof a||Lyte.isRecord(a)||(d=this.insertIntoStore(r._name,a,void 0,void 0,y,void 0,void 0,n)):d=store.peekRecord(r._name,a),d&&d.$&&d.$.isError){store.$.cmpSet(t.$,"isError",!0);var f={code:"ERR24",message:Lyte.errorCodes.ERR24,data:t,error:d.$.error};store.$.cmpSet(t.$.error,o,f)}else d?this.hasDuplicateRelation(d,t[o],r._pK,p?a._type:void 0,r)||this.establishLink(i.forward,i.backward,t,d,void 0,!0,!1):this.addToRelate(e._name,t,i,a);return!0},singleEstablishLink:function(e,r,t){var o=t.$._relationships,a=r.$.model._name,i=e.relKey;o[a]=o[a]||{},o[a][i]=o[a][i]||[],this.hasDuplicateRelation(r,o[a][i],r.$.model._pK,void 0,r.$.model)||o[a][i].push(r)},establishLink:function(e,r,t,o,a,i,s,n){if(!o)return"ERR13";if(!this.checkForCorrectRelation(e,o))return"ERR14";var d=e.relKey,l=e.opts&&e.opts.polymorphic,c=l?o._type:void 0,p={};if("belongsTo"==e.relType)t[d]!==o&&store.$.cmpSet(t,d,o,void 0,!0),t.$.partial&&Object.keys(t.$.partial).length&&t.$.partial[d]&&delete t.$.partial[d];else if("hasMany"===e.relType){if(t[d]||store.$.cmpSet(t,d,[],void 0,!0),!t[d].model){var y=o.$.model;l&&c&&(store.$.defProp(t[d],"polymorphic",!0),y=store.modelFor(y.extend)),store.$.establishObserverBindings(t,t.$.model._properties),store.$.defArrUtls(t[d]),store.$.defPolyUtls(t[d]),store.$.defUtls(t[d],y,t,d)}var f,v=e?store.modelFor(e.relatedTo):void 0;0!=s&&this.hasDuplicateRelation(o,t[d],e?v._pK:void 0,c,v)||(void 0!=a?this.handleArrOp(t[d],"insertAt",o,a):this.handleArrOp(t[d],"push",o)),(!i||n)&&e.opts&&e.opts.serialize&&(f=store.$.partialData(t,d,o.$.pK,"added",void 0,n),p.relKey=d,p.model=t.$.model._name)}var u=!1;if(i||(u=!f),null===r)return o.hasOwnProperty(h)&&delete o[h],!0;if(r.dummy||e==r)this.singleEstablishLink(e,t,o);else{var h=r.relKey,m=o.$.model;if(!this.checkForCorrectRelation(r,t))return"ERR14";if("belongsTo"==r.relType)void 0!=o[h]&&o[r.relKey]!==t&&this.toDemolishLink(m,o,r,i),o[h]!==t&&store.$.cmpSet(o,h,t,void 0,!0),o.$.partial&&Object.keys(o.$.partial).length&&o.$.partial[h]&&delete o.$.partial[h];else if("hasMany"===r.relType){o[h]||store.$.cmpSet(o,h,[],void 0,!0),o[h].model||(store.$.defArrUtls(o[h]),store.$.defPolyUtls(o[h]),store.$.defUtls(o[h],t.$.model,o,h));var $,g,b=r?store.modelFor(r.relatedTo):void 0;this.hasDuplicateRelation(t,o[h],r?b._pK:void 0,c,b)||this.handleArrOp(o[h],"push",t),(!i||n)&&r.opts&&r.opts.serialize&&($=store.$.partialData(o,h,t.$.pK,"added",void 0,n)),i||(g=!$)}}if(u){if(e.opts&&e.opts&&e.opts.deepNest){c="added";t[e.relKey].partial&&t[e.relKey].partial.get(o.$.pK)&&(c=t[e.relKey].partial.get(o.$.pK).type),store.$.setDeepNest(t,e.relKey,o.$.pK,c),g=!1}g&&r&&r.opts&&r.opts.deepNest&&store.$.setDeepNest(o,r.relKey,t.$.pK,"added")}return!0},toDemolishRelation:function(e,r,t,o,a,i){var s=e.data[r],n=e.relations;for(var d in n)for(var l=n[d],c=0;c<l.length;c++){var p=l[c],y=store.modelFor(p.relatedTo);if(y){var f=store.$.getBackwardRel(e,p,y);if(!s[p.relKey]&&!p.dummy&&p!==f)continue;this.toDemolishLink(e,s,p,t,o,a,i)}}},toDemolishLink:function(e,r,t,o,a,i,s){var n=r[t.relKey],d=e._pK,l=store.modelFor(t.relatedTo);if(l){l._pK,t.relatedTo;var c=this.getBackwardRel(e,t,l);t.opts&&t.opts.serialize;(t.dummy||t===c)&&(n=this.getRelatedRecord(r,t.relatedTo,t.dummy?t.dummy:t.relKey));if(c)if(Array.isArray(n))for(var p=0;p<n.length;p++)this.demolishLink(r,d,n[p],c.relKey,t,c,o,void 0,a,i,s);else Lyte.isRecord(n)&&this.demolishLink(r,d,n,c.relKey,t,c,o,void 0,a,i,s)}},demolishSingleRelation:function(e,r,t,o,a,i,s){var n,d;Lyte.isRecord(e)&&(n=e.$._relationships)&&n[r]&&n[r][t]&&!1!==i&&!0!==s&&(n=n[r][t],(d=this.getIndex(n,a,o[a]))>-1&&n.splice(d,1))},demolishLink:function(e,r,t,o,a,i,s,n,d,l,c){var p,y=t[o],f=t.$.model,v=e.$.pK,u=y?y.polymorphic:void 0;if(Array.isArray(y)){var h=this.getIndex(y,r,v,u?e._type:void 0),m=t.$._attributes,$=m.hasOwnProperty(o)&&m[o]&&m[o].length?t.$.getInitialValues(o):void 0,g=!(!y.partial||!y.partial.has(v)||"added"!=y.partial.get(v).type);-1!=h&&(g||!1!==d&&!0!==l)&&(u&&(p=y[h].$.model._name),this.handleArrOp(t[o],"removeAt",void 0,h,1)),!n&&$&&(store.$.hasRecordsArrayChanged(t,o,$)||(delete t.$._attributes[o],Object.keys(t.$._attributes).length||(store.$.cmpSet(t.$,"isModified",!1),store.$.changePersist(t,!0),t.$.isNew||(store.$.deleteFromArray(f.dirty,t[f._pK]),(!t.$.dN||t.$.dN&&!Object.keys(t.$.dN).length)&&store.$.removeParentNesting(t)))))}else y&&("object"==typeof y||Lyte.isRecord(y))&&!1!==d&&!0!==l?void 0!=Lyte&&void 0!=Lyte.objectUtils?Lyte.objectUtils(t,"delete",o,void 0,void 0,!0):delete t[o]:this.demolishSingleRelation(t,e.$.model._name,a.relKey,e,r,d,l);if(i||(i=f.fieldList[o]),(!s||c)&&!0!==d){var b,_;if(i){i.opts&&("partial"==i.opts.serialize,_=!!i.opts.serialize,b=i.opts.deepNest);var L=i?i.relType:void 0}if("belongsTo"==L&&_&&!e.$.isNew){var R=t.$.partial=t.$.partial||{};c?(R&&R.hasOwnProperty(o)&&R[o].has(v)&&R[o].delete(v),b&&store.$.deleteDeepNest(t,o,v),b=!1):((R=R[o]=R[o]||new Map).has(v)||R.set(v,{}),(R=R.get(v)).type="removed")}i&&i.opts&&i.opts.serialize&&(b=(!store.$.partialData(t,o,v,"removed",p,c)||"hasMany"!=L)&&b),b&&(store.$.makeDirty("dirty",t,"removed",i,v),store.$.addDeepNest(t))}},rllBckRecArr:function(e,r,t,o){var a={},i=t._pK,s=store.modelFor(o.relatedTo)._pK;store.$.getRelations(t,o.relKey,store.modelFor(o.relatedTo),a);for(var n=e.length-1;n>=0;n--){var d=e[n].records;if("added"==e[n]._type)for(var l=0;l<d.length;l++){(f=d[l])&&f.$&&f.$.hasOwnProperty("pK")&&(this.demolishLink(f,s,r,a.forward.relKey),null!=a.backward&&this.demolishLink(r,i,f,a.backward.relKey,a.forward))}else if("removed"==e[n]._type)for(l=d.length-1;l>=0;l--){(f=d[l])&&f.$&&f.$.hasOwnProperty("pK")&&this.establishLink(a.forward,a.backward,r,f,e[n]._indices[l])}else if("changed"==e[n]._type){var c=r[o.relKey];Array.isArray(c)||(c=[c]);for(var p=c.length,y=0;y<p;y++){(f=c[0])&&f.$&&f.$.hasOwnProperty("pK")&&(this.demolishLink(f,s,r,a.forward.relKey),null!=a.backward&&this.demolishLink(r,i,f,a.backward.relKey,a.forward))}Array.isArray(d)||(d=[d]);for(l=0;l<d.length;l++){var f;"string"==typeof(f=d[l])&&(f=store.peekRecord(a.forward.relatedTo,f)),f&&f.$&&f.$.hasOwnProperty("pK")&&this.establishLink(a.forward,a.backward,r,f,void 0)}}}},sortBy:function(e,r){var t=store.$.mapBy.call(this,e),o=this.model.fieldList[e];o&&"string"==o.type?(t.sort(),"desc"==r&&t.reverse()):(t.sort(function(e,r){return e-r}),"desc"==r&&t.sort(function(e,r){return r-e}));for(var a=this.slice(0),i=[],s=0;s<t.length;s++)if(void 0!=t[s]){var n=store.$.getIndex(a,e,t[s]);i.push(a[n]),a.splice(n,1)}return a.length>0&&(i="desc"==r?i.concat(a):a.concat(i)),store.$.defArrUtls(i),store.$.defUtls(i,this.model),i},mapBy:function(e){return this.map(function(r){return r.$.get(e)})},revertToOldVal:function(e,r,t,o){if(void 0!=t&&0!=t.length){Array.isArray(t)||(t=[t]);for(var a=0;a<t.length;a++){var i=o.forward.relatedTo,s=store.peekRecord(i,t[a]);this.establishLink(o.forward,o.backward,e,s,void 0)}}},removePartial:function(e,r){var t=e.$.partial;t&&t[r]&&delete t[r]},findCurrentInd:function(e,r){var t,o,a=!1;return e._deleted.forEach(function(e,i){a&&e.index<t&&o--,i==r&&(a=!0,o=t=e.index)}),o},modifyDelInd:function(e,r){var t,o=!1;e._deleted.forEach(function(e,a){o&&e.index>=t&&(e.index=e.index+1),a==r&&(o=!0,t=e.index)})},rollBackDelete:function(e,r,t,o){var a=[],i=e._name;if(r){var s=e._deleted.get(r),n=e._pK;a=[s]}else e._deleted.forEach(function(e){a.push(e)});for(var d=this,l=a.length-1;l>=0;l--){var c=(s=a[l]).data,p=e.data._recMap?e.data._recMap.get(c.$.pK):-1!==e.data.indexOf(c);if(Lyte.isRecord(c)){store.$.cmpSet(c.$,"isDeleted",!1),store.$.changePersist(c,!0);var y=store.$.isDuplicateRecord(e,c);if(p)store.$.addDeepNest(c,void 0,"added");else{t?d.handleArrOp(e.data,"insertAt",c,s.index):d.handleArrOp(e.data,"push",c),e.emit("add",[c]),store.emit("add",[e._name,c]);var f=e.relations;if(f)for(var v in f){(f[v]||[]).forEach(function(r){var t,o,a;r.relKey;o=store.modelFor(r.relatedTo),t=d.getBackwardRel(e,r,o),a=r.relKey&&r!=t?c[r.relKey]:store.$.getRelatedRecord(c,r.relatedTo,r.dummy?r.dummy:r.relKey),Array.isArray(a)?a.forEach(function(e,o){r==t?d.establishLink(t,r,e,c,void 0,!1):d.establishLink(r,t,c,e,void 0,!1)}):r==t?d.establishLink(t,r,a,c,void 0,!1):d.establishLink(r,t,c,a,void 0,!1)})}}var u=store.model.cachedQueries;if(u){var h=u[i];if(h&&h.length)for(var m=h.length-1;m>=0;m--){if((s=h[m])&&s.hasDeletedRecords)-1!=s.data[i].indexOf(c)&&delete s.hasDeletedRecords}}(c.$.isNew||c.$.isModified)&&this.checkAndAddToArray(e.dirty,c[e._pK]),store.$.clrRecErr(c.$,n,"ERR17"),y||e.data._recMap.set("object"==typeof c.$.pK?c.$.pK:c.$.pK.toString(),c),e._deleted.delete(c.$.pK)}}},rollBackNew:function(e,r,t,o){store.$.removeFromStore(e,r.$.pK,!0,o)},emit:function(e,r,t,o){r.$.emit(e,[r,t,o]),r.$.model.emit(e,[r,t,o]),store.emit(e,[r.$.model._name,r,t,o])},hasRecordsArrayChanged:function(e,r,t){var o=t||e.$.getInitialValues(r),a=!0;e.$.model._pK;if(o&&o.length==e[r].length){a=!1;for(var i=0;i<o.length;i++)if(-1==e[r].indexOf(o[i]))return!0}return a},setRecErr:function(e,r,t,o){store.$.cmpSet(e,"isError",!0);var a=t;if("object"==typeof a)store.$.cmpSet(e.error,r,a);else{if("string"==typeof t)a=Lyte.errorCodes[t]?{code:t,message:Lyte.errorCodes[t]}:t;store.$.cmpSet(e.error,r,a),o&&store.$.cmpSet(e.error[r],"value",o)}store.$.emit("error",e.record,r,a)},clrRecErr:function(e,r,t){var o=Lyte.objectUtils,a=e.error;if(t)e.error.code==t&&(void 0!==o?o(a,"delete",r):delete a[r]);else if(r)void 0!==o?o(a,"delete",r):delete a[r];else if(void 0!==o)for(var i in a)o(a,"delete",i);else e.error={};0==Object.keys(e.error).length&&store.$.cmpSet(e,"isError",!1)},cacheQuery:function(e,r,t,o){var a=store.model.cachedQueries;(a=(a=store.model.cachedQueries=a||{})[e]=a[e]||[]).push({cacheQuery:r,data:t,status:o})},cacheRecordQuery:function(e,r,t,o,a){var i=store.model.cachedRecordQueries;(i=(i=(i=store.model.cachedRecordQueries=i||{})[e]=i[e]||{})[r]=i[r]||[]).push({cacheQuery:t,data:o,status:a})},isModelDataArray:function(e){if(Array.isArray(e)&&(e.modelless||e.model&&e.model instanceof Model&&!e.polymorphic))return!0},handleArrOp:function(e,r,t,o,a){a=void 0!=a?a:0;var i,s,n=void 0!==Lyte.arrayUtils;if(e.key&&e.record){var d=e.record.$.model.fieldList[e.key],l=!1;d&&d.opts&&d.opts.sort&&(d.opts.sort.sortFn?(s=d.opts.sort.sortFn,d.opts.sort.observes&&(l=!0)):s={sortBy:d.opts.sort.sortBy,sortOrder:d.opts.sort.sortOrder})}switch(r){case"push":this.isModelDataArray(e)&&(void 0==e._recMap&&store.$.defProp(e,"_recMap",new Map),e.modelless?e._recMap.set(t[e.pK],t):e._recMap.set("object"==typeof t.$.pK?t.$.pK:t.$.pK.toString(),t)),i=s?n?Lyte.arrayUtils(e,"sort",s,[t]):e.push(t):n?Lyte.arrayUtils(e,r,t):e.push(t),l&&t&&t.$&&(t.$.hasOwnProperty("srtObs")||store.$.defProp(t.$,"srtObs",!0,!1,!0));break;case"removeAt":if(this.isModelDataArray(e))for(var c=a,p=0;p<c;p++){var y=void 0;if(e.modelless)y=e[o+p][e.pK];else{var f=e[o+p]?e[o+p].$.pK:void 0;y=f="object"==typeof f?f:f.toString()}void 0!==y&&e._recMap&&e._recMap.delete(y)}var v=e[o];l&&v&&v.$&&!store.$.changeRelPkMaps(v,void 0,void 0,"srtObsChk",e.key)&&v.$.hasOwnProperty("srtObs")&&(v.$.srtObs=!1),i=n?Lyte.arrayUtils(e,r,o,a):e.splice(o,a);break;case"insertAt":this.isModelDataArray(e)&&(void 0==e._recMap&&store.$.defProp(e,"_recMap",new Map),e.modelless?e._recMap.set(t[e.pK],t):e._recMap.set("object"==typeof t.$.pK?t.$.pK:t.$.pK.toString(),t)),i=s?n?Lyte.arrayUtils(e,"sort",s,[t]):e.splice(o,a,t):n?Lyte.arrayUtils(e,r,o,t):e.splice(o,a,t),l&&t&&t.$&&(t.$.hasOwnProperty("srtObs")||store.$.defProp(t.$,"srtObs",!0,!1,!0));break;case"replaceAt":i=s?n?Lyte.arrayUtils(e,"sort",s,[t]):e.splice(o,a,t):n?Lyte.arrayUtils(e,r,o,t):e.splice(o,a,t),l&&t&&t.$&&(t.$.hasOwnProperty("srtObs")||store.$.defProp(t.$,"srtObs",!0,!1,!0));break;case"sort":i=Lyte.arrayUtils(e,"sort",s);break;default:Lyte.error("LD07",r)}return i},defpayObjUtls:function(e){Object.defineProperties(e,{set:{value:store.$.payloadSet},remove:{value:store.$.payloadRemove}})},defPayArrUtls:function(e){Object.defineProperties(e,{add:{value:store.$.payloadAdd},remove:{value:store.$.payloadRemove}})},defArrUtls:function(e){Object.defineProperties(e,{filterBy:{value:store.$.filterBy},sortBy:{value:store.$.sortBy},mapBy:{value:store.$.mapBy}})},defPolyUtls:function(e){Object.defineProperties(e,{add:{value:store.$.add},remove:{value:store.$.remove}})},defUtls:function(e,r,t,o){r&&store.$.defProp(e,"model",r),t&&store.$.defProp(e,"record",t,!1,!0),o&&store.$.defProp(e,"key",o)},defPar:function(e){store.$.defProp(e,"partial",new Map)},cmpSet:function(e,r,t,o,a){void 0!==Lyte.Component?Lyte.Component.set(e,r,t,o,a):e[r]=t},defProp:function(e,r,t,o,a){o=!!o,a=!!a,Object.defineProperty(e,r,{value:t,enumerable:o,writable:a})},removeChildRecords:function(e,r,t,o){if(!t.get(r)&&e){t.set(r,!0);var a=r?r.$.pK:void 0,i=[],s=e._fldGrps.inherit;for(var n in s){var d=s[n].relKey?s[n].relKey:void 0;if(r&&d)if("belongsTo"==e.fieldList[d].relType&&r[e.fieldList[d].relKey])this.removeChildRecords(store.modelFor(e.fieldList[d].relatedTo),r[e.fieldList[d].relKey],t);else if("hasMany"==e.fieldList[d].relType&&r[e.fieldList[d].relKey])for(var l=r[e.fieldList[d].relKey].length-1;l>=0;l--)this.removeChildRecords(store.modelFor(e.fieldList[d].relatedTo),r[e.fieldList[d].relKey][l],t)}i.push(a),this.removeFromStore(e,i,!0,!0,void 0,void 0,o)}},rBinherit:function(e,r){var t=e.record,o=e.model._fldGrps.inherit;for(var a in o){if(o[a].opts&&o[a].opts.inherit&&t[o[a].relKey])if("belongsTo"===o[a].relType)(n=t[o[a].relKey])&&!r.get(n)&&(r.set(n,!0),this.rollBackRecord(n.$,{inherit:!0}),store.$.rBinherit(n.$,r));else if("hasMany"===o[a].relType){var i=t[o[a].relKey].length;if(0!=i)for(var s=i-1;s>=0;s--){var n;(n=t[o[a].relKey][s])&&!r.get(n)&&(r.set(n,!0),this.rollBackRecord(n.$,{inherit:!0}),store.$.rBinherit(n.$,r))}}}},rollBackRecord:function(e,r){var t=e.model,o=t._pK;e.isModified&&(e.rollBackAttributes(e.getDirtyAttributes(),r),delete e._savedState),e.isDeleted?store.$.rollBackDelete(t,e.get(o),void 0,r):e.isNew?store.$.rollBackNew(t,e.record,o,r):e.isError&&store.$.clrRecErr(e),store.$.removeOnSave(e.model._name,e.record.$.pK)},buildVariables:function(e,r,t,o){for(var a in e=e||{},r){if(-1!=r[a].search(/!/g)&&!e[a]&&!t)return{LdEr:"LD30",LyteError:"ERR30",key:a};-1!=r[a].search(/!/g)&&(r[a]=r[a].replace(/!/g,"")),t&&-1==r[a].search(/\./g)&&("ID"!=r[a]&&"ID!"!=r[a]||(e[a]=t));var i={LdEr:"LD31",LyteError:"ERR30",key:a};if(e&&e[a])switch(r[a]){case"Int":if("number"!=typeof e[a])return i;break;case"String":if("string"!=typeof e[a])return i;break;case"Float":if("number"!=typeof e[a])return i;break;case"Boolean":if("boolean"!=typeof e[a])return i;break;case"Object":if("object"!=typeof e[a])return i}}for(var s in e)"string"!=typeof e[s]&&"object"!=typeof e[s]||(e[s]=store.$.LyteStringfy(e[s],""));return e},buildQuery:function(e,r,t,o,a,i,s,n,d,l){var c="",p=!1;for(var y in t)if("object"==typeof t[y]){if(c+=Object.keys(t)[0]+" ",s){for(var f in c+="( ",s)if(-1==f.search(/[.]/g)&&""==a)c+=f+":"+s[f]+" ";else if(""!=a&&-1!=f.search(/[.]/g)&&a==f.match(/.*(?=\..*$)/g)[0]){var v=f.split(".");c+=v[v.length-1]+":"+s[f]+" "}c=(c+=") ").replace(/\([ ]*\)/g,"")}c+="{ ";for(var u=0;u<t[y].length;u++){var h=t[y][u];p=!1,d&&(p=!("string"!=typeof h||!d.includes(h)||""!=a)||!("object"!=typeof h||!d.includes(Object.keys(h)[0])||""!=a)),p||("string"==typeof h?c=c+h+" ":(a=(a?a+".":"")+Object.keys(h)[0],c+=store.$.buildQuery(e,r,h,o,a,i,s,n,d,l),a=y==i?"":y))}c+=" } "}return c},QueryCallback:function(e,r,t,o,a,i,s,n,d){var l;if("object"==typeof o){for(var c=Object.keys(o)[0],p=0;p<o[c].length;p++){var y=o[c][p];"object"==typeof y&&store.modelFor(e).fieldList[Object.keys(y)[0]]&&store.modelFor(e).fieldList[Object.keys(y)[0]].relatedTo&&(l=store.modelFor(e).fieldList[Object.keys(y)[0]].relatedTo,store.$.QueryCallback(l,r,t,y,a,i,s,n,d))}var f=store.$.initCB("serializer",e,"serializeSelfQuery",{args:[e,r,d,o,a,i]});if(f){var v=f.data[Object.keys(o)[0]];o[Object.keys(o)[0]]=v}}},buildFields:function(e,r,t,o,a,i){var s=store.modelFor(e),n=s.fieldList,d=s.gql&&s.gql.localAttrs?s.gql.localAttrs:[];i?n=i:a.set(e,!0);var l={},c=[];for(var p in n)if(!d.includes(p)){if("relation"==n[p].type){if(store.modelFor(n[p].relatedTo)&&n[p].relatedTo!=o&&n[p].relatedTo!=e){var y=store.$.getBackwardRel(store.modelFor(e),n[p],store.modelFor(n[p].relatedTo));if(y&&y.relatedTo==r&&void 0==y.dummy)continue;a.has(n[p].relatedTo)||c.push(store.$.buildFields(n[p].relatedTo,n[p].relatedTo,p,o,a))}continue}"object"==n[p].type&&n[p].properties?c.push(store.$.buildFields(e,r,p,o,a,n[p].properties)):c.push(p)}return l[t]=c,a.delete(e),l},parseQuery:function(e,r,t,o,a,i,s,n,d,l,c){var p,y,f,v={},u={};if("object"==typeof i){var h,m;"variables"!=(m=Object.keys(i.query))[0]?m[0]:m[1];y=Object.assign({},i.query.variables),u["variables"!=m[0]?m[0]:m[1]]=Object.assign(i.query["variables"!=m[0]?m[0]:m[1]]),"object"==typeof u&&(h=u)}if("string"==typeof i&&-1!=i.search(/[ ]/g)){var $=i,g={};$=($=($=($=($=($=($=($=($=($=($=($=($=($=($=$.replace(new RegExp("\n","g")," ")).replace(/ *[ ]*\(/g,":{variables:[")).replace(/ *\) *{/g,"],attrs:[")).replace(/\w+/g,'"$&"')).replace(/"!/g,'!"')).replace(/" +"/g,'", "')).replace(/\S+{"variables"/g,"{$&")).replace(/} *"/g,'}, "')).replace(/" *{/g,'" :{"attrs" :[')).replace(/\} *\}/g,"]}}")).replace(/" *}/g,'"]} }')).replace(/]}}/g,"]}}]}}")).replace(/]}}]}} *}/g,"]}}]}}]}}")).replace(/} *{/g,"},{")).replace(/\S+ *:{"attrs"/g,"{$&"),$=JSON.parse($),h=store.$.buildQueryFields($,g,"",Object.keys($)[0]),y=g}if("object"==typeof h){store.$.QueryCallback(e,t,e,h,s,h,y,o,n),a.query=h,s&&(a.variables=s);var b=Object.keys(y)[0];"Mutation"!=a.type||1!=Object.keys(y).length||"Object"!=y[b]&&"Object!"!=y[b]?a.variables:a.variables[b]=l;var _=store.$.initCB("serializer",e,"serializeGqlQuery",{args:[e,t,r,a,n,l,c]});if(_&&(h=_.data.query,_.data.variables&&(s=_.data.variables)),(f=store.$.buildVariables(s,y,r,n.type))&&f.LdEr)return f;n.gqlObj=a,p="{ "+(p=store.$.buildQuery(e,t,h,y,"",Object.keys(h)[0],0!=Object.keys(f).length?f:void 0,r,d,e))+" }"}return"Query"==a.type?v.query=p:v.query="mutation "+p,v},graphQlconfig:function(e,r,t,o,a,i,s,n,d){var l,c,p={},y=store.modelFor(e),f={},v=new Map,u=y.gql&&y.gql.localAttrs?y.gql.localAttrs:[];if("findAll"==t||"findRecord"==t){if(f.type="Query",void 0===(c=y.gql&&y.gql.query&&y.gql.query[a]?y.gql.query[a]:a)){var h=store.$.buildFields(e,null,e,e,v);(l={}).query=h,f.queryType="default"}else if("string"==typeof a&&-1!=a.search(/[ ]/g))l=a,f.queryType="query";else if("object"==typeof a)l=a;else if("object"==typeof c)l=c;else{if("string"!=typeof c||-1==c.search(/[ ]/g))return{LdEr:"LD32",LyteError:"ERR31",key:a};l=c,f.queryType="namedQuery",f.queryName=a}i=i?Object.assign({},i):void 0}else if(f.type="Mutation",c=y.gql&&y.gql.mutation&&y.gql.mutation[a]?y.gql.mutation[a]:a,"string"==typeof a&&-1!=a.search(/[ ]/g))l=a,f.mutationType="customMutation";else{if("string"!=typeof c||-1==c.search(/[ ]/g))return{LdEr:"LD32",LyteError:"ERR31",key:a};l=c,f.mutationType="namedMutation",f.MutationName=a}var m=store.$.parseQuery(e,r,t,o,f,l,i,s,u,n,d);return m.LdEr?m:(p.data=JSON.stringify(m),p.data)},setQuery:function(e,r,t,o){var a=e;a.gql?(a.gql[t]=a.gql[t]?a.gql[t]:{},a.gql[t][r]=a.gql[t][r]?a.gql[t][r]:{}):(a.gql={},a.gql[t]={},a.gql[t][r]={}),a.gql[t][r]=o},buildQueryFields:function(e,r,t,o){var a=Object.keys(e)[0],i=[],s={};if(e[a].variables)for(var n=0;n<e[a].variables.length;n+=2)r[(t?t+".":"")+e[a].variables[n]]=e[a].variables[n+1];for(var d=0;d<e[a].attrs.length;d++)"object"==typeof e[a].attrs[d]?(t=(t?t+".":"")+Object.keys(e[a].attrs[d])[0],i.push(this.buildQueryFields(e[a].attrs[d],r,t,o)),t=a!=o?a:""):i.push(e[a].attrs[d]);return s[a]=i,s},LyteStringfy:function(e,r,t){if("string"==typeof e)return'"'+e+'" ';if(Array.isArray(e)){r+="[";var o=0,a=e.length;e.forEach(function(t){o++,"string"==typeof t?r=r+'"'+t+'" ':"object"==typeof t?r=store.$.LyteStringfy(t,r):"number"==typeof t&&(r+=e.toString()),r=o!=a?r+",":r}),r+="]"}else{if(!e||Array.isArray(e)||"object"!=typeof e)return e.toString();r+="{";var i=0;for(var o in e)i++,"string"==typeof e[o]?r=r+o+' : "'+e[o]+'" ':"object"==typeof e[o]?(r=r+o+" : ",r=store.$.LyteStringfy(e[o],r)):r=r+o+" : "+e[o].toString(),Object.keys(e).length!=i&&(r+=", ");r+="}"}return r},cpdGql:function(e,r,t,o,a,i){o.gql&&("object"==typeof o.gql?mutName=o.gql.mutation:1==o.gql&&(mutName=void 0),o.data=store.$.graphQlconfig(e,void 0,r,t,mutName,[],o,a,i))},payloadAdd:function(e,r){Array.isArray(e)||(e=[e]);for(var t=this._model,o=this._partialObj,a=this._payloadObj,i={opts:{serialize:this._serialize}},s={},n={},d=0;d<e.length;d++){if(o._removedRecords&&o._removedRecords.hasOwnProperty(e[d]))s=o._removedRecords[e[d]]._payload,n=o._removedRecords[e[d]]._partial,delete o._removedRecords[e[d]];else{var l=store.peekRecord(t,e[d]),c=store.$.PayloadSerialize(i,s,l,void 0,store.modelFor(t),n);s=c.payload,n=c.partial}this.partRecMap.get(e[d])||(void 0!=r&&"number"==typeof r?(Lyte.arrayUtils(o,"insertAt",r,n),Lyte.arrayUtils(a,"insertAt",r,_pK),r=r++):(Lyte.arrayUtils(o,"push",n),Lyte.arrayUtils(a,"push",s)),this.partRecMap.set(e[d],!0))}},payloadRemove:function(e){this._model;var r=this._partialObj,t=this._payloadObj;Array.isArray(e)||(e=[e]);for(var o=0;o<e.length;o++)if(Array.isArray(t)){var a=t.length;if(this._serialize&&"id"==this._serialize){if(t.includes(e[o])){var i=t.indexOf(e[o]);t.splice(i,1)}}else for(var s=0;s<a;s++)r[s]&&r[s].$.pkVal==e[o]&&(r.hasOwnProperty("_removedRecords")?r._removedRecords[r[s].$.pkVal]={_partial:r[s],_payload:t[s]}:Object.defineProperties(r,{_removedRecords:{value:{[r[s].$.pkVal]:{_partial:r[s],_payload:t[s]}}}}),Lyte.arrayUtils(r,"removeAt",s,1),Lyte.arrayUtils(t,"removeAt",s,1),this.partRecMap.delete(e[o]))}else t[e[o]]&&(r.hasOwnProperty("_removedAttr")&&!r._removedAttr.hasOwnProperty(e[o])?r._removedAttr[e[o]]={_partial:r[e[o]],_payload:t[e[o]]}:r.hasOwnProperty("_removedAttr")||Object.defineProperties(r,{_removedAttr:{value:{_partial:r[e[o]],_payload:t[e[o]]}}}),r[e[o]]&&(r._removedAttr[e[o]]._partial=r[e[o]],Lyte.objectUtils(r,"delete",e[o])),Lyte.objectUtils(t,"delete",e[o]))},payloadSet:function(e){Array.isArray(e)||(e=[e]);for(var r=this._model,t=this._pkVal,o=store.modelFor(r),a=this._payloadObj,s=store.peekRecord(r,t),n=this._partialObj,d=0;d<e.length;d++){var l=e[d];if(!this._payloadObj[l]){if(n.hasOwnProperty("_removedAttr")&&n._removedAttr.hasOwnProperty(l)&&1!=n._removedAttr[l])return a[l]=n._removedAttr[l]._payload,n._removedAttr[l]._partial&&(n[l]=n._removedAttr[l]._partial),void Lyte.objectUtils(n._removedAttr,"delete",l);var c=o.fieldList[l];if(s[l]&&"relation"==c.type)if("hasMany"==c.relType){if(n[l]=[],a[l]=[],c.opts&&"id"==c.opts.serialize&&store.$.payLoadIdSerialize(a,l,s,o,c,n),store.$.defProp(a[l],"$",{}),store.$.defPayArrUtls(a[l].$),Object.defineProperties(a[l].$,{_key:{value:c.relKey},_partialObj:{value:n[l]},_model:{value:c.relatedTo},_payloadObj:{value:a[l]},replace:{value:store.$.replaceCheck,writable:!0},partRecMap:{value:new Map}}),c.opts&&c.opts.serialize&&!a[l].$.serialize&&Object.defineProperty(a[l].$,"_serialize",{value:c.opts.serialize}),c.opts&&"id"!=c.opts.serialize||!c.opts){if("record"==c.opts.serialize)for(i=0;i<s[l].length;i++)a[l].$.add(s[l][i].$.pK);if("partial"==c.opts.serialize)s[l].partial.forEach(function(e,r){a[l].$.add(r)})}}else{n[l]={},a[l]={};var p=store.$.PayloadSerialize(c,a[l],s[l],l,store.modelFor(c.relatedTo),n[l]);a[l]=p.payload,n[l]=p.partial}else a[l]=s[l],n[l]=s[l]}}},payLoadIdSerialize:function(e,r,t,o,a,i){var s={};e[r]=Lyte.deepCopyObject(t[r]),store.$.getRelations(o,r,store.modelFor(a.relatedTo),s),store.$.idSerialize(e,s,void 0,i)},PayloadSerialize:function(e,r,t,o,a,i){var s,n="object"==typeof t.$.pK?t.$.pK:{[t.$.model._pK]:t.$.pK},d=a,l=!1;if(e.opts&&e.opts.serialize){if(s=store.adapter.$.initPartialObj(a._name),"record"==e.opts.serialize&&(n=store.$.toJSON(a._name,t,void 0,void 0,s)),"partial"==e.opts.serialize){var c=store.$.isDirty(t,d.relations),p=t;p.$.isModified||c&&c.length?(y=store.$.updateJSON(p,d,c),n=store.$.toJSON(a._name,y,void 0,void 0,s),l=!0):s.obj.set(t.$.pK,i)}i=s.obj.get(t.$.pK)||i;var y,f={pkVal:{value:t.$.pK},type:{value:"related"},model:{value:d._name},record:{value:t[o]||t}};if(1==l&&(f.type.value="modified"),n&&(r=store.adapter.$.serializeRecords(a._name,n,t,void 0,"serializeRecord",void 0,s.obj)),e.opts&&"id"==e.opts.serialize&&(n=t.$.pK),"object"==typeof r){i&&!i.$&&store.$.defProp(i,"$",{});var v=i.$;Object.defineProperties(v,f),e.opts&&e.opts.serialize&&r.$&&!r.$._serialize&&"belongsTo"==e.relType&&Object.defineProperty(r.$,"_serialize",{value:e.opts.serialize})}return y={payload:r,partial:i}}},replaceCheck:function(e){store.$.defProp(this._partialObj,"replace",e)},savingDonorRecord:function(e){var r=e.donor,t=e.getDirtyAttributes();if(store.$.isDirty(e.record,e.model.relations).length||t.length){var o=e.toJSON("state");store.$.setData(r.$,o,void 0,void 0,void 0,void 0,!0),e.persist()}return r.$}}};function Adapter(e,r,t){Object.defineProperty(this,"$lg",{value:Lyte.__gl}),store.$.newCB("adapter",this,t,e,r)}function Serializer(e,r,t){Object.defineProperty(this,"$lg",{value:Lyte.__gl}),store.$.newCB("serializer",this,t,e,r)}store.$.cbDef(Adapter,"adapter"),store.adapter={$:{buildURL:function(e,r,t,o,a,i,s,n,d,l){var c=store.$.getAdapter({name:t}),p=store.$.getFromCB("adapter",t,"host"),y=(d=d||"",store.$.makeBatch),f={method:r};if(!(d=d||""))if(y||void 0!==p&&(d+=p,"/"!=p[p.length-1]&&(d+="/")),l){f.method="POST",f.gql=l,r=f.method;var v=store.$.getFromCB("adapter",t,"gqlNamespace");d+=v||""}else{var u=store.$.getFromCB("adapter",t,"namespace");if(""!==u&&"/"!=u[u.length-1]?d+=u+"/":d+=u,"batch"!=e&&(d+=t,o&&"object"!=typeof o&&(d+="/"+o)),"action"==e){d+="/"+store.$.getFromCB("adapter",t,"actionNamespace");var h=store.modelFor(t).actions;d+="/"+(h[s].endPoint?h[s].endPoint:s)}else"batch"==e&&(d+=store.$.getFromCB("adapter","application","batchNamespace"));f.method=r||""}if(i||(i={}),(g=store.$.initCB("adapter",t,"headersForRequest",{args:[e,i,n,s,o]}))&&(f.headers=g.data),(g=store.$.initCB("adapter",t,"buildURL",{args:[t,e,i,a,d,s,n,o]}))&&(d=g.data),(g=store.$.initCB("adapter",t,"methodForRequest",{args:[r,e,i,n,s,o]}))&&(f.method=g.data),!y&&i&&Object.keys(i).length){d+="?";var m=0;for(var $ in i){var g;0!==m&&(d+="&"),(g=i[$])&&"object"==typeof g&&(g=JSON.stringify(g)),d+=$+"="+encodeURIComponent(g),m++}}return c&&1==c.withCredentials&&(f.withCredentials=!0),f.url=d,f.qP=i,f},get:function(e,r,t,o,a,i,s,n,d){var l,c=store.modelFor(r),p=store.$.makeBatch,y=d||n?{}:void 0,f=store.$.getFromCB("adapter",r,"modelless");if(f&&"string"==typeof r){var v=store.modelless,u=r;def=v[u]=v[u]||{},def._name=u}if(c||r&&f){i=void 0==i?store.$.getFromCB("adapter",r,"customData"):i,n&&(y.query=n),d&&(y.variables=d),l=store.$.initCB("adapter",r,"gql",{args:[r,e,o,t,y,i]});var h=this.buildURL(e,"GET",r,t,void 0,o,void 0,i,void 0,l?l.data:void 0),m=this;if(o=h.qP,toCheckParams=a&&"boolean"!=typeof a?a:o&&"object"==typeof o?o:void 0,h.gql&&("object"==typeof h.gql?(n=h.gql.query,d=h.gql.variables):!0===h.gql&&(n=d=void 0),h.data=store.$.graphQlconfig(r,t,e,o,n,d,h),h.data.LdEr))return Lyte.warn(h.data.LdEr,h.data.key,r),Promise.reject({code:h.data.LyteError,message:Lyte.errorCodes[h.data.LyteError],data:h.data.key});if("findAll"==e&&toCheckParams&&store.model.cachedQueries&&store.model.cachedQueries[r]){for(var $=store.model.cachedQueries[r],g=0;g<$.length;g++){var b=$[g];if(!b.hasDeletedRecords){var _=b.cacheQuery;if(this.compareData(_,toCheckParams,!0)){L=[b.data,"cache",void 0,b.status];break}}}if(L)return new Promise(function(e){p&&store.$.addToCachedBatch(Array.isArray(L)?L[0][r]:L),e(L)})}else if("findRecord"==e&&toCheckParams&&store.model.cachedRecordQueries&&store.model.cachedRecordQueries[r]&&store.model.cachedRecordQueries[r][t]){var L;for($=store.model.cachedRecordQueries[r][t],g=0;g<$.length;g++){_=$[g].cacheQuery;if(this.compareData(_,toCheckParams,!0)){L=[$[g].data,"cache",void 0,$[g].status];break}}if(L)return new Promise(function(e){p&&store.$.addToCachedBatch(Array.isArray(L)?L[0][r]:L),e(L)})}else{var R=store.$.cbScp(r,"findRecord"==e?"reloadRecord":"reloadAll","adapter");if(R){var O,k=!1;if("findRecord"==e?(O=store.peekRecord(r,t),k=!!Lyte.isRecord(O)):"findAll"==e&&(k=!(!(O=store.peekAll(r))||!O.length)),k&&!store.$.cB(R,[O,o,i,r])){var w={};return w[r]=O,new Promise(function(e){p&&store.$.addToCachedBatch(w[r]),e([w,"cache"],"success",void 0,!0)})}}}if("POST"==h.method){var A=store.$.initCB("serializer",r,"serialize",{args:[e,h?h.data:void 0,void 0,i,r,o,void 0,h?h.gqlObj:void 0]});A&&(h.data=A.data,!h.data||"object"!=typeof h.data&&!Lyte.isRecord(h.data)&&!Array.isArray(h.data)||h.data instanceof FormData||(h.data=JSON.stringify(h.data)))}return new Promise(function(n,d){var l,c=store.modelFor(r),y=store.$.getIDBObj(c,o,e,t,i),f=store.$.getFromCB("adapter",r,"processRequest"),v=!0,u=!1,$=[r,e,t,h,n,d,"get",void 0,i],g={cacheQuery:a,cacheData:s,customD:i};if(f){v=!1;var b=m.callGeneric(e,r,void 0,void 0,i,o,t,h.url,void 0,h.method,h.headers);b instanceof Promise?(u=!0,b.then(function(o){o=""==o?JSON.parse("{}"):JSON.parse(o),l=m.getResponse(o,r,e,t,h,void 0,i,g),n([l])},function(e){d(e)})):v=!0}p&&!u?store.adapter.$.constructBatch.apply(store.adapter.$,$).then(function(o){var a=o.content;store.adapter.$.getSuccess(r,e,t,h,void 0,n,d,a,o,void 0,g)},function(o){store.adapter.$.getFailure(r,e,t,h,void 0,n,d,g,o.content,o.code,o)}):y?store.adapter.$.getFromIDB(y,r,e,o,t,h,i).then(function(a){var i=store.$.initCB("serializer",r,"idbResponse",{args:[r,e,o,t,a]});i&&(a=i.data),0==a?store.adapter.$.sendXHR.apply(store.adapter.$,$).then(function(o){store.adapter.$.getSuccess(r,e,t,h,o,n,d,void 0,void 0,void 0,g)},function(o){store.adapter.$.getFailure(r,e,t,h,o,n,d,g)}):store.adapter.$.getSuccess(r,e,t,h,void 0,n,d,a,void 0,"idb",g)},function(o){store.adapter.$.sendXHR.apply(store.adapter.$,$).then(function(o){store.adapter.$.getSuccess(r,e,t,h,o,n,d,void 0,void 0,void 0,g)},function(o){store.adapter.$.getFailure(r,e,t,h,o,n,d,g)})}):v&&store.adapter.$.sendXHR.apply(store.adapter.$,$).then(function(o){store.adapter.$.getSuccess(r,e,t,h,o,n,d,void 0,void 0,void 0,g)},function(o){store.adapter.$.getFailure(r,e,t,h,o,n,d,g)})})}return Lyte.warn("LD02","Model",r),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:r})},constructBatch:function(e,r,t,o){return new Promise(function(e,r){var t=store.$.currentBatch,a=store.$.batch[t]=store.$.batch[t]||[],i=store.$.batchPromise[t]=store.$.batchPromise[t]||[],s={};s.method=o.method,s.uri="/"+o.url,s.parameters=o.qP,s.content="string"==typeof o.data?JSON.parse(o.data):void 0,a.push(s),i.push({resolve:e,reject:r})})},getFromIDB:function(e,r,t,o,a,i,s){return new Promise(function(i,n){var d=e.queryCache?"getCachedData":"findAll"==t?"getAll":"get",l={resolve:i,reject:n,type:d,model:r,req:t,key:a};"getCachedData"==d&&(l.queryParams=o),l.queryCache=e.queryCache,l.customData=s,LyteIDB.postMessage(l)})},sendXHR:function(e,r,t,o,a,i,s,n,d){var l=new XMLHttpRequest,c=new Promise(function(a,i){for(var s in l.open(o.method,o.url,!0),o.headers)l.setRequestHeader(s,o.headers[s]);l.withCredentials=!!o.withCredentials,store.$.initCB("adapter",e,"parseRequest",{args:[r,e,l,o?o.qP:void 0,t,d]}),store.emit("beforeRequest",[l,e,r,t,o.qP]),l.send(o.data),l.onreadystatechange=function(){if(4==l.readyState)return store.emit("afterRequest",[l,e,r,t,o.qP]),"2"==l.status.toString()[0]||"3"==l.status.toString()[0]?a(l):i(l)}});return c.xhr=l,c},getSuccess:function(e,r,t,o,a,i,s,n,d,l,c){var p,y,f=n,v=a,u=c.customD;a&&a.status;if("idb"!=l){if(v&&(f=(f=v.responseText)&&0!=f.length?JSON.parse(f):JSON.parse("{}")),d&&(p=d.index,y=d.batch,v=d.resp),v){var h=store.$.initCB("adapter",e,"parseResponse",{args:[r,e,v,f,o?o.qP:void 0,t,u,c]});if(h&&(f=h.data),f instanceof Promise)return this.handleParseResponsePromise(f,e,r,t,o,a,void 0,p,y,i,s,c)}return this.findParseRequestPromise(f,e,r,t,o,a,p,y,i,c)}i(a?[f,a.statusText,a]:void 0!=p?[f,"batch",{index:p,batch:y}]:l?[f,"idb"]:[f])},getFailure:function(e,r,t,o,a,i,s,n,d,l,c){var p=n.customD;if(a){var y,f=a.responseText;if(f)try{f=""==f?JSON.parse("{}"):JSON.parse(f)}catch(e){Lyte.warn("LD24",e)}y=f;var v=store.$.initCB("adapter",e,"parseResponse",{args:[r,e,a,f,o?o.qP:void 0,t,p,n]});if(v&&(y=v.data),y instanceof Promise)return this.handleParseResponsePromise(y,e,r,t,o,a,void 0,void 0,void 0,i,s,n)}else if(d){var u,h;c&&(h=c.index,u=c.batch),store.$.batchResponse[u][h]={code:l,status:"requestFailure",data:d},s({code:l,status:"requestFailure",data:d})}s(a)},getResponse:function(e,r,t,o,a,i,s,n){if(!0===(void 0===n.cacheData||null===n.cacheData||"object"!=typeof n.cacheData||!n.cacheData.hasOwnProperty("normalize")||n.cacheData.normalize)){var d,l,c,p,y=e=store.serializer.$.normalizeResponse(r,t,e,o,i?i.status:i,a,s,n),f=a?a.qP:void 0;"object"!=typeof y&&(y=JSON.parse(y)),(c=store.$.initCB("serializer",r,"extractMeta",{args:[y,r,t,f,s,n]}))&&(p=c.data,store.$.isEmpty(p)||(y.meta=p));var v=Object.keys(y),u=v.length;if(u){var h;if((c=store.$.initCB("serializer",r,"payloadKey",{args:[r,t,o,f,s,n]}))&&(h=c.data)&&h!=r){var m=y[h];y[r]=m,delete y[h]}if(d=store.$.cbScp(r,"deserializeKey","serializer")){Lyte.warn("LD08","deserializeKey","callback","Please use payloadKey callback instead"),u>2&&Lyte.error("LD09");var $=0;2==u&&"meta"==v[0]&&($=1),l=[r,t];var g=store.$.cB(d,l),b=y[v[$]];delete y[v[$]],y[g]=b}store.serializer.$.normalize(r,t,y,o,i?i.status:i,a.headers,s,n,a)}return y}return"object"!=typeof e&&(e=JSON.parse(e)),(c=store.$.initCB("serializer",r,"extractMeta",{args:[e,r,t,f,s,n]}))&&(p=c.data,store.$.isEmpty(p)||(e.meta=p)),e},initPartialObj:function(e,r,t,o,a,i){return{obj:new Map}},create:function(e,r,t,o,a,i){var s=t?"createRecord":"create",n=i?{mutation:i}:void 0,d=store.$.initCB("adapter",e,"gql",{args:[e,s,a,void 0,n,o]});o=void 0==o?store.$.getFromCB("adapter",e,"customData"):o;var l=this.buildURL(s,"POST",e,void 0,r,a,void 0,o,void 0,d?d.data:void 0);a=l.qP;var c=this.initPartialObj(e,s,a,void 0,l.url,o),p=store.$.toJSON(e,r,void 0,"create",c);return this.sendingData(e,p,l,s,o,r,c.obj),l.gql&&store.$.cpdGql(e,s,a,l,p,o),this.handleRequest(l,e,r,s,p,o,c.obj,void 0,void 0,c.ref)},put:function(e,r,t,o,a,i,s){var n=store.model[e],d=n.bK,l=n.isComp,c=s?{mutation:s}:void 0,p=o?"updateRecord":"update",y=(new Map,o?l&&d?t[d]:t.$.pK:void 0),f=store.$.initCB("adapter",e,"gql",{args:[e,p,i,void 0,c,a]});a=void 0==a?store.$.getFromCB("adapter",e,"customData"):a;var v=this.buildURL(p,"PATCH",e,y,r,i,void 0,a,void 0,f?f.data:void 0);i=v.qP;var u=this.initPartialObj(e,p,i,y,v.url,a),h=store.$.toJSON(e,r,void 0,void 0,u);return this.sendingData(e,h,v,p,a,t,u.obj),v.gql&&store.$.cpdGql(e,p,i,v,h,a),this.handleRequest(v,e,t,p,h,a,u.obj,void 0,void 0,u.ref)},del:function(e,r,t,o,a,i,s){var n=store.model[e],d=n.bK,l=n.isComp,c=s?{mutation:s}:void 0,p=o||"deleteRecord",y=t?l&&d?r[d]:r.$.pK:void 0;a=void 0==a?store.$.getFromCB("adapter",e,"customData"):a;var f=store.$.initCB("adapter",e,"gql",{args:[e,p,i,void 0,c,a]}),v=this.buildURL(p,"DELETE",e,y,r,i,void 0,a,void 0,f?f.data:void 0);i=v.qP;this.initPartialObj(e,p,i,y,v.url,a);var u=[];t||(u=r.map(function(e){return e.$.pK}));var h=t?r?r.$.pK:void 0:u;return this.sendingData(e,h,v,p,a,r),v.gql&&store.$.cpdGql(e,p,i,v,h,a),this.handleRequest(v,e,r,p,h,a,void 0,y)},sendingData:function(e,r,t,o,a,i,s){var n,d=e,l={},c=t?t.qP:void 0,p={};for(var y in t)p[y]=t[y];p.type=o,p.model=e,(n=store.$.initCB("serializer",e,"serializeKey",{args:[e,o,a,c]}))&&(d=n.data),r=this.serializeRecords(e,r,i,p,"serializeRecord",a,s),d?(Array.isArray(r)||"object"==typeof r||Lyte.isRecord(r))&&(l[d]=r):l=r,(n=store.$.initCB("serializer",e,"serialize",{args:[o,l,i,a,e,c,t?t.gqlObj:void 0]}))&&(l=n.data),t.data=l},serializeRecords:function(e,r,t,o,a,i,s){store.$.getFromCB("adapter",e,"modelless");var n=store.modelFor(e);if(!n)return r;var d,l=n.relations;if(t||"normalizeRecord"==a||(t=store.peekRecord(n._name,r.$.pK)),Array.isArray(r)){d=[];for(var c=0;c<r.length;c++){var p=r[c];p&&"object"==typeof p?d.push(this.serializeSingleRecord(n._name,p,t?t[c]:void 0,o,l,a,i,s)):d.push(p)}}else r&&(d=r,"object"==typeof r&&(d=this.serializeSingleRecord(n._name,r,t,o,l,a,i,s)));return d},serializeSingleRecord:function(e,r,t,o,a,i,s,n){var d;if("serializeRecord"==i&&"object"==typeof r&&void 0==r.$&&store.$.defProp(r,"$",{}),"normalizeRecord"==i&&Lyte.isRecord(r))return r;if("object"==typeof n&&t&&t.$&&t.$.pK){var l;if(d=n.get?n.get(t.$.pK):n,r.$&&r.$._partialObj)l=Object.assign({},r.$),r=Object.assign({},r),store.$.defProp(r,"$",l);var c=store.$.isDirty(t,t.$.model.relations);if(t.$.isModified||Array.isArray(c)&&0!=c.length){var p=t.$.getDirtyAttributes();Array.isArray(c)&&p.concat(c);var y=Object.keys(r);d.hasOwnProperty("_removedAttr")||Object.defineProperties(d,{_removedAttr:{value:{}}}),p.forEach(function(e){y.includes(e)||t.$.model._arrPk.includes(e)||(d._removedAttr[e]=!0)})}Object.defineProperties(r.$,{_partialObj:{value:d},_pkVal:{value:t.$.pK},_model:{value:e},_payloadObj:{value:r}})}"serializeRecord"==i&&store.$.defpayObjUtls(r.$);var f,v=store.$.cbScp(e,i,"serializer");v&&(f="serializeRecord"==i?[o,r,t,e,s]:[o,r,e,s],r=store.$.cB(v,f));for(var u in a)for(var h=a[u],m=h.length,$=0;$<m;$++){var g,b,_,L,R=h[$],O=r[R.relKey];if("relation"==R.type&&O&&("normalizeRecord"==i||"serializeRecord"==i&&R.opts&&R.opts.serialize&&"id"!=R.opts.serialize))if(g=t?t[R.relKey]:void 0,b=R.relatedTo,_=R.opts?R.opts.serialize:void 0,L=R.opts?R.opts.polymorphic:void 0,"hasMany"===R.relType){Array.isArray(O)||(O=[O]);var k=O.length,w=[];"serializeRecord"==i&&(store.$.defProp(w,"$",{}),store.$.defPayArrUtls(w.$),d&&d[R.relKey]&&(Object.defineProperties(w.$,{_key:{value:R.relKey},_partialObj:{value:d[R.relKey]},_model:{value:b},_payloadObj:{value:w},replace:{value:store.$.replaceCheck,writable:!0},partRecMap:{value:new Map}}),R.opts&&R.opts.serialize&&Object.defineProperty(w.$,"_serialize",{value:R.opts.serialize})));for(var A=0;A<k;A++){var P=b;if(L&&("normalizeRecord"==i?P=O[A]&&O[A]._type?O[A]._type:b:"serializeRecord"==i&&("record"==_?P=g&&Lyte.isRecord(g[A])?g[A].$.model._name:b:"partial"==_&&(P=O[A]&&O[A].$?O[A].$.polymorphicType:b))),"serializeRecord"==i){var j=store.modelFor(b)._pK;w.$.partRecMap.set(O[A][j],!0)}w.push(this.serializeRecords(P,O[A],void 0,o,i,s,d?d[R.relKey][A]:void 0))}r[R.relKey]=w}else{P=b;L&&("normalizeRecord"==i?P=r[R.relKey]&&r[R.relKey]._type?r[R.relKey]._type:b:"serializeRecord"==i&&(P=Lyte.isRecord(t[R.relKey])?t[R.relKey].$.model._name:b)),O&&"object"==typeof O&&!O.$&&R.opts&&R.opts.serialize&&(store.$.defProp(O,"$",{}),Object.defineProperty(O.$,"_serialize",{value:R.opts.serialize})),r[R.relKey]=this.serializeRecords(P,r[R.relKey],t?t[R.relKey]:void 0,o,i,s,d?d[R.relKey]:void 0)}else"serializeRecord"==i&&R.opts&&R.opts.serialize&&"id"==R.opts.serialize&&"relation"==R.type&&"hsaMany"==R.relType&&(store.$.defProp(r[R.relKey],"$",{}),store.$.defPayArrUtls(r[R.relKey].$),d&&d[R.relKey]&&(Object.defineProperties(r[R.relKey].$,{_key:{value:R.relKey},_partialObj:{value:d[R.relKey]},_model:{value:b},_payloadObj:{value:r[R.relKey]},replace:{value:store.$.replaceCheck,writable:!0}}),R.opts&&R.opts.serialize&&Object.defineProperty(w.$,"_serialize",{value:R.opts.serialize})))}return r},handleAjax:function(e){if(e.url&&!e.model)return Lyte.error("Please pass model param to ajax call"),Promise.reject("Please pass model param to ajax call");var r=store.adapter.$.buildURL("ajax",e.type,e.model,e.index,void 0,e.queryParams,void 0,e.customData,e.url);r.data=e.data;var t=r.qP;store.$.initCB("serializer",e.model,"serialize",{args:["ajax",r.data,void 0,e.customData,e.model,t,void 0]});return store.adapter.$.handleRequest(r,e.model,void 0,"ajax",void 0,e.customData,void 0,void 0,void 0,void 0)},handleAction:function(e,r,t,o,a,i,s){var n;t&&Lyte.isRecord(t)&&(n=t.$.get(r._pK));var d=r._name;o=void 0==o?store.$.getFromCB("adapter",r._name,"customData"):o;var l=this.buildURL("action",i||"POST",r._name,n,t,a,e,o);l.data=s,a=l.qP;var c=store.$.initCB("serializer",r._name,"serialize",{args:["action",s,t,o,d,a,e]});return c&&(l.data=c.data),this.handleRequest(l,r._name,void 0,"action",void 0,o,void 0,void 0,e)},handleRequest:function(e,r,t,o,a,i,s,n,d,l){if(e.data&&e.data.LdEr)return Lyte.warn(e.data.LdEr,e.data.key,r),Promise.reject({code:e.data.LyteError,message:Lyte.errorCodes[e.data.LyteError],data:e.data.key});!e.data||"object"!=typeof e.data&&!Lyte.isRecord(e.data)&&!Array.isArray(e.data)||e.data instanceof FormData||(e.data=JSON.stringify(e.data));var c=this;return new Promise(function(a,p){var y=store.$.getFromCB("adapter",r,"processRequest"),f=!0,v=store.$.makeBatch,u=!1;if(y){f=!1;var h,m=c.callGeneric(o,r,e.data,t,i,e?e.qP:void 0,n,e.url,d,e.method,e.headers);m instanceof Promise?(u=!0,m.then(function(n){if("action"==o||"ajax"==o)try{n=JSON.parse(n)}catch(e){n=n}else n=JSON.parse(n);h=c.genericResponse(n,r,o,t,e,void 0,s,i),a(h)},function(e){p(e)})):f=!0}if(v&&!u)store.adapter.$.constructBatch(r,o,n,e).then(function(s){var c=s.content;store.adapter.$.handleSuccess(r,o,void 0,t,e,a,c,s,void 0,p,n,i,d,l)},function(s){store.adapter.$.handleFailure(r,o,void 0,t,e,a,s.content,void 0,p,n,i,s.code,d,s)});else if(f){var $=[r,o,n,e,a,p,"other",t,i];store.adapter.$.sendXHR.apply(store.adapter.$,$).then(function(c){store.adapter.$.handleSuccess(r,o,c,t,e,a,void 0,void 0,s,p,n,i,d,l)},function(l){store.adapter.$.handleFailure(r,o,l,t,e,a,void 0,s,p,n,i,void 0,d)})}})},handleSuccess:function(e,r,t,o,a,i,s,n,d,l,c,p,y,f){var v,u,h,m=t?t.responseText:void 0;t&&t.status;if(s)m=s;else if(m&&0!=m.length)if("action"==r)try{s=JSON.parse(m)}catch(e){s=m}else s=JSON.parse(m);else s=JSON.parse("{}");t&&(v=t),n&&(u=n.index,h=n.batch,v=n.resp);var $={customD:p};if(v){var g=store.$.initCB("adapter",e,"parseResponse",{args:[r,e,v,s,a?a.qP:void 0,c,p,void 0,y]});if(g&&(s=g.data)instanceof Promise)return this.handleParseResponsePromise(s,e,r,o,a,t,d,u,h,i,l,$)}return this.otherParseRequestPromise(s,e,r,o,a,t,d,u,h,i,l,p,f,c)},handleFailure:function(e,r,t,o,a,i,s,n,d,l,c,p,y,f){if(t){store.$.cbScp(e,"parseResponse","adapter");var v,u=t.responseText;if(u)try{u=""==u?JSON.parse("{}"):JSON.parse(u)}catch(e){Lyte.warn("LD24",e)}var h=store.$.initCB("adapter",e,"parseResponse",{args:[r,e,t,u,a?a.qP:void 0,l,c,void 0,y]});if(h&&(v=h.data)instanceof Promise)return this.handleParseResponsePromise(v,e,r,o,a,t,n,void 0,void 0,i,d,c)}else if(s){var m,$;f&&($=f.index,m=f.batch),store.$.batchResponse[m][$]={code:p,status:"requestFailure",data:s},d({code:p,status:"requestFailure",data:s})}d(t)},updateIDB:function(e,r,t,o,a,i){t&&!Array.isArray(t)&&(t=[t]);var s=store.model[e],n=store.$.getIDBObj(s,a&&a.qP?a.qP:void 0,r,i,o);if(s&&n&&(!n||n.hasOwnProperty("queryCache"))){var d=store.$.idbQ2[e]=store.$.idbQ2[e]||[],l=n.queryCache;if(t)switch(r){case"update":case"updateRecord":t.forEach(function(r,t){if(r&&Lyte.isRecord(r)){var a=store.model[e].relations;r.$.inIDB&&r.$.inIDB.self&&d.push({type:"updateRecord",model:e,data:r.$.toJSON("idb"),queryCache:l,customData:o}),store.adapter.$.updateRelationsIDB(r,a,o),store.$.addToIDBonSave(e,r)}});break;case"delete":case"deleteRecord":case"destroyRecord":var c=store.modelFor(e)._arrPk;t.forEach(function(r,t){if(r&&Lyte.isRecord(r)){var a=store.model[e].relations;r.$.parent;for(var i={},s=0;s<c.length;s++)i[c[s]]=r[c[s]];r.$.inIDB&&r.$.inIDB.self&&d.push({type:"deleteRecord",model:e,key:i,queryCache:l,customData:o}),store.adapter.$.updateRelationsIDB(r,a,o),store.$.removeOnSave(e,r.$.pK)}});break;case"create":case"createRecord":t.forEach(function(r,t){if(r&&Lyte.isRecord(r)){var a=store.model[e].relations;d.push({type:"createRecord",model:e,data:r.$.toJSON("idb"),queryCache:l,customData:o}),store.adapter.$.updateRelationsIDB(r,a,o,"create"),store.$.addToIDBonSave(e,r)}})}}else t.forEach(function(t,a){t&&Lyte.isRecord(t)&&store.adapter.$.updateRelationsIDB(t,store.model[e].relations,o,r)})},updateRelationsIDB:function(e,r,t,o){switch(o){case"create":case"createRecord":for(var a in r){r[a].forEach(function(r){var o,a=r.relKey,i=r.relatedTo;store.$.idbQ2[i]=store.$.idbQ2[i]||[],e.$.inIDB;(o=r.dummy?store.$.getRelatedRecord(e,r.relatedTo,r.dummy):e[a])&&!Array.isArray(o)&&(o=[o]),o&&o.forEach(function(e){var r=e.$.model,o=store.$.idbQ2[r._name]=store.$.idbQ2[r._name]||[];for(var a in e.$.inIDB.self&&o.push({type:"updateRecord",model:r._name,data:e.$.toJSON("idb"),customData:t}),e.$.inIDB){var i=e.$.inIDB[a],s=store.$.idbQ2[a]=store.$.idbQ2[a]||[];i.forEach(function(e,r){s.push({type:"updateRecord",model:a,data:store.peekRecord(a,r).$.toJSON("idb"),customData:t})})}})})}break;default:var i=e.$.inIDB;if(i)for(mKey in i){i[mKey].forEach(function(e,r){var o=store.peekRecord(mKey,r);(store.$.idbQ2[mKey]=store.$.idbQ2[mKey]||[]).push({type:"updateRecord",model:mKey,data:o.$.toJSON("idb"),customData:t})})}}},callGeneric:function(e,r,t,o,a,i,s,n,d,l,c){var p=store.$.initCB("adapter",r,"processRequest",{args:[e,r,t,o,a,i,s,n,d,l,c]});return p?p.data:void 0},genericResponse:function(e,r,t,o,a,i,s,n,d){var l,c,p=e,y=(i&&i.status,a?a.qP:void 0);if(l=store.$.cbScp(r,"extractMeta","serializer"))if(p){var f=store.$.cB(l,[p,r,t,y,n]);store.$.isEmpty(f)||(p.meta=f),c=!0}else c=!1;if(p&&"action"!=t&&"ajax"!=t){if(p=store.serializer.$.buildJSON(r,t,p,Lyte.isRecord(o)?o[store.modelFor(r)._pK]:void 0,i?i.status:void 0,a,n,y),0==c&&l&&p){f=store.$.cB(l,[p,r,t,y,n]);store.$.isEmpty(f)||(p.meta=f)}var v=Object.keys(p),u=v.length;if(l=store.$.cbScp(r,"deserializeKey","serializer")){Lyte.warn("LD08","deserializeKey","callback","Please use payloadKey callback instead"),u>2&&Lyte.error("LD09");var h=0;"meta"==v[0]&&(h=1);var m=store.$.cB(l,[r,t]),$=p[v[h]];delete p[v[h]],p[m]=$}this.handleResponse(o,p,store.modelFor(r),t,s,void 0,d)}return p},removePartialKeys:function(e,r,t){var o=r.relations,a=e.$.pK;for(var i in o){o[i].forEach(function(t){var o;if(bMod=store.model[t.relatedTo],bMod&&(o=store.$.getBackwardRel(r,t,bMod))&&"hasMany"==o.relType&&o.opts&&o.opts.serialize){var i=t.relKey,s=o.relKey,n=e[i];if(n)if(Array.isArray(n))n.forEach(function(e){var r=e[s];r&&r.partial&&r.partial.get(a)&&r.partial.delete(a)});else if(n[s]){var d=n[s];d&&d.partial&&d.partial.get(a)&&d.partial.delete(a)}}})}},mergeError:function(e,r,t){if(t&&t.$&&t.$.isError){if(t.$.error){var o=t.$.error;for(var a in o)e.fieldList.hasOwnProperty(a)&&store.$.setRecErr(r.$,a,o[a])}return delete t.$.error,delete t.$.isError,!0}},mergeResponse:function(e,r,t,o,a,i){if(this.removePartialKeys(e,r,o),a&&Object.keys(a).length&&this.mergeNewDataKeys(a,e,t,i),!this.mergeError(r,e,t)){var s=store.peekRecord(e.$.model._name,e.$.pK),n=!1;e.$.isDeleted&&this.mergeDeletedRec(a,e,i),e.$.isNew&&s&&(n=this.mergeNewRecord(a,e,t,!0,i)),e.$.isModified&&s&&this.mergeModifiedRec(a,e,t,!0,n,i),r.dirty.length&&store.$.deleteFromArray(r.dirty,void 0),a&&Object.keys(a).length&&t&&!n&&t&&(s?(result=store.$.validateAndMerge(r,t,a,!0),result&&result.data?result=result.data:result&&result.type&&Lyte[result.type].apply(Lyte,result.args||[])):result=store.$.insertIntoStore(r._name,t,void 0,void 0,a)),store.adapter.$.removeDirtyStack(e,a)}},removeDirtyStack:function(e,r){if(r&&r._removedAttr&&0!=Object.keys(r._removedAttr).length)for(var t in e.$._attributes)r._removedAttr.hasOwnProperty(t)||delete e.$._attributes[t];else e.$._attributes={};e.$.undoStack=store.$.genUnRedoStack(),e.$.redoStack=store.$.genUnRedoStack(),delete e.$._savedState,store.$.clrRecErr(e.$)},removeBackwardRelDirty:function(e,r){var t=e.$.model,o=t.relations;for(var a in o){o[a].forEach(function(o){var a;e.hasOwnProperty(o.relKey)&&(store.modelFor(o.relatedTo)&&(a=store.$.getBackwardRel(t,o,store.modelFor(o.relatedTo))),a&&a.opts&&a.opts.serialize&&("hasMany"==a.relType?store.adapter.$.removeRelPartial(e[o.relKey],a,r):"belongsTo"==a.relType&&store.adapter.$.removeRelPartial(e[o.relKey],a,r)))})}},removeRelPartial:function(e,r,t){if(Array.isArray(e))e.forEach(function(e){var o=e[r.relKey];o&&("hasMany"==r.relType?o.partial&&(o.partial.delete(t),o.partial.size||store.$.deleteDeepNest(e,r.relKey,t)):store.$.deleteDeepNest(e,r.relKey,t))});else if(Lyte.isRecord(e)){var o=e[r.relKey];o&&("hasMany"==r.relType?o.partial&&(o.partial.delete(t),o.partial.size||store.$.deleteDeepNest(e,r.relKey,t)):store.$.deleteDeepNest(e,r.relKey,t))}},mergeNewRecord:function(e,r,t,o,a){var i,s=e.$?e.$.model:r.$.model._name,n=store.model[s],d=n._arrPk,l=r.$.pK,c=store.peekRecord(s,l),p=e.$?e.$.record:void 0;if(!Lyte.isRecord(p)||p===c){if(c){var y="object"==typeof l?l:l.toString(),f=!1;if(!0!==a){d.forEach(function(e){t&&t.hasOwnProperty(e)?(store.$.cmpSet(r,e,t[e],void 0,!0),f=!0):Lyte.error("LD16",s,Lyte.isRecord(r)?"object"==typeof r.$.pK?JSON.stringify(r.$.pK):r.$.pK:void 0)});var v=store.$.getpKVal(r);store.$.cmpSet(r.$,"pK",store.$.getpKVal(r));var u="object"==typeof v?v:v.toString();n.data._recMap&&(n.data._recMap.delete(y),n.data._recMap.set(u,r)),store.$.changeRelPkMaps(r,y,u),store.$.updateNestScp(r,l)}if(f&&e&&e.$&&(e.$.processed=!0),o&&!0!==a&&((i=store.$.validateAndMerge(n,t,e,!0))&&i.data?i=i.data:i&&i.type&&Lyte[i.type].apply(Lyte,i.args||[])),store.$.cmpSet(r.$,"isNew",!1),e.hasOwnProperty("_removedAttr")&&0!=Object.keys(e._removedAttr).length)return i;store.$.cmpSet(r.$,"isModified",!1),store.$.changePersist(r,!0),store.$.deleteFromArray(n.dirty,l),store.adapter.$.removeBackwardRelDirty(r,l),(!r.$.dN||r.$.dN&&0==Object.keys(r.$.dN).length)&&store.$.removeParentNesting(r)}return i}},mergeModifiedRec:function(e,r,t,o,a,i){var s,n=n||r.$.pK;return r.$.isDeleted||!t||a||!0===i||(t&&o&&((s=store.$.validateAndMerge(r.$.model,t,e,!0))&&s.data?s=s.data:s&&s.type&&Lyte[s.type].apply(Lyte,s.args||[])),a=!0),e&&e.hasOwnProperty("_removedAttr")&&Object.keys(e._removedAttr).length?s:(store.$.cmpSet(r.$,"isModified",!1),store.$.changePersist(r,!0),store.$.deleteFromArray(r.$.model.dirty,r.$.pK),store.adapter.$.removeBackwardRelDirty(r,r.$.pK),(!r.$.dN||r.$.dN&&0==Object.keys(r.$.dN).length)&&store.$.removeParentNesting(r),s)},mergeDeletedRec:function(e,r){var t,o,a;e?(t=e.$.model,o=e.$.pkVal):r&&(t=r.$.model._name,o=r.$.pK);var i=(v=(a=store.model[t])._deleted.get(o))?v.data:void 0,s=store.peekRecord(t,o);if(i){store.$.cmpSet(i.$,"isDeleted",!1),store.$.cmpSet(i.$,"isUnloaded",!0),store.$.cmpSet(i.$,"isPersisted",!0);var n=i.$.__scpObj;for(var d in n){var l=n[d].split("_"),c=Lyte.nestScp[l[0]];c&&Lyte.removeNestScp(c._data,l[0],l[1],void 0,i,void 0,void 0,{model:t,pK:o,attr:d})}a._deleted.delete(o),store.$.removeParentNesting(i)}if(s)store.$.removeFromStore(a,o,!0,void 0,void 0,!0),store.$.removeParentNesting(s);else{var p=store.model.cachedQueries;if(p){var y=p[t];if(y&&y.length)for(var f=y.length-1;f>=0;f--){var v;if((v=y[f]).hasDeletedRecords)if(v.data)-1!==v.data[t].indexOf(i)&&y.splice(f,1)}}}e&&e.$&&e.$.parent&&(e.$.parent.$.partial={}),e&&e.$&&(e.$.processed=!0)},mergePartialObj:function(e,r,t,o,a){var i,s=store.peekRecord(e.$.model,e.$.pkVal),n=(r=r||s,!!s);if(!(e&&e.$&&e.$.processed||this.mergeError(store.model[e.$.model],r,t)))if("removed"!=e.$.type){if(("added"==e.$.type||r&&r.$&&1==r.$.isNew)&&n?i=this.mergeNewRecord(e,r,t,o,a):("modified"==e.$.type||"related"==e.$.type||r&&r.$&&1==r.$.isModified)&&n&&this.mergeModifiedRec(e,r,t,o,i,a),n){if("removed"!=e.$.type)for(var d in e){var l=e[d];this.mergeNewDataKeys(l,r[d],t?t[d]:void 0,a)}r.$.partial&&Object.keys(r.$.partial)&&(r.$.partial=new Map),store.adapter.$.removeDirtyStack(r,e)}}else this.mergeDeletedRec(e,r,a)},mergeNewDataKeys:function(e,r,t,o){if(e&&(r&&r.partial&&r.partial.size||1==e.partial)){var a=this;if(Array.isArray(e)){var i=!!e.replace&&e.replace;if(e.forEach(function(e,s){if(e.$){var n=store.model[e.$.model]._pK,d=store.$.getIndex(r,n,e.$.pkVal);!0===e.$.onlyDetach?(r.record&&r.key&&store.$.deleteDeepNest(r.record,r.key,e.$.pkVal),store.$.handleArrOp(r,"removeAt",void 0,d,1)):(i&&e.$.record&&e.$.record.$.isNew?i=!0:a.mergeNewDataKeys(e,-1!=d?r[d]:void 0,t?t[s]:void 0,o),r.partial&&r.partial.delete(e.$.pkVal)),(!e._removedAttr||e._removedAttr&&Object.keys(e._removedAttr).length)&&r.partial&&r.partial.delete(e.$.pkVal)}}),Array.isArray(r)&&r.partial&&r.partial.size&&r.record&&r.key&&r.record.$.model){var s=r.record.$.model.fieldList[r.key],n=[];s.opts&&/^(id|record)$/.test(s.opts.serialize)&&(r.partial.forEach(function(e,r){"removed"==e.type&&n.push(r)}),n.forEach(function(e){var t=store.peekRecord(r.model._name,e)||store.peekRecord(r.model._name,e,!0);r.partial.delete(e),t&&store.$.removeParentNesting(t)}))}}}else if(e&&e.$&&e.$.type)if(e.$.onlyDetach){var d=e.$.parent;if(d&&d.$.partial&&d.$.partial[e.$.relKey]&&d.$.partial[e.$.relKey].has(e.$.pkVal)&&"removed"==d.$.partial[e.$.relKey].get(e.$.pkVal).type){var l=store.peekRecord(e.$.model,e.$.pkVal)||store.peekRecord(e.$.model,e.$.pkVal,!0);d.$.partial[e.$.relKey].delete(e.$.pkVal),d.$.partial[e.$.relKey].size||(delete d.$.partial[e.$.relKey],Object.keys(d.$.partial).length||delete d.$.partial),l&&store.$.removeParentNesting(l)}}else this.mergePartialObj(e,r,t,void 0,o);else if(Array.isArray(e)){a=this;e.forEach(function(e,i){a.mergeNewDataKeys(e,r[i],t?t[i]:void 0,o)})}else if("object"==typeof e)for(var c in e){e[c];this.mergeNewDataKeys(e[c],r[c],t?t[c]:void 0,o)}},handleResponse:function(e,r,t,o,a,i,s){var n,d,l,c=t._pK;if(r=r[t._name],Array.isArray(e))for(var p=0;p<e.length;p++)l=(d=e[p]).$.pK,n=a&&d&&l?a.get(l):void 0,this.mergeResponse(e[p],t,Array.isArray(r)?r[p]:r,c,n);else l=e.$.pK,n=a&&e&&l?a.get(l):void 0,this.mergeResponse(e,t,r,c,n)},compareData:function(e,r,t){if(!store.$.isEmpty(e)&&!store.$.isEmpty(r)){var o=typeof e;if(o!==typeof r)return!1;switch(o){case"string":case"number":case"boolean":if(e===r)return!0;break;case"object":return this.compareObjects(e,r,t)}}return!1},compareObjects:function(e,r,t){if(!(e instanceof Object&&r instanceof Object))return!1;if(Object.keys(e).length!=Object.keys(r).length)return!1;for(var o in e){var a=e[o],i=r[o];if(t&&Array.isArray(a)&&Array.isArray(i)){if(a.length!=i.length)return!1;for(var s=a.length,n=0;n<s;n++){if(!store.adapter.$.compareData(a[n],i[n],t))return!1}}else if(void 0===i||!store.adapter.$.compareData(a,i,t))return!1}return!0},handleBatchPromise:function(e){var r=e.response,t=e.batch;if(e.fail){store.$.batchPromise[t].forEach(function(e,r){e.reject({content:{},index:r,batch:t,code:"400",resp:{}})})}else{var o=store.$.initCB("serializer","application","normalizeResponse",{args:[void 0,"batch",e.response]});o&&(r=o.data),r.batch_requests.forEach(function(e,r){var o=store.$.batchPromise[t][r],a=e.status.toString(),i=a[0];"2"==i?o.resolve({content:e.content,index:r,batch:t,resp:e}):"4"!=i&&"5"!=i||(store.$.batchResponse[t][r]=void 0,o.reject({content:e.content,index:r,batch:t,resp:e,code:a}))})}delete store.$.batch[t],delete store.$.batchPromise[t]},handleParseResponsePromise:function(e,r,t,o,a,i,s,n,d,l,c,p){e.then(function(e){"findRecord"==t||"findAll"==t?store.adapter.$.findParseRequestPromise(e,r,t,o,a,i,n,d,l,p):store.adapter.$.otherParseRequestPromise(e,r,t,o,a,i,s,n,d,l,c,p?p.customD:void 0,void 0,o)},function(e){c(i)})},findParseRequestPromise:function(e,r,t,o,a,i,s,n,d,l){var c=Object.assign({},l);delete c.customD;var p=this.getResponse(e,r,t,o,a,i,l?l.customD:void 0,c);d(i?[p,i.statusText,i]:void 0!=s?[p,"batch",{index:s,batch:n}]:[p])},otherParseRequestPromise:function(e,r,t,o,a,i,s,n,d,l,c,p,y,f){var v=this.genericResponse(e,r,t,o,a,i,s,p,y);void 0!=n&&(store.$.batchResponse[d][n]=v),"action"!=t&&"ajax"!=t&&this.updateIDB(r,t,o,p,a,f),l(v)}}},store.$.defProp(store.adapter,"extends",function(e,r,t){return store.$.scExtd("adapter",e,r,t)},!1),Lyte.$.requiredMixins.serializer=Lyte.$.requiredMixins.adapter=function(e,r,t){Object.keys(e).length&&r.forEach(function(r,o){var a=r.scope,i=r.name,s=a[t][i];if(s)for(var n in e)s[n]=e[n]})},Lyte.$.injectServices&&(Lyte.$.injectServices.adapter=Lyte.$.injectServices.serializer=function(e,r,t,o,a,i){var s=store[t],n={};for(var d in n.as=e,n.service=r,s){var l=s[d];store.$.extendService([n],t,d,l,store,!0,i)}}),store.$.cbDef(Serializer,"serializer"),store.serializer={$:{buildJSON:function(e,r,t,o,a,i,s,n){var d=i?i.headers:void 0,l=t,c=store.$.initCB("serializer",e,"normalizeResponse",{args:[e,r,l,o,a,d,i?i.qP:void 0,s,void 0,i?i.gqlObj:void 0]});c&&(l=c.data);var p,y=/^(findRecord|findAll)$/.test(r);if(!y&&l&&"object"==typeof l&&(c=store.$.initCB("serializer",e,"payloadKey",{args:[e,r,void 0,n,s]}))){var f=c.data;if(f&&f!=e){var v=l[f];l[e]=v,delete l[f]}}if(y||l&&l[e]){if(p=l[e],!0,scope=store.$.cbScp(e,"normalize","serializer"),scope)if(Array.isArray(p))for(var u=0;u<p.length;u++)p[u]=store.$.cB(scope,[e,r,p[u],s]);else p=store.$.cB(scope,[e,r,p,s]);var h="pushPayload"!=r?{url:i.url,method:i.method,headers:i.headers,type:r,qP:i.qP,withCredentials:i.withCredentials,model:e}:void 0;p=store.adapter.$.serializeRecords(e,p,void 0,h,"normalizeRecord",s),l[e]=p}return l},normalizeResponse:function(e,r,t,o,a,i,s,n){var d=i?i.headers:void 0,l=t,c=store.$.initCB("serializer",e,"normalizeResponse",{args:[e,r,l,o,a,d,i?i.qP:void 0,s,n,i?i.gqlObj:void 0]});return c&&(l=c.data),l},normalize:function(e,r,t,o,a,i,s,n,d){var l=t,c=!1;(/^(findRecord|findAll)$/.test(r)||l[e])&&(l=l[e],c=!0);var p=store.$.cbScp(e,"normalize","serializer");if(p)if(Array.isArray(l))for(var y=0;y<l.length;y++)l[y]=store.$.cB(p,[e,r,l[y],s,n]);else l=store.$.cB(p,[e,r,l,s,n]);c&&(t={},l=store.adapter.$.serializeRecords(e,l,void 0,{url:d.url,method:d.method,headers:d.headers,type:r,qP:d.qP,withCredentials:d.withCredentials,model:e},"normalizeRecord",s),t[e]=l)}}},store.$.defProp(store.serializer,"extends",function(e,r,t){return store.$.scExtd("serializer",e,r,t)}),Object.defineProperties(store,{modelless:{value:{}},registerModel:{get:()=>(Lyte._preRegister(),store.$.registerModel)},ajax:{value:function(e){if(!e.model)return Promise.reject("Model name is mandatory for ajax method");if(1!=store.$.getFromCB("adapter",e.model,"modelless"))return Promise.reject("Modelless behaviour is not enabled. Please enable it to make ajax call for models that are not defined");if(!e.type)return Promise.reject(e.type+" is not a valid HTTP method");var r="string"==typeof e.model?this.model[e.model]:void 0;return r&&r.fieldList?Promise.reject(e.model+" is a defined model. ajax is supported only for a model which is not defined"):store.adapter.$.handleAjax(e)}},triggerUpdate:{value:function(e,r,t,o,a,i){var s,n=[],d=[];if(void 0==(p=store.modelFor(e)))return Lyte.warn("LD02","Model",e),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e});s=Array.isArray(r)?r:[r];for(var l=0;l<s.length;l++){var c=store.peekRecord(e,s[l]);if(!c)return Promise.reject("No such record found");var p,y={},f=(p=c.$.model)._arrPk;(t||Object.keys(p.fieldList)).forEach(function(e){y[e]=c[e]}),f.forEach(function(e){y[e]=c[e]}),n.push(y),d.push(c)}var v=!1;return Array.isArray(r)||(n=n[0],d=d[0],v=!0),store.adapter.$.put(e,n,d,v,a,o,i)}},batch:{value:function(e){return new Promise(function(r,t){store.$.makeBatch=!0,store.$.batch=store.$.batch||{},store.$.batchPromise=store.$.batchPromise||{};var o,a,i=void 0===store.$.currentBatch?Object.keys(store.$.batch).length:store.$.currentBatch+1,s=store.$.currentBatch=i;e&&"function"==typeof e?o=e:e&&"object"==typeof e&&(o=e.method,a=e.customData);try{o()}catch(e){throw store.$.makeBatch=!1,e}store.$.makeBatch=!1;var n={batch:store.$.batch[s]},d=store.adapter.$.buildURL("batch","POST","application",void 0,n,void 0,void 0,a),l=n.batch;if(store.$.isEmpty(l)){if(store.$.cachedBatch&&store.$.cachedBatch[s]&&store.$.cachedBatch[s].length){var c=store.$.handleCachedResponse(s,[]);return r(c)}return r()}var p=store.$.initCB("serializer","application","serialize",{args:["batch",n,void 0,a]});p&&(n=p.data);var y=new XMLHttpRequest;for(var f in y.open("POST",d.url,!0),d.headers)y.setRequestHeader(f,d.headers[f]);y.withCredentials=!!d.withCredentials,y.send(JSON.stringify(n)),y.onreadystatechange=function(){if(4==y.readyState)if("2"==y.status.toString()[0]||"3"==y.status.toString()[0]){var e=JSON.parse(y.responseText);store.$.batchResponse=store.$.batchResponse||{},store.$.batchResponse[s]=[],store.adapter.$.handleBatchPromise({response:e,batch:s,resolve:r}),setTimeout(function(){var e=store.$.handleCachedResponse(s,store.$.batchResponse[s]);r(e),store.$.batchResponse[s]=[]},0)}else store.$.batchResponse[s]=[],store.adapter.$.handleBatchPromise({batch:s,resolve:r,fail:!0}),setTimeout(function(){var e=store.$.handleCachedResponse(s,store.$.batchResponse[s]);t(e)},0)}})}},pushPayload:{value:function(e,r,t,o){var a=store.modelFor(e);if(a=store.$.getFromCB("adapter",e,"modelless")?e:a){var i,s=r;if(t){r=store.serializer.$.buildJSON(e,"pushPayload",r);var n=store.$.cbScp(e,"deserializeKey","serializer");if(i=r?Object.keys(r).length:void 0,n){Lyte.warn("LD08","deserializeKey","callback","Please use payloadKey callback instead"),i>2&&Lyte.error("LD09");var d=Object.keys(r),l=0;2==d.length&&"meta"==d[0]&&(l=1);var c=store.$.cB(n,[e,"pushPayload"]),p=r[d[l]];delete r[d[l]],r[c]=p}s=r[e]}var y=(r=store.$.insertIntoStore(e,s,!0,void 0,void 0,l,!0,void 0,o))||[];Array.isArray(y)||(y=[y]);var f=a&&a.hasOwnProperty("idb");return window.LyteIDB&&y.forEach(function(r){Lyte.isRecord(r)&&(f&&store.$.idbQ2Push(e,r,void 0,"pushPayload"),r.$.isError||r.$.inIDB&&Object.keys(r.$.inIDB).length&&store.adapter.$.updateRelationsIDB(r,r.$.model.relations))}),a&&delete a.rel,r}Lyte.warn("LD02","Model",e)}},unregisterModel:{value:function(e,r){r=!1!==r,Array.isArray(e)?e.forEach(function(e){store.$.unregisterModel(e,r)}):store.$.unregisterModel(e,r)}},unregisterAdapter:{value:function(e){Array.isArray(e)?e.forEach(function(e){store.$.unRegCb("adapter",e)}):store.$.unRegCb("adapter",e)}},unregisterSerializer:{value:function(e){Array.isArray(e)?e.forEach(function(e){store.$.unRegCb("serializer",e)}):store.$.unRegCb("serializer",e)}},addField:{value:function(e,r,t,o,a,i){var s,n=store.modelFor(e),d=[];if(n.fieldList.hasOwnProperty(r)&&"relation"==n.fieldList[r].type){var l=n.fieldList[r],c=n.relations[l.relatedTo];if(Array.isArray(c)){var p=c.indexOf(l);c.splice(p,1)}"hasMany"==l.relType&&delete n._fldGrps.hasMany[r]}if(t&&"object"==typeof t){store.$.registerField(n,r,t,d),s="relation"==t.type?"relation":"attr";i=arguments[4],a=void 0===a?arguments[3]:a}else{var y=Lyte.attr(t,o);store.$.registerField(n,r,y,d)}"relation"!=s&&(a&&!i||store.$.updateFieldValidation(n,r,i,a))}},modelFor:{value:function(e){return store.model[e]}},createRecord:{value:function(e,r,t){return this.$.newRecord(e,r,t)}},deleteRecord:{value:function(e,r){this.$.removeFromStore(store.modelFor(e),r,void 0)}},findAll:{value:function(e,r,t,o,a,i,s,n){return store.adapter.$.get("findAll",e,void 0,r,t,a,o,i,s).then(function(){var i,s,d,l=arguments,c=l[0][0],p=l[0][2],y=p?p.status:l[0][3],f="cache"==l[0][1],v="batch"==l[0][1]?l[0][2]:void 0,u="idb"==l[0][1],h=store.$.getFromCB("adapter",e,"modelless");if(i=store.model[e],s=t&&!0!==t?t:!0===t&&r&&"object"==typeof r&&Object.keys(r).length?r:void 0,i||void 0!=o?h&&!i&&1==o&&(d=!0):o=!1,void 0!==o&&"object"==typeof o&&null!==o&&(o=!o.hasOwnProperty("cache")||o.cache),!1===o)return!f&&s&&store.$.cacheQuery(e,s,c,y),void 0!=v&&(store.$.batchResponse[v.batch][v.index]=c),c;if(c&&!c.save){if(!f){if(!c||!c.hasOwnProperty(e))return void Lyte.error("LD13","findAll",e,r&&"object"==typeof r?",queryParams-"+JSON.stringify(r):"");var m=c[e];if(void 0===m||null===m||store.$.isEmptyArray(m))c[e]=[];else{Array.isArray(m)||Lyte.warn("LD19");var $=d&&void 0!=n?n:d?"id":void 0,g=store.$.toInsertData(e,c,!0,$),b=g;g&&!Array.isArray(g)&&(b=[g]),window.LyteIDB&&!u&&(b&&!b.$||g&&g.$&&!g.$.isError)&&(i&&i.hasOwnProperty("idb")&&store.$.idbQ2Push(e,b,r,"findAll",void 0,void 0,a),b.forEach(function(e){e&&e.$&&e.$.inIDB&&Object.keys(e.$.inIDB).length&&store.adapter.$.updateRelationsIDB(e,e.$.model.relations)})),window.LyteIDB&&u&&b&&Array.isArray(b)&&b.forEach(function(e){LyteIDB.changeIDBState(e)}),c[e]=g}c.hasOwnProperty("meta")&&(c[e].$||store.$.defProp(c[e],"$",{}),c[e].$.meta=c.meta),s&&store.$.cacheQuery(e,s,c)}return void 0!=v&&(store.$.batchResponse[v.batch][v.index]=c[e]),c[e]}return arguments},function(e){return Promise.reject(e)})}},findRecord:{value:function(e,r,t,o,a,i,s,n,d){return void 0==r?Promise.reject({code:"ERR20",message:Lyte.errorCodes.ERR20}):store.adapter.$.get("findRecord",e,r,t,o,i,a,s,n).then(function(){var s,n=arguments[0][0],l="cache"==arguments[0][1],c=arguments[0][2],p=c?c.status:arguments[0][3],y="batch"==arguments[0][1]?arguments[0][2]:void 0,f="idb"==arguments[0][1],v=store.model[e],u=o&&!0!==o?o:!0===o&&t&&"object"==typeof t&&Object.keys(t).length?t:void 0,h=store.$.getFromCB("adapter",e,"modelless");if(v||void 0!=a?h&&!v&&1==a&&(s=!0):a=!1,void 0!==a&&"object"==typeof a&&null!==a&&(a=!a.hasOwnProperty("cache")||a.cache),!1===a)return!l&&u&&store.$.cacheRecordQuery(e,r,u,n,p),void 0!=y&&(store.$.batchResponse[y.batch][y.index]=n),n;if(n){if(!l){var m;if(!n||!n.hasOwnProperty(e))return void Lyte.error("LD13","findRecord",e,",key-"+("object"==typeof r?JSON.stringify(r):r)+(t&&"object"==typeof t?", queryParams-"+JSON.stringify(t):""));if(!Lyte.isRecord(n)){var $=n[e];if((store.$.isEmpty($)||store.$.isEmptyObj($))&&(n[e]={},m=!0),("object"!=typeof $||Array.isArray($))&&Lyte.warn("LD11"),!m){var g,b=s&&void 0!=d?d:s?"id":void 0,_=store.$.insertIntoStore(e,$,!0,!0,void 0,void 0,void 0,void 0,b);window.LyteIDB&&!f&&Lyte.isRecord(_)&&!_.$.isError&&(Array.isArray(_)||(g=[_]),v&&v.hasOwnProperty("idb")&&store.$.idbQ2Push(e,g,t,"findRecord",r,n&&n.meta?n.meta:void 0,i),g.forEach(function(e){e&&e.$&&e.$.inIDB&&Object.keys(e.$.inIDB).length&&store.adapter.$.updateRelationsIDB(e,e.$.model.relations)})),window.LyteIDB&&f&&g&&Array.isArray(g)&&g.forEach(function(e){LyteIDB.changeIDBState(e)}),n[e]=_}n.hasOwnProperty("meta")&&(Lyte.isRecord(_)?_.$.meta=n.meta:(($=n[e]).$||store.$.defProp($,"$",{}),$.$.meta=n.meta))}!l&&u&&store.$.cacheRecordQuery(e,r,u,n)}return void 0!=y&&(store.$.batchResponse[y.batch][y.index]=n[e]),n[e]}return arguments},function(e){return Promise.reject(e)})}},peekRecord:{value:function(e,r,t){var o,a=this.modelFor(e),i=store.$.getFromCB("adapter",e,"modelless");if(a=i?e:a){if(1==i&&a){if(!(a=store.modelless[a]))return;o=!0}if(!0===t){var s=a._deleted.get(r);if(s&&s.data)return s.data}else{var n=a.isComp;if(r=void 0==r?"":r,!n&&a.data._recMap)return a.data._recMap.get(r.toString());var d,l=a.data;if((d=1!=o?l.filter(function(e){if(store.$.comparePk(e,r))return e}):l.filter(function(e){if(e[a._pK]===r)return e}))[0])return d[0]}}else Lyte.warn("LD02","Model ",e)}},peekAll:{value:function(e){var r=this.modelFor(e),t=store.$.getFromCB("adapter",e,"modelless");if(r=t?e:r){if(1!=t||!r||(r=store.modelless[r]))return arr=r.data,arr}else Lyte.warn("LD02","Model ",e)}},deleteMany:{value:function(e,r){this.$.removeFromStore(store.modelFor(e),r,void 0)}},unloadRecord:{value:function(e,r,t){var o,a=this.modelFor(e),i=store.$.getFromCB("adapter",e,"modelless");if(a=i?e:a){if(1==i&&a){if(!(a=store.modelless[a]))return;o=!0}void 0==r&&Lyte.warn("LD18","key");var s,n=store.peekRecord(e,r);if(1==o)-1!=(v=store.$.getInd(a.data,a._pK,r))&&store.$.handleArrOp(a.data,"removeAt",void 0,v,1);else if(n){var d=a._fldGrps.inherit&&Object.keys(a._fldGrps.inherit).length;if(t=!1!==t,s=n.$.pK,t&&d){var l=new Map;store.$.removeChildRecords(a,n,l,!0)}else this.$.removeFromStore(a,s,!0,!0,void 0,void 0,!0);a._deleted.delete(r);var c=this.model.cachedRecordQueries;c&&c[e]&&c[e][r]&&(c[e][r]=[]);var p=store.model.cachedQueries;if(p){var y=p[e];if(y&&y.length)for(var f=y.length-1;f>=0;f--){var v,u=y[f];if(u&&u.data)-1!=(v=u.data[e].indexOf(n))&&y.splice(f,1)}}}}else Lyte.warn("LD02","Model ",e)}},unloadAll:{value:function(e,r,t){var o,a=this.modelFor(e),i=store.$.getFromCB("adapter",e,"modelless");if(a=i?e:a){if(1==i&&a){if(!(a=store.modelless[a]))return;o=!0}var s=[],n=r||store.peekAll(e);if(1==o)store.$.handleArrOp(a.data,"removeAt",void 0,0,a.data.length);else{if(n)for(var d=0;d<n.length;d++)s.push(n[d].$.pK);var l=a._fldGrps.inherit&&Object.keys(a._fldGrps.inherit).length;if((t=!1!==t)&&l)for(d=s.length-1;d>=0;d--){var c=n[d],p=new Map;store.$.removeChildRecords(a,c,p,!0)}else this.$.removeFromStore(a,s,!0,!0,void 0,void 0,!0);this.model[e].dirty=[],this.model[e]._deleted=new Map;var y=store.model.cachedQueries;y&&y[e]&&(y[e]=[]);var f=this.model.cachedRecordQueries;f&&f[e]&&(f[e]=[])}}else Lyte.warn("LD02","Model ",e)}},triggerAction:{value:function(e,r,t,o,a,i){var s=store.modelFor(e);return void 0==s?(Lyte.warn("LD02","Model",e),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e})):(s.actions?s.actions[r]:void 0)?store.adapter.$.handleAction(r,s,store.peekAll(e),t,o,a,i).then(function(e){return e},function(e){return Promise.reject(e)}):Promise.reject({code:"ERR18",message:Lyte.errorCodes.ERR18})}},rollBack:{value:function(e){var r=this.modelFor(e);r.relations;if(void 0!=r){for(var t=r._pK,o=Array.from(r.dirty),a=o.length,i=0;i<a;i++){var s=this.peekRecord(e,o[i]);s&&s.$.isDeleted||(s&&s.$.isNew?this.$.rollBackNew(r,s,t):s&&s.$.isModified&&s.$.rollBackAttributes(s.$.getDirtyAttributes()))}this.$.rollBackDelete(r,void 0,!0)}else Lyte.warn("LD02","Model",e)}},create:{value:function(e,r,t,o,a,i){var s=store.modelFor(e);if(void 0==s)return Lyte.warn("LD02","Model",e),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e});if(Array.isArray(r)){var n=this;r.forEach(function(r){var t=n.$.newRecord(e,r);if(t.$.isError)return Promise.reject(t)})}else if(r&&"object"==typeof r){var d=this.$.newRecord(e,r);if(d.$.isError)return Promise.reject(d)}for(var l,c=s.dirty,p=c.length,y=[],f=0;f<p;f++){var v=store.peekRecord(e,c[f]);if(v&&v.$.isNew){if(a&&-1==a.indexOf(v))continue;if(l=new error1,store.$.validateRecord(v,s.fieldList),v.$.isError&&Object.keys(v.$.error).length>0)return Promise.reject(l);y.push(v)}}return y.length?store.adapter.$.create(e,y,!1,t,o,i):Promise.resolve()}},update:{value:function(e,r,t,o,a){if(void 0==(i=this.modelFor(e)))return Lyte.warn("LD02","Model",e),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e});var i,s=[],n=[],d=o||store.peekAll(e),l=(i=store.model[e]).relations;return d.forEach(function(r){if(Lyte.isRecord(r)&&r.$.model._name==e){var t=r,o=store.$.isDirty(t,l);if(t&&!t.$.isNew&&!t.$.isDeleted&&(t.$.isModified||o&&o.length)){var a=store.$.updateJSON(t,i,o);s.push(a),n.push(t)}}}),s.length?store.adapter.$.put(e,s,n,!1,r,t,a):Promise.resolve()}},delete:{value:function(e,r,t,o,a,i){var s=store.modelFor(e);if(void 0==s)return Lyte.warn("LD02","Model",e),Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e});r&&this.deleteRecord(e,r);var n=[];if(s._deleted.forEach(function(e,r){n.push(e.data)}),a){var d=[];a.forEach(function(e){-1!=n.indexOf(e)&&d.push(e)}),n=d}return n.length?store.adapter.$.del(e,n,void 0,"delete",t,o,i).then(function(e){return e},function(e){return Promise.reject(e)}):Promise.resolve()}},registerAdapter:{value:store.adapter.extends},registerSerializer:{value:store.serializer.extends},clearCachedQuery:{value:function(e,r,t){var o,a;!(!e||"object"!=typeof e)?(e=(a=e).modelName,r=a.key,o=t=a.cacheQuery):r&&"object"==typeof r?(o=r,r=void 0):t&&"object"==typeof t&&(o=t);var i=[];if(o){if(o){if(void 0==r)(n=this.model.cachedQueries)&&n[e]&&(i=n[e]);else(d=this.model.cachedRecordQueries)&&d[e]&&d[e][r]&&(i=d[e][r]);for(var s=0;s<i.length;s++)if(this.adapter.$.compareData(i[s].cacheQuery,o,!0)){i.splice(s,1);break}}}else if(e){var n=this.model.cachedQueries,d=this.model.cachedRecordQueries;n&&n.hasOwnProperty(e)&&delete n[e],d&&d.hasOwnProperty(e)&&(r?delete d[e][r]:delete d[e])}else this.model.cachedQueries=[],this.model.cachedRecordQueries={}}},getErrorMessage:{value:function(e){return Lyte.errorCodes[e]}},setErrorMessages:{value:function(e){Object.assign(Lyte.errorCodes,e)}},addEventListener:{value:function(e,r){return store.$.eventListeners.add(store,e,r)}},removeEventListener:{value:function(e){store.$.eventListeners.remove(store,e)}},emit:{value:function(e,r){store.$.eventListeners.emit(store,e,r)}},getPrimaryKey:{value:function(e){var r=store.model[e];if(r)return r._pK;Lyte.warn("LD02","Model ",e)}},getDirtyRecords:{value:function(e,r,t){var o=store.modelFor(e);if(o){for(var a=o.dirty,i=[],s={isNew:[],isModified:[],isDeleted:[]},n=0;n<a.length;n++){var d=store.peekRecord(e,a[n]);d&&(d.$.isNew?s.isNew.push(d):s.isModified.push(d))}if(o._deleted.size)o._deleted.forEach(function(e){s.isDeleted.push(e.data)});if((o.dirty||o._deleted.size)&&(void 0!=r&&1!=r||(i=i.concat(s.isNew,s.isModified,s.isDeleted)),Array.isArray(r)&&r.forEach(function(e){i=i.concat(s[e])}),"string"==typeof r&&(i=s[r])),t)store.peekAll(e).forEach(function(e){!e||e.$.isNew||e.$.isDeleted||!e.$.isDirty()||i.includes(e)||i.push(e)});return i}Lyte.warn("LD02","Model ",e)}}});var error1=function(e,r,t){Object.defineProperties(this,{$:{value:{isError:!0,error:t||{}}}}),e&&store.$.setError(this,e,r)}; 
 Lyte.developmentVariables =  { production :undefined}